<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Lesson 05: Linux 筆記 - Log Server, MariaDB, nmap - Ich bin yiwen.</title><meta name="Description" content="An ordinary space for storing and groups pieces of articles."><meta property="og:url" content="http://wysiwyz.github.io/posts/lesson_05_linux/">
  <meta property="og:site_name" content="Ich bin yiwen.">
  <meta property="og:title" content="Lesson 05: Linux 筆記 - Log Server, MariaDB, nmap">
  <meta property="og:description" content="Log Server 實作
MariaDB 權限與加密, nmap 檢測工具介紹
User ID Report
aureport -u -i --failed | less 1.Write message to syslog BIOS/UEF ➡ grub2 ➡ kernel ➡ systemd ➡ journalctl
rsyslog : 如果選 minimal installation，err不會由rsyslog接，改由journalctl接error接收 將訊息寫入系統紀錄中 @Server
1 root# logger hello World 1 root# tail /var/log/messages 1 root# journalctl 1 root# journalctl --since &#34;2023-04-15&#34; 1 root# reboot 將journalctl紀錄持久化 推書時間: 實戰Linux系統數位鑑識 (江湖海) (Practical Linux Forensics: A guide for digital investigators, by Bruce Nikkel)">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-04-15T09:10:47+08:00">
    <meta property="article:modified_time" content="2023-04-15T09:10:47+08:00">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Security">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Lesson 05: Linux 筆記 - Log Server, MariaDB, nmap">
  <meta name="twitter:description" content="Log Server 實作
MariaDB 權限與加密, nmap 檢測工具介紹
User ID Report
aureport -u -i --failed | less 1.Write message to syslog BIOS/UEF ➡ grub2 ➡ kernel ➡ systemd ➡ journalctl
rsyslog : 如果選 minimal installation，err不會由rsyslog接，改由journalctl接error接收 將訊息寫入系統紀錄中 @Server
1 root# logger hello World 1 root# tail /var/log/messages 1 root# journalctl 1 root# journalctl --since &#34;2023-04-15&#34; 1 root# reboot 將journalctl紀錄持久化 推書時間: 實戰Linux系統數位鑑識 (江湖海) (Practical Linux Forensics: A guide for digital investigators, by Bruce Nikkel)">
<meta name="application-name" content="Ich bin yiwen.">
<meta name="apple-mobile-web-app-title" content="Ich bin yiwen."><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/moon_icon.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://wysiwyz.github.io/posts/lesson_05_linux/" /><link rel="prev" href="http://wysiwyz.github.io/posts/javascript_functions/" /><link rel="next" href="http://wysiwyz.github.io/posts/lesson_06_linux/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Lesson 05: Linux 筆記 - Log Server, MariaDB, nmap",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/wysiwyz.github.io\/posts\/lesson_05_linux\/"
        },"genre": "posts","keywords": "linux, security","wordcount":  1710 ,
        "url": "http:\/\/wysiwyz.github.io\/posts\/lesson_05_linux\/","datePublished": "2023-04-15T09:10:47+08:00","dateModified": "2023-04-15T09:10:47+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "celine"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Ich bin yiwen.">Ich bin yiwen.</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Ich bin yiwen.">Ich bin yiwen.</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Lesson 05: Linux 筆記 - Log Server, MariaDB, nmap</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>celine</a></span>&nbsp;<span class="post-category">included in <a href="/categories/studynote/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>StudyNote</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-04-15">2023-04-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1710 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;9 minutes&nbsp;<span id="/posts/lesson_05_linux/" class="leancloud_visitors" data-flag-title="Lesson 05: Linux 筆記 - Log Server, MariaDB, nmap">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1write-message-to-syslog">1.Write message to syslog</a></li>
        <li><a href="#2-建立簡單-rsyslog-server">2. 建立簡單 Rsyslog Server</a></li>
        <li><a href="#3-syslog-應用">3. Syslog 應用</a></li>
        <li><a href="#4-mariadb-帳號管理">4. MariaDB 帳號管理</a></li>
        <li><a href="#5-mariadb-packet-interception">5. MariaDB packet interception</a></li>
        <li><a href="#6-mariadb-ssl連線加密">6. MariaDB SSL連線加密</a></li>
        <li><a href="#7-mariadb-密碼原則">7. MariaDB 密碼原則</a></li>
        <li><a href="#8-mariadb-稽核">8. MariaDB 稽核</a></li>
        <li><a href="#9-port-掃描">9. Port 掃描</a></li>
        <li><a href="#teleport服務_跳板機">Teleport服務_跳板機</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>Log Server 實作</p>
<p>MariaDB 權限與加密, nmap 檢測工具介紹</p>
</blockquote>
<p>User ID Report</p>
<pre tabindex="0"><code class="language-bash=" data-lang="bash=">aureport -u -i --failed | less
</code></pre><hr>
<h3 id="1write-message-to-syslog">1.Write message to syslog</h3>
<p>BIOS/UEF ➡ grub2 ➡ kernel ➡ systemd ➡ journalctl</p>
<ul>
<li><code>rsyslog</code> : 如果選 minimal installation，err不會由rsyslog接，改由<code>journalctl</code>接error接收</li>
</ul>
<h4 id="將訊息寫入系統紀錄中">將訊息寫入系統紀錄中</h4>
<p>@Server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# logger hello World
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# tail /var/log/messages
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# journalctl
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# journalctl --since <span class="s2">&#34;2023-04-15&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# reboot
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="將journalctl紀錄持久化">將<code>journalctl</code>紀錄持久化</h4>
<blockquote>
<p>推書時間:
實戰Linux系統數位鑑識 (江湖海)
(Practical Linux Forensics: A guide for digital investigators, by Bruce Nikkel)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# journalctl
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>尋找 &ldquo;hello World&rdquo;，會發現找不到</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# grep hello /var/log/messages
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>找得到 hello World</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# mkdir /var/log/journal
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# logger hello world
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# journalctl
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# reboot
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# journalctl
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>找出&quot;hello World&quot;</p>
</blockquote>
<h4 id="自訂記錄等級與標籤">自訂記錄等級與標籤</h4>
<p>@Server
在紀錄中設定<code>class</code>Tag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# logger -t class <span class="s2">&#34;hello myapp log&#34;</span>
</span></span><span class="line"><span class="cl">root# logger -t class -p <span class="s1">&#39;user.err&#39;</span> <span class="s2">&#34;[Error] hello myapp log&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code class="language-bash=" data-lang="bash=">root# grep class /var/log/messages
root# journalctl -t class
</code></pre><p>在紀錄中，設定嚴重等級</p>
<pre tabindex="0"><code class="language-bash!" data-lang="bash!">root# logger -t class -p &#39;user.info&#39; &#34;Test log messages&#34;
root# grep class /var/log/messages
</code></pre><p>使用<code>journalctl</code>找出tag為<code>class</code>的記錄</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# journalctl -t class
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>(screen1)</p>
</blockquote>
<p>使用 <code>journalctl</code> 找出tag為<code>class</code> 且嚴重性為&rsquo;err&rsquo;的記錄</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# journalctl -t class -p err
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>(screen2)</p>
</blockquote>
<hr>
<h3 id="2-建立簡單-rsyslog-server">2. 建立簡單 Rsyslog Server</h3>
<p>安裝 rsyslog 套件</p>
<p>@Desktop, @Server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# dnf install -y rsyslog
</span></span></code></pre></td></tr></table>
</div>
</div><p>@Desktop</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span> /etc/rsyslog.d
</span></span></code></pre></td></tr></table>
</div>
</div><p>設定接收 <code>rsyslog</code> 資訊</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# vi server.conf
</span></span></code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code class="language-bash=" data-lang="bash=">module(load=&#34;imudp&#34;) # needs to be done just once
input(type=&#34;imudp&#34; port=&#34;514&#34;)

module(load=&#34;imtcp&#34;) # needs to be done just once
input(type=&#34;imtcp&#34; 
port=&#34;514&#34;)
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# systemctl restart rsyslog
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# firewall-cmd --permanent --add-port<span class="o">=</span>514/tcp
</span></span><span class="line"><span class="cl">root# firewall-cmd --permanent --add-port<span class="o">=</span>514/udp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root# firewall-cmd --reload
</span></span></code></pre></td></tr></table>
</div>
</div><p>@Server
設定 sysrlog client</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span> /etc/rsyslog.d
</span></span></code></pre></td></tr></table>
</div>
</div><p>設定將 log 使用 TCP 協定傳送到 Desktop</p>
<pre tabindex="0"><code class="language-bash!" data-lang="bash!">root# vi client.conf
</code></pre><pre tabindex="0"><code class="language-bash=" data-lang="bash=">*.* @@172.16.1.X:514
</code></pre><blockquote>
<p>(screenshot3)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# systemctl restart rsyslog
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# logger <span class="s2">&#34;Test message from Server&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>@Desktop, @Server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# less /var/log/messages
</span></span><span class="line"><span class="cl">Apr <span class="m">15</span> 14:19:08 serverb root<span class="o">[</span>5228<span class="o">]</span>: Test message from Server
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h5 id="sudo-su---i-跟-sudo-su-的差別"><code>sudo su -/-i</code> 跟 <code>sudo su</code> 的差別:</h5>
<p>少了減號就不會登入(真正變成)那個user
DigitalOcean: <a href="https://www.digitalocean.com/community/tutorials/how-to-use-journalctl-to-view-and-manipulate-systemd-logs" target="_blank" rel="noopener noreffer ">How To Use Journalctl to View and Manipulate Systemd Logs</a>
NXLog</p>
</blockquote>
<hr>
<h3 id="3-syslog-應用">3. Syslog 應用</h3>
<h4 id="建主-syslog-server">建主 syslog Server</h4>
<p>@Desktop</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# dnf install -y rsyslog
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span> /etc/rsyslog.d/
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# vi server.conf
</span></span></code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code class="language-bash=" data-lang="bash=">module(load=&#34;imudp&#34;) # needs to be done just once
input(type=&#34;imudp&#34; port=&#34;514&#34;)

module(load=&#34;imtcp&#34;) # needs to be done just once
input(type=&#34;imtcp&#34; port=&#34;514&#34;)

$template RemoteLogs,&#34;/var/log/%FROMHOST-IP%/%HOSTNAME%-%$NOW%/%PROGRAMNAME%.log&#34; 
*.* ?RemoteLogs
</code></pre><blockquote>
<p>Ref: <a href="https://www.rsyslog.com/doc/master/configuration/properties.html" target="_blank" rel="noopener noreffer ">https://www.rsyslog.com/doc/master/configuration/properties.html</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# firewall-cmd --permanent --add-port<span class="o">=</span>514/tcp
</span></span><span class="line"><span class="cl">root# firewall-cmd --permanent --add-port<span class="o">=</span>514/udp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root# firewall-cmd --reload
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# systemctl restart rsyslog
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="設定用戶端-client">設定用戶端 Client</h4>
<p>@Server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# dnf install -y rsyslog
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span> /etc/rsyslog.d/
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# vi client.conf
</span></span></code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code class="language-vim=" data-lang="vim=">#*.* @172.16.1.58:514 # Use @ for UDP protocol 
*.* @@172.16.1.58:514 # Use @@ for TCP protocol

&amp; ~
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# systemctl restart rsyslog
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="測試">測試</h4>
<p>@Server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# logger -t linuxclass <span class="s2">&#34;test message from root&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">student$ logger -t linuxclass <span class="s2">&#34;test message from server&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>@Desktop</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# ls -lR /var/log/172.16.2.58/
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="讀取指定檔案內容">讀取指定檔案內容</h4>
<p>@Server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span> /etc/rsyslog.d/
</span></span></code></pre></td></tr></table>
</div>
</div><p>設定 log 檔案，位於 <code>/tmp/applog.txt</code></p>
<pre tabindex="0"><code class="language-bash!" data-lang="bash!">root# touch /tmp/applog.txt
</code></pre><pre tabindex="0"><code class="language-bash!" data-lang="bash!">root# vi 01_watch_log.conf
</code></pre><pre tabindex="0"><code>module(load=&#34;imfile&#34;)

input(type=&#34;imfile&#34;
      File=&#34;/tmp/applog.txt&#34;
      Tag=&#34;mytag:&#34;
      Facility=&#34;local0&#34;)
</code></pre><p>取消 STOP</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# vi client.conf
</span></span></code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code class="language-bash=" data-lang="bash=">#*.* @172.16.1.X:514 # Use @ for UDP protocol 
*.* @@172.16.1.X:514 # Use @@ for TCP protocol
</code></pre><p>測試寫入檔案到 log</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">echo</span> Hello <span class="m">1</span> &gt;&gt; /tmp/applog.txt
</span></span><span class="line"><span class="cl">root# <span class="nb">echo</span> Hello <span class="m">2</span> &gt;&gt; /tmp/applog.txt
</span></span><span class="line"><span class="cl">root# <span class="nb">echo</span> Hello <span class="m">3</span> &gt;&gt; /tmp/applog.txt
</span></span><span class="line"><span class="cl">root# <span class="nb">echo</span> Hello <span class="m">4</span> &gt;&gt; /tmp/applog.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看 Log 是否寫入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# ls -lR /var/log/172.16.2.58/
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="允許特定網段ip通過">💤允許特定網段/IP通過</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo firewall-cmd --add-rich-rule<span class="o">=</span><span class="s1">&#39;rule family=&#34;ipv4&#34; service name=&#34;ssh&#34; source address=&#34;10.10.1.125&#34; accept&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="firewall-cmd-的小史">firewall-cmd 的小史💥</h5>
<pre tabindex="0"><code>           [firewalld]
                 ↓
         [firewall-cmd]
                ↙↘
          (EL7)    (EL8/9)
          ↙          ↘
      [iptables]   [nftables]
          ↘          ↙
        [kernel+notfilter]
</code></pre><hr>
<h3 id="4-mariadb-帳號管理">4. MariaDB 帳號管理</h3>
<blockquote>
<p>MariaDB/MySQL 資料庫實體檔位置 ➡ <code>/var/lib/mysql/</code></p>
</blockquote>
<p>@Desktop</p>
<p>安裝資料庫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# dnf install -y chrony
</span></span><span class="line"><span class="cl">root# systemctl <span class="nb">enable</span> --now chronyd
</span></span><span class="line"><span class="cl">root# timedatectl set-timezone Asia/Taipei
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root# dnf install -y mariadb-server
</span></span><span class="line"><span class="cl">root# systemctl <span class="nb">enable</span> --now mariadb
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root# firewall-cmd --permanent --add-service<span class="o">=</span>mysql
</span></span><span class="line"><span class="cl">root# firewall-cmd --reload
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# mysql_secure_installation
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>密碼設為 <code>rocky</code></p>
</blockquote>
<p>連線資料庫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# mysql -u root -p -h localhost
</span></span></code></pre></td></tr></table>
</div>
</div><p>建立資料庫</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">MariaDB&gt; create database classdb<span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>建立使用者</p>
<pre tabindex="0"><code>MariaDB&gt; GRANT ALL ON classdb.* TO &#39;dbuser&#39;@&#39;172.16.2.58&#39; IDENTIFIED BY &#39;rocky&#39; REQUIRE SSL;
MariaDB&gt; GRANT ALL ON classdb.* TO &#39;user1&#39;@&#39;172.16.2.58&#39; IDENTIFIED BY &#39;rocky&#39;;
</code></pre><p>列出帳號與資庫資訊</p>
<pre tabindex="0"><code>MariaDB&gt; SELECT User, Db, Host from mysql.db;
+--------+---------+---------------+
| User   | Db      | Host          |
+--------+---------+---------------+
| dbuser | classdb | 172.16.2.58  |
+--------+---------+---------------+
1 row in set (0.004 sec)
</code></pre><p>列出使用者權限</p>
<pre tabindex="0"><code>show grants for &#39;dbuser&#39;@&#39;172.16.2.58&#39;;
+-------------------------------------------------------------------------------------------------------------------------------+
| Grants for dbuser@172.16.2.58                                                                                               |
+-------------------------------------------------------------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `dbuser`@`172.16.2.58` IDENTIFIED BY PASSWORD &#39;*128977E278358FF80A246B5046F51043A2B1FCED&#39; REQUIRE SSL  |
| GRANT ALL PRIVILEGES ON `classdb`.* TO `dbuser`@`172.16.2.58`                                                                |
+-------------------------------------------------------------------------------------------------------------------------------+
2 rows in set (0.002 sec)
</code></pre><p>@Server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# dnf install -y mariadb
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">student$ mysql -u dbuser -p -h desktop58
</span></span><span class="line"><span class="cl">FAIL!
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">student$ mysql -u user1 -p -h desktop58
</span></span></code></pre></td></tr></table>
</div>
</div><p>@Desktop</p>
<p>產生稽核語法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">student$ mysql -u root -p -h localhost
</span></span></code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>MariaDB&gt; select distinct concat(&#39;SHOW GRANTS FOR &#39;, QUOTE(user), &#39;@&#39;, QUOTE(host), &#39;;&#39;) as query from mysql.user;
+-------------------------------------------+
| query                                     |
+-------------------------------------------+
| SHOW GRANTS FOR &#39;root&#39;@&#39;127.0.0.1&#39;;       |
| SHOW GRANTS FOR &#39;dbuser&#39;@&#39;172.16.2.58&#39;;    |
| SHOW GRANTS FOR &#39;root&#39;@&#39;::1&#39;;             |
| SHOW GRANTS FOR &#39;root&#39;@&#39;localhost&#39;;       |
+-------------------------------------------+
4 rows in set (0.001 sec)
</code></pre><hr>
<h3 id="5-mariadb-packet-interception">5. MariaDB packet interception</h3>
<h4 id="從-server-查看封包">從 Server 查看封包</h4>
<h5 id="server">Server</h5>
<p>@Terminal-1</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# dnf install -y tcpdump
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# tcpdump host 172.16.1.58 and port <span class="m">3306</span> -X
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="desktop">Desktop</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# dnf install -y tcpdump
</span></span><span class="line"><span class="cl">root# tcpdump port <span class="m">3306</span> -X
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="連線資料庫">連線資料庫</h4>
<p>@Server
@Terminal-2</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# dnf install -y mariadb
</span></span></code></pre></td></tr></table>
</div>
</div><p>@Terminal-2</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# mysql -u user1 -h 172.16.1.58 -p
</span></span><span class="line"><span class="cl">MariaDB&gt; show databases<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MariaDB&gt; use information_schema<span class="p">;</span>
</span></span><span class="line"><span class="cl">MariaDB&gt; show tables<span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>@Desktop</p>
<p>查看 <code>tcpdump</code> 結果</p>
<hr>
<h3 id="6-mariadb-ssl連線加密">6. MariaDB SSL連線加密</h3>
<p>@Desktop</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# mkdir mariadb-ssl<span class="p">;</span> <span class="nb">cd</span> mariadb-ssl
</span></span><span class="line"><span class="cl">root# mkdir ca server client
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="build-ca">Build CA</h4>
<p>建立 RootCA</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span> ca
</span></span><span class="line"><span class="cl">root# ls -lh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root# openssl genrsa <span class="m">4096</span> &gt; ca.key
</span></span><span class="line"><span class="cl">root# openssl req -new -x509 -nodes -days <span class="m">365000</span> -key ca.key -out ca.crt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root# root# ls -lh
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Common Name 設為 <code>DB CA</code></p>
</blockquote>
<h4 id="build-server-certificate">Build server certificate</h4>
<p>建立 Server 用憑證</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# openssl req -newkey rsa:2048 -days <span class="m">3650</span> -nodes -keyout server.key -out server.csr
</span></span><span class="line"><span class="cl">root# openssl rsa -in server.key -out server.key
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Common Name 設為 <code>DB Server</code></p>
</blockquote>
<p>簽署憑證</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# openssl x509 -req -in server.csr -days <span class="m">3650</span> -CA ca.crt -CAkey ca.key -set_serial <span class="m">01</span> -out server.crt
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="build-client-certificate">Build client certificate</h4>
<p>建立用戶端憑證</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# openssl req -newkey rsa:2048 -days <span class="m">3650</span> -nodes -keyout client.key -out client.csr
</span></span><span class="line"><span class="cl">root# openssl rsa -in client.key -out client.key
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Common Name 設為 <code>DB Client</code></p>
</blockquote>
<p>簽署憑證</p>
<pre tabindex="0"><code>root# openssl x509 -req -in client.csr -days 3650 -CA ca.crt -CAkey ca.key -set_serial 01 -out client.crt
</code></pre><h4 id="驗證">驗證</h4>
<p>將簽好的憑證複製到相關目錄</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# openssl verify -CAfile ca.crt server.crt client.crt
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# cp ca.crt ../server
</span></span><span class="line"><span class="cl">root# cp ca.crt ../client
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root# mv server* ../server
</span></span><span class="line"><span class="cl">root# mv client* ../client
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="設定-mariadb-憑證">設定 MariaDB 憑證</h4>
<p>@Desktop</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span> /root/mariadb-ssl
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root# cp -R server /etc/my.cnf.d/ssl/
</span></span><span class="line"><span class="cl">root# chown -R mysql /etc/my.cnf.d/ssl/
</span></span></code></pre></td></tr></table>
</div>
</div><p>套用 Server 憑證</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# cat &gt; /etc/my.cnf.d/50-server.cnf <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">[mysqld]
</span></span></span><span class="line"><span class="cl"><span class="s">ssl-ca=/etc/my.cnf.d/ssl/ca.crt
</span></span></span><span class="line"><span class="cl"><span class="s">ssl-cert=/etc/my.cnf.d/ssl/server.crt
</span></span></span><span class="line"><span class="cl"><span class="s">ssl-key=/etc/my.cnf.d/ssl/server.key
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>重新啟動 MariaDB</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# systemctl restart mariadb
</span></span></code></pre></td></tr></table>
</div>
</div><p>檢查憑證套用成功</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# mysql -u root -p -h localhost
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MariaDB&gt; show variables like <span class="s1">&#39;%ssl%&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Variable_name       <span class="p">|</span> Value                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> have_openssl        <span class="p">|</span> YES                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> have_ssl            <span class="p">|</span> YES                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssl_ca              <span class="p">|</span> /etc/my.cnf.d/ssl/ca.crt         <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssl_capath          <span class="p">|</span>                                  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssl_cert            <span class="p">|</span> /etc/my.cnf.d/ssl/server.crt     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssl_cipher          <span class="p">|</span>                                  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssl_crl             <span class="p">|</span>                                  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssl_crlpath         <span class="p">|</span>                                  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssl_key             <span class="p">|</span> /etc/my.cnf.d/ssl/server.key     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> version_ssl_library <span class="p">|</span> OpenSSL 1.1.1g FIPS  <span class="m">21</span> Apr <span class="m">2020</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="m">10</span> rows in <span class="nb">set</span> <span class="o">(</span>0.003 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MariaDB&gt; create database classdb<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MariaDB&gt; GRANT ALL ON classdb.* TO <span class="s1">&#39;dbuser&#39;</span>@<span class="s1">&#39;172.16.2.X&#39;</span> IDENTIFIED BY <span class="s1">&#39;rocky&#39;</span> REQUIRE SSL<span class="p">;</span>
</span></span><span class="line"><span class="cl">MariaDB&gt; GRANT ALL ON classdb.* TO <span class="s1">&#39;dbuser2&#39;</span>@<span class="s1">&#39;172.16.2.X&#39;</span> IDENTIFIED BY <span class="s1">&#39;rocky&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MariaDB&gt; exit<span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="client-端連線">Client 端連線</h4>
<p>@Server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# mkdir ~/client/
</span></span></code></pre></td></tr></table>
</div>
</div><p>@Desktop</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span> /root/mariadb-ssl/client
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root# <span class="nb">echo</span> <span class="s2">&#34;PUT * &#34;</span> <span class="p">|</span> sftp root@server58:/root/client
</span></span></code></pre></td></tr></table>
</div>
</div><p>@Server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span>
</span></span><span class="line"><span class="cl">root# ls -lh client
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# dnf install -y chrony
</span></span><span class="line"><span class="cl">root# systemctl <span class="nb">enable</span> --now chronyd
</span></span><span class="line"><span class="cl">root# timedatectl set-timezone Asia/Taipei
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# cp -R client /etc/my.cnf.d/ssl/
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# vi /etc/my.cnf.d/client.cnf
</span></span></code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code class="language-=" data-lang="=">在 [client] 區段中新增

...
[client]
ssl-ca=/etc/my.cnf.d/ssl/ca.crt
ssl-cert=/etc/my.cnf.d/ssl/client.crt
ssl-key=/etc/my.cnf.d/ssl/client.key
</code></pre><pre tabindex="0"><code>root# mysql -u dbuser -h 172.16.1.X -p 

MariaDB&gt; status;
--------------
mysql  Ver 15.1 Distrib 10.3.28-MariaDB, for Linux (x86_64) using readline 5.1

Connection id:		14
Current database:	
Current user:		dbuser@172.16.62.105
SSL:			Cipher in use is TLS_AES_256_GCM_SHA384
Current pager:		stdout
Using outfile:		&#39;&#39;
Using delimiter:	;
Server:			MariaDB
Server version:		10.3.28-MariaDB MariaDB Server
Protocol version:	10
Connection:		172.16.62.5 via TCP/IP
Server characterset:	latin1
Db     characterset:	latin1
Client characterset:	utf8
Conn.  characterset:	utf8
TCP port:		3306
Uptime:			24 min 23 sec

Threads: 6  Questions: 18  Slow queries: 0  Opens: 18  Flush tables: 1  Open tables: 11  Queries per second avg: 0.012
--------------
</code></pre><h4 id="連線時指定憑證位置">連線時指定憑證位置</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# vi /etc/my.cnf.d/client.cnf
</span></span></code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code class="language-=" data-lang="=">在 [client] 區段中移除

...
[client]
#ssl-ca=/etc/my.cnf.d/ssl/ca.crt
#ssl-cert=/etc/my.cnf.d/ssl/client.crt
#ssl-key=/etc/my.cnf.d/ssl/client.key
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span> client
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# mysql -u dbuser -h 172.16.1.58 -p --ssl-ca<span class="o">=</span>ca.crt --ssl-cert<span class="o">=</span>client.crt --ssl-key<span class="o">=</span>client.key
</span></span></code></pre></td></tr></table>
</div>
</div><p>參考 <a href="#5.-MariaDB-packet-interception" rel="">5.MariaDB 封包截取</a> 驗證加密後結果。</p>
<hr>
<h3 id="7-mariadb-密碼原則">7. MariaDB 密碼原則</h3>
<h4 id="參考文件">參考文件</h4>
<p><a href="https://mariadb.com/kb/en/simple-password-check-plugin/" target="_blank" rel="noopener noreffer ">Simple Password Check Plugin</a></p>
<h4 id="desktop-1">Desktop</h4>
<h5 id="啟用模組">啟用模組</h5>
<p>修改 /etc/my.cnf.d/mariadb-server.cnf，在 [mysqld] 區段中，填入</p>
<pre tabindex="0"><code>plugin_load_add = simple_password_check
</code></pre><blockquote>
<p>(screen_shot)</p>
</blockquote>
<h5 id="查看規則">查看規則</h5>
<p>@Desktop</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# mysql -u root -p -h localhost
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; show variables like <span class="s1">&#39;%simple_password%&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">+-----------------------------------------+-------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Variable_name                           <span class="p">|</span> Value <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-----------------------------------------+-------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> simple_password_check_digits            <span class="p">|</span> <span class="m">1</span>     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> simple_password_check_letters_same_case <span class="p">|</span> <span class="m">1</span>     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> simple_password_check_minimal_length    <span class="p">|</span> <span class="m">8</span>     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> simple_password_check_other_characters  <span class="p">|</span> <span class="m">1</span>     <span class="p">|</span>
</span></span><span class="line"><span class="cl">+-----------------------------------------+-------+
</span></span><span class="line"><span class="cl"><span class="m">4</span> rows in <span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="驗證規則">驗證規則</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; <span class="k">select</span> user,host from mysql.user<span class="p">;</span>
</span></span><span class="line"><span class="cl">+---------+-------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> user    <span class="p">|</span> host        <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------+-------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> root    <span class="p">|</span> 127.0.0.1   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> dbuser  <span class="p">|</span> 172.16.2.X  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> dbuser2 <span class="p">|</span> 172.16.2.X  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> user1   <span class="p">|</span> 172.16.2.X  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> root    <span class="p">|</span> ::1         <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> root    <span class="p">|</span> localhost   <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------+-------------+
</span></span><span class="line"><span class="cl"><span class="m">6</span> rows in <span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; SET PASSWORD FOR <span class="s1">&#39;user1&#39;</span>@<span class="s1">&#39;172.16.2.X&#39;</span> <span class="o">=</span> PASSWORD<span class="o">(</span><span class="s1">&#39;abc&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">ERROR <span class="m">1819</span> <span class="o">(</span>HY000<span class="o">)</span>: Your password does not satisfy the current policy requirements
</span></span><span class="line"><span class="cl">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; SET PASSWORD FOR <span class="s1">&#39;user1&#39;</span>@<span class="s1">&#39;172.16.2.X&#39;</span> <span class="o">=</span> PASSWORD<span class="o">(</span><span class="s1">&#39;rocky&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">ERROR <span class="m">1819</span> <span class="o">(</span>HY000<span class="o">)</span>: Your password does not satisfy the current policy requirements
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="8-mariadb-稽核">8. MariaDB 稽核</h3>
<h4 id="參考文件-1">參考文件</h4>
<blockquote>
<p><a href="https://mariadb.com/kb/en/mariadb-audit-plugin/" target="_blank" rel="noopener noreffer ">MariaDB Audit Plugin</a></p>
</blockquote>
<h4 id="啟用稽核模組與設定">啟用稽核模組與設定</h4>
<p>@Desktop</p>
<pre tabindex="0"><code class="language-bash!" data-lang="bash!">root# cp -a /etc/my.cnf.d/mariadb-server.cnf{,_backup}
</code></pre><pre tabindex="0"><code class="language-bash!" data-lang="bash!">root# vi /etc/my.cnf.d/mariadb-server.cnf
</code></pre><pre tabindex="0"><code class="language-=" data-lang="=">在 mysqld 區段加入
...

plugin_load_add = server_audit
server_audit_logging = ON
server_audit=FORCE_PLUS_PERMANENT
server_audit_events=connect,query
server_audit_file_path=/var/lib/mysql/server_audit.log
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# systemctl restart mariadb
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="測試-1">測試</h4>
<p>@Server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# <span class="nb">cd</span> ~/client
</span></span><span class="line"><span class="cl">root# mysql -u dbuser -h 172.16.1.38 -p --ssl-ca<span class="o">=</span>ca.crt --ssl-cert<span class="o">=</span>client.crt --ssl-key<span class="o">=</span>client.key
</span></span></code></pre></td></tr></table>
</div>
</div><p>@Desktop</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# /var/lib/mysql/server_audit.log
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="9-port-掃描">9. Port 掃描</h3>
<ol>
<li>
<p>掃描 TCP</p>
<pre tabindex="0"><code>root# nmap -p- server58
</code></pre></li>
<li>
<p>掃描 UDP</p>
<pre tabindex="0"><code>root# nmap -sU -p- server58
</code></pre><blockquote>
<p>這個掃描會很久</p>
</blockquote>
</li>
<li>
<p>猜測作業系統版本</p>
<pre tabindex="0"><code>root# nmap -O server58
</code></pre><blockquote>
<p>(&hellip;Nmap scan report..)</p>
</blockquote>
</li>
<li>
<p>掃描 server58 中開了哪些 1024 以下的 TCP Port，並列出作業系統</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root# nmap -p0-1024 -O server58
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<blockquote>
<h3 id="teleport服務_跳板機">Teleport服務_跳板機</h3>
<p>Teleport(<a href="https://goteleport.com" target="_blank" rel="noopener noreffer ">https://goteleport.com</a>)</p>
</blockquote>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-04-15</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://wysiwyz.github.io/posts/lesson_05_linux/" data-hashtag="linux"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://wysiwyz.github.io/posts/lesson_05_linux/" data-title="Lesson 05: Linux 筆記 - Log Server, MariaDB, nmap"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/linux/">Linux</a>,&nbsp;<a href="/tags/security/">Security</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/javascript_functions/" class="prev" rel="prev" title="JavaScript 常見內建方法"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>JavaScript 常見內建方法</a>
            <a href="/posts/lesson_06_linux/" class="next" rel="next" title="Lesson 06: Linux 筆記 - Shell Script! final">Lesson 06: Linux 筆記 - Shell Script! final<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">strict with yourself; lenient with others.</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><script type="text/javascript" src="https://.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"valine":{"appId":"","appKey":"","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"en","pageSize":10,"placeholder":"Your comment ...","recordIP":true,"visitor":true}},"twemoji":true};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-CCS3QPVY5N', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-CCS3QPVY5N" async></script></body>
</html>
