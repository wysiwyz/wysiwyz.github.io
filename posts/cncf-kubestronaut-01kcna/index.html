<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta name="google-adsense-account" content="ca-pub-6504473922193740">
        <title>01 Kubestronaut KCNA &amp; KCSA - Ich bin yiwen.</title><meta name="Description" content="An ordinary space for storing and groups pieces of articles."><meta property="og:url" content="http://wysiwyz.github.io/posts/cncf-kubestronaut-01kcna/">
  <meta property="og:site_name" content="Ich bin yiwen.">
  <meta property="og:title" content="01 Kubestronaut KCNA & KCSA">
  <meta property="og:description" content="KCSA Infrastructure Security summary
Isolate critical applications on separate server for better security Restrict Docker port access with firewall rules and policies Apply least privilege to containers and secure Kubernetes dashboard Store sensitive data securely using Kubernetes secrets and RBAC Encrypt etcd data and use TLS authentication for protection Kubernetes Isolation Techniques Multi Tenancy with namespaces: different teams or project can use the same cluster without interfereing with others. Each team or project has its own namespace.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-29T11:04:30+08:00">
    <meta property="article:modified_time" content="2024-11-29T11:04:30+08:00">
    <meta property="article:tag" content="Cloud Native">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="KCSA">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="01 Kubestronaut KCNA & KCSA">
  <meta name="twitter:description" content="KCSA Infrastructure Security summary
Isolate critical applications on separate server for better security Restrict Docker port access with firewall rules and policies Apply least privilege to containers and secure Kubernetes dashboard Store sensitive data securely using Kubernetes secrets and RBAC Encrypt etcd data and use TLS authentication for protection Kubernetes Isolation Techniques Multi Tenancy with namespaces: different teams or project can use the same cluster without interfereing with others. Each team or project has its own namespace.">
<meta name="application-name" content="Ich bin yiwen.">
<meta name="apple-mobile-web-app-title" content="Ich bin yiwen."><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/moon_icon.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://wysiwyz.github.io/posts/cncf-kubestronaut-01kcna/" /><link rel="prev" href="http://wysiwyz.github.io/posts/kong-hq-academy/" /><link rel="next" href="http://wysiwyz.github.io/posts/kk_learn_by_doing_apache_kafka/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "01 Kubestronaut KCNA \u0026 KCSA",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/wysiwyz.github.io\/posts\/cncf-kubestronaut-01kcna\/"
        },"genre": "posts","keywords": "Cloud Native, Kubernetes, KCSA","wordcount":  6007 ,
        "url": "http:\/\/wysiwyz.github.io\/posts\/cncf-kubestronaut-01kcna\/","datePublished": "2024-11-29T11:04:30+08:00","dateModified": "2024-11-29T11:04:30+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Author"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Ich bin yiwen.">Ich bin yiwen.</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Ich bin yiwen.">Ich bin yiwen.</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">01 Kubestronaut KCNA & KCSA</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Author</a></span>&nbsp;<span class="post-category">included in <a href="/categories/studynote/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>StudyNote</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-11-29">2024-11-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;6007 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;29 minutes&nbsp;<span id="/posts/cncf-kubestronaut-01kcna/" class="leancloud_visitors" data-flag-title="01 Kubestronaut KCNA &amp; KCSA">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#kcsa">KCSA</a>
      <ul>
        <li><a href="#infrastructure-security">Infrastructure Security</a></li>
        <li><a href="#kubernetes-isolation-techniques">Kubernetes Isolation Techniques</a></li>
        <li><a href="#workload-and-application-code-security">Workload and Application Code Security</a></li>
        <li><a href="#api-server">Api Server</a></li>
        <li><a href="#securing-controller-manager-and-scheduler">Securing Controller Manager and Scheduler</a></li>
        <li><a href="#securing-kubelet">Securing Kubelet</a></li>
        <li><a href="#securing-kube-proxy">Securing kube proxy</a></li>
        <li><a href="#pod-security">Pod Security</a></li>
        <li><a href="#securing-etd">Securing ETD</a></li>
        <li><a href="#secure-container-networking">Secure container networking</a></li>
        <li><a href="#client-security---kubectl-proxy-port-forward">Client Security - kubectl proxy port forward</a></li>
        <li><a href="#pod-security-standards-and-pod-security-admissions">Pod Security Standards and Pod Security Admissions</a></li>
        <li><a href="#isolation-and-segmentation---resourcequota--limits">Isolation and Segmentation - ResourceQuota &amp; Limits</a></li>
        <li><a href="#audit-logs">Audit logs</a></li>
      </ul>
    </li>
    <li><a href="#kubernetes-threat-model">Kubernetes Threat Model</a>
      <ul>
        <li><a href="#kubernetes-trust-boundaries-and-data-flow">Kubernetes Trust Boundaries and Data Flow</a></li>
        <li><a href="#persistence">Persistence</a></li>
        <li><a href="#denial-of-service">Denial of Service</a></li>
        <li><a href="#melicious-code-execution">Melicious Code Execution</a></li>
        <li><a href="#compromised-applications-in-containers">Compromised Applications in Containers</a></li>
        <li><a href="#attacker-on-the-network">Attacker on the Network</a></li>
        <li><a href="#access-to-sensitive-data">Access to Sensitive Data</a></li>
      </ul>
    </li>
    <li><a href="#platform-security">Platform Security</a>
      <ul>
        <li><a href="#supply-chain-security---minimize-base-image-footprint">Supply Chain Security - Minimize base image footprint</a></li>
        <li><a href="#supply-chain-security---scan-images-for-known-vulnerabilities">Supply Chain Security - Scan images for known vulnerabilities</a></li>
        <li><a href="#image-repository-security">Image Repository Security</a></li>
        <li><a href="#observability---overview">Observability - Overview</a></li>
        <li><a href="#observability---falco-overview-and-installation">Observability - Falco Overview and Installation</a></li>
        <li><a href="#observability---using-falco-to-detect-threats">Observability - Using Falco to Detect Threats</a></li>
        <li><a href="#service-mesh---monolithics-vs-microservices">Service Mesh - Monolithics vs Microservices</a></li>
        <li><a href="#service-mesh">Service Mesh</a></li>
        <li><a href="#service-mesh---istio">Service Mesh - Istio</a></li>
        <li><a href="#service-mesh---security-in-istio">Service Mesh - Security in Istio</a></li>
        <li><a href="#service-mesh---istio-security-architecture">Service Mesh - Istio Security Architecture</a></li>
        <li><a href="#k8s-pki---certificate-creation">K8s PKI - certificate creation</a></li>
        <li><a href="#k8s-pki---view-certificate-details">K8s PKI - view certificate details</a></li>
        <li><a href="#connectivity---tls-intro">Connectivity - TLS intro</a></li>
        <li><a href="#connectivity---tls-basics">Connectivity - TLS basics</a></li>
        <li><a href="#connectivity---tls-in-kubernetes">Connectivity - TLS in Kubernetes</a></li>
        <li><a href="#connectivity---mutual-tls">Connectivity - Mutual TLS</a></li>
        <li><a href="#admission-controllers">Admission Controllers</a></li>
      </ul>
    </li>
    <li><a href="#compliance-and-security-framework">Compliance and security framework</a>
      <ul>
        <li><a href="#compliance-frameworks">Compliance Frameworks</a></li>
        <li><a href="#threat-modelling-frameworks">Threat Modelling Frameworks</a></li>
        <li><a href="#supply-chain-compliance">Supply Chain Compliance</a></li>
        <li><a href="#automation-and-tooling">Automation and Tooling</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="kcsa">KCSA</h2>
<h3 id="infrastructure-security">Infrastructure Security</h3>
<p>summary</p>
<ol>
<li>Isolate critical applications on separate server for better security</li>
<li>Restrict Docker port access with firewall rules and policies</li>
<li>Apply least privilege to containers and secure Kubernetes dashboard</li>
<li>Store sensitive data securely using Kubernetes secrets and RBAC</li>
<li>Encrypt etcd data and use TLS authentication for protection</li>
</ol>
<h3 id="kubernetes-isolation-techniques">Kubernetes Isolation Techniques</h3>
<p><strong>Multi Tenancy</strong> with namespaces: different teams or project can use the same cluster without interfereing with others. Each team or project has its own namespace.</p>
<p><strong>Network Policies</strong> allow us to define role regarding which components can talk to each other.</p>
<p><strong>RBAC</strong> ensures that developer has only read access permission to production ns and full access to the development ns. Team A only has access to namespace A resources and team B only has access to namespace B resource.</p>
<p>Resource Quotas and Limits ensures that each component gets a fair share of resources.</p>
<h3 id="workload-and-application-code-security">Workload and Application Code Security</h3>
<p>Container - Let&rsquo;s say a team use containeriation for the benefit of portability, scalability, consistency, isolation and security. Popular artifact repository supports image signing, enhanced access control, integrated vulnerability scaning, such as JFrog, Nexus Repository, GitHub Packages.</p>
<p>Code - SQL injection attacks, use SonarQube to detect problematic code. Use OWASP dependency checking tool. Gaining insight into containerized application is essential. This is where tools lik Sysdig come into as a solution. Sysdig provides deep visibility into containerized environment, which allows you to monitor resrouce usage, detect anomalies, and troubleshoot issues in real time. With Sysdig, you can quickly pinpoint which container or process is causing high CPU or memory usage, can track down problematic workloads, and even inspect live system calls.</p>
<table>
<thead>
<tr>
<th>4 C&rsquo;s</th>
<th>best practices</th>
</tr>
</thead>
<tbody>
<tr>
<td>Code</td>
<td></td>
</tr>
<tr>
<td>Container</td>
<td>Restrict Images, Supply Chain, Sandboxing, Privileged</td>
</tr>
<tr>
<td>Cluster</td>
<td>Authentication Authorization, Admission, Network Policy</td>
</tr>
<tr>
<td>Cloud</td>
<td>Data Center, Network, Servers</td>
</tr>
</tbody>
</table>
<h3 id="api-server">Api Server</h3>
<p>Who can access the api-server?</p>
<ul>
<li>Files - Username and passwords</li>
<li>Files - username and tokens</li>
<li>Certificates</li>
<li>External Authentication providers - LDAP</li>
<li>Service Accounts</li>
</ul>
<p>What can they (api-server) do?</p>
<ul>
<li>RBAC authorization</li>
<li>ABAC authorization</li>
<li>Node authorization</li>
<li>Webhook Mode</li>
</ul>
<h3 id="securing-controller-manager-and-scheduler">Securing Controller Manager and Scheduler</h3>
<p>summary</p>
<ol>
<li>Isolate controller manager and scheduler on separate dedicated nodes</li>
<li>Use RBAC to limit permissions of controller manager and  scheduler</li>
<li>Encrypt communications between components using TLS for security</li>
<li>Enable audit logging to track and review all actions taken</li>
<li>Secure default settings and protect the configuration files</li>
<li>Run the latest version of Kubernetes</li>
<li>Regularly scan for vulnerabilities</li>
</ol>
<h3 id="securing-kubelet">Securing Kubelet</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># kubelet.service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">ExecStart=/usr/local/bin/kubelet \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>--<span class="l">container-runtime=docker \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>--<span class="l">image-pull-progress-deadline=2m \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>--<span class="l">kubeconfig=/var/lib/kubelet/kubeconfig \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>--<span class="l">network-plugin=cni \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>--<span class="l">register-node=true \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>--<span class="l">v=2 \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>--<span class="l">config=/var/lib/kubelet/kubelet-config.yaml</span><span class="w"> </span><span class="c"># add</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  --cluster-domain=cluster.local \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  --file-check-frequency=0s \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  --healthz-port=10248 \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  --cluster-dns=10.96.0.10 \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  --http-check-frequency=0s \\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  --sync-frequency=0s</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Above is how the kubelet service configuration file was originally, but with the release of version 1.10, most of these parameters were moved to another file called the kubelet config file for ease of deployment and configuration management. The object created within the file is named kubelet configuration.</p>
<p>On the kubelete service config file, we pass the path to this file as a command line argument named config. Note that within the file, the parameters use camel case. So all dashes that separate words in the previous implementation are removed and words are written without spaces, and the first letter of each word is capitalized except the first word, see below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubelet.config.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">KubeletConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">clusterDomain</span><span class="p">:</span><span class="w"> </span><span class="l">cluster.local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">fileCheckFrequency</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">healthzPort</span><span class="p">:</span><span class="w"> </span><span class="m">10248</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">clusterDNS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="m">10.96.0.10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">httpCheckFrequency</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">syncFrequency</span><span class="p">:</span><span class="w"> </span><span class="l">0s</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>If you specify a flag both in the service configuration file or on the command line as well as in the file in the kubelet configuration file, then the flag specified on the command line will override whatever is in this file.</p>
<p>Let&rsquo;s say there are a large number of  worker nodes, instead of manually creating these kubelet config files in each of those worker nodes, the kubdadm tool can help in automatically configuring the kubelet files on those nodes when you run the kubeadm join command.</p>
<h4 id="view-kubelet-options">View kubelet options</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ps -aux <span class="p">|</span> grep kubelet
</span></span><span class="line"><span class="cl">car /var/lib/kubelet/config.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="kubelet---security">Kubelet - Security</h4>
<p>The kubelet serves on two ports: port 10250, which is where the kubelet serves the API server that allows full access. And port 10255, which serves an API that allows an authenticated, unauthorized read-only access. By default, the kubelet allows anonymous access to its API.</p>
<table>
<thead>
<tr>
<th>port</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>10250</td>
<td>Serves API that allows full access</td>
</tr>
<tr>
<td>10255</td>
<td>Serves API that allows unauthenticated read-only access</td>
</tr>
</tbody>
</table>
<p>Anyone that knows the IP address of these hosts can access these APIs to perform anything that the API server can do, such as viewing existing pods, creating new pods, execing into existing pods or viewing usage metrics and stats and logs and more.</p>
<p>How to prevent possible security issues? How to implement security on the kubelet? Any request that comes to the kubelet is first authenticated and then authorized.  The authorization process decides what areas of the API can the user access and what operations can they perform.</p>
<h4 id="set---anonymous-authfalse">Set <code>--anonymous-auth=false</code></h4>
<p>You can disable anonymous user by setting anonymous auth flag to false in a kubelete service configuration file.  Also you can set anonymous enabled to false in a KubeletConfiguration file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubelet.config.k8s.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">KubeletConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">authentication</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">anonymous</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Summary</p>
<ol>
<li>Regularly update and patch container runtimes to fix vulnerabilities</li>
<li>Run containers with least privileges to minimize security risks</li>
<li>Use read-only filesystems to prevent unauthorized filesystem modifications</li>
<li>Limit resource usage to prevent denial-of-service (DoS) attacks</li>
<li>Apply security profiles like SELinux and AppArmer for protection</li>
<li>Transition to supported runtimes like containered or CRI-O</li>
<li>Implement monitoring and logging for runtime behavior detection</li>
</ol>
<h3 id="securing-kube-proxy">Securing kube proxy</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># to locate the kube-proxy config file</span>
</span></span><span class="line"><span class="cl">ps -ef <span class="p">|</span> grep kube-proxy
</span></span><span class="line"><span class="cl">...... /usr/local/bin/kube-proxy --config<span class="o">=</span>/var/lib/kube-proxy/config.conf --hostname-override<span class="o">=</span>controlplane
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat /var/lib/kube-proxy/config.conf
</span></span><span class="line"><span class="cl">apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span><span class="line"><span class="cl">bindAddress: 0.0.0.0
</span></span><span class="line"><span class="cl">bindAddressHardFail: <span class="nb">false</span>
</span></span><span class="line"><span class="cl">clientConnection:
</span></span><span class="line"><span class="cl">  acceptContentTypes: <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">  burst: <span class="m">0</span>
</span></span><span class="line"><span class="cl">  contentType: <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">  kubeconfig: /var/lib/kube-proxy/kubeconfig.conf
</span></span><span class="line"><span class="cl">  qps: <span class="m">0</span>
</span></span><span class="line"><span class="cl">clusterCIDR: 127.17.0.0/16
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># check the permission - must be 644 or stricter, only the own can edit the file</span>
</span></span><span class="line"><span class="cl">stat -c %a /var/lib/kube-proxy/kubeconfig.conf
</span></span><span class="line"><span class="cl"><span class="m">644</span>
</span></span><span class="line"><span class="cl"><span class="c1"># check the ownership (file owner and group)</span>
</span></span><span class="line"><span class="cl">stat -c %U:%G /var/lib/kube-proxy/kubeconfig.conf
</span></span><span class="line"><span class="cl">root:root
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="securing-communication">Securing communication</h4>
<p>Secure communication between cube-proxy and the API server is crucial.</p>
<p>The file path at <code>clusters[*].cluster.certificate-authority</code> is use to validate the API server&rsquo;s TLS certificate. The kube-proxy itself uses a service-account token to authenticate to the kube api server. We need to ensure that this communicated is encrypted using TLS to avoid eavesdropping and tempering (竊聽和篡改).</p>
<p>Another step to make sure is that audit logs are enabled. In K8s,  audit logs enables all actions performed by that service (in this case kube-proxy service) to track changes and identify unauthorized access, so it&rsquo;s important that we regularly review these logs that helps in detecting and addressing suspicious activities.</p>
<p>Summary</p>
<ol>
<li>Secure kube-proxy config file with strict permissions</li>
<li>Encrypt API server communication using TLS and service accounts</li>
<li>Run kube-proxy with least privileges necessary</li>
<li>Implement network policies for traffic control (If necessary)</li>
<li>Use logging and monitoring for detecting anomalies</li>
<li>Regularly update and patch kube-proxy for security</li>
<li>Enable audit logs to track kube-proxy actions</li>
</ol>
<h3 id="pod-security">Pod Security</h3>
<p>Pod Security Policy (PSP) was removed as  of version 1.25 in Kubernetes and is replaced by Pod Security Admission (PSA) and Pod Security Standards (PSS), which was promoted to being stable in version 1.25.</p>
<p>Basic idea of how PSP works:</p>
<p>When PSP is enabled, the Pod Security Policy Admission Controller observes all Pod creation requests and validates the configuration against the set of pre-configured rules. If it detects a violation of the rule, then that request to create the Pod is rejected and the user receives an error message.</p>
<p>To enable Pod Security Admission, we added to the enable admission plugins flag (<code>--enable-admission-plugins</code>).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># at /etc/kubernetes/manifests/kube-apiserver.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">kube-apiserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">authorization-mode=Node,RBAC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">advertise-address=172.17.0.107</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">allow-privileged=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">enable-bootstrap-token-auth=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">enable-admission-plugins=PodSecurityPolicy</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="define-pod-security-policy">Define Pod Security Policy</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">policy/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PodSecurityPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-psp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">seLinux</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l">RunAsAny</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">supplementalGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l">RunAsAny</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;MustRunAsNonRoot&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># fsGroup:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 	rule: RunAsAny</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">requiredDropCapabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s1">&#39;CAP_SYS_BOOT&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">defaultAddCapabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s1">&#39;CAP_SYS_TIME&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s1">&#39;persistentVolumeClaim&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>[kubectl] ➡️ [Authentication] ➡️ [Authorization] ➡️ [Admission Controllers - PodSecurityPolicy] ➡️ Create POD</p>
<h4 id="challenges">Challenges</h4>
<p>PodSecurityPolicy is not enabled by default. If you were to enable Pod Security Policies in a cluster, you have to make sure that appropriate policies are created in advance. Also it&rsquo;s complex as you need to bind PSP to roles and bindings.</p>
<h3 id="securing-etd">Securing ETD</h3>
<h4 id="enabling-data-encryption-at-rest">Enabling Data Encryption at Rest</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">EncryptionConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apiserver.config.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span>- <span class="l">secrets</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">providers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span>- <span class="nt">aescbc</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="nt">keys</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">key1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	      </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;base64-encoded-encryption-key&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span>- <span class="nt">identity</span><span class="p">:</span><span class="w"> </span>{}<span class="w"> </span><span class="c"># in case of aescbc can&#39;t be found</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>Specifies the type of k8s object: EncryptionConfiguration</li>
<li>Specifies the k8s API version: apiserver.config.k8s.io/v1</li>
<li>Lists the resources to be encrypted, like secrets</li>
<li>Defines encryption providers, using aescbc as the algorithm</li>
</ol>
<h4 id="generate-the-encryption-key">Generate the encryption key</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">openssl rand -base64 <span class="m">32</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After kubectl apply and created the encryption object, we need to update the etcd pod specification file to use the encryption configuration file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">etcd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">k8s.gcr.io/etcd:3.4.13-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">etcd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">......</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- --<span class="l">encryption-provider-config=/path/to/encryption-config.yaml</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="user-tls-for-secure-communication-the-data-in-transit--at-movement">User TLS for Secure Communication (the data in transit / at movement)</h4>
<p><code>--cert-file</code>: Specifies the server&rsquo;s certificate file for secure identity presentation</p>
<p><code>--key-file</code>: Specifies the server&rsquo;s key file used with the certificate</p>
<p><code>--client-cert-auth</code> : Enables client certificate authentication to allow only trusted clients</p>
<p><code>--trusted-ca-file</code>: Specifies the CA certificate for verifying client certificates</p>
<p>``&ndash;peer-cert-file`: for secure peer-to-peer communication</p>
<p><code>--peer-key-file</code></p>
<p><code>--peer-client-cert-auth</code></p>
<p><code>--peer-trusted-ca-file</code></p>
<h4 id="regular-backups">Regular Backups</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nv">ETCDCTL_API</span><span class="o">=</span><span class="m">3</span> etcdctl snapshot save /path/to/backup.db <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --endpoints<span class="o">=</span>&lt;etcd-endpoints&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --cacert<span class="o">=</span>/path/to/ca.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --cert<span class="o">=</span>/path/to/etcd-client.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --key<span class="o">=</span>/path/to/etcd-client.key
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>Specify the etcdctl API version to use (version 3)</li>
<li>Command to take a snapshot of the etcd data</li>
<li>Path where the backup file will be saved</li>
<li>Specify the etcd endpoints to connect to</li>
<li>Path to the CA certificate used to verify the etcd server certificate</li>
<li>Path to the client certificate used to authenticate the client</li>
<li>Path to the client key used to authenticate the client</li>
</ol>
<h4 id="summary">Summary</h4>
<ol>
<li>Enable data encryption at rest for etcd security</li>
<li>Use TLS to secure etcd communication</li>
<li>Regularly back up etcd data for recovery</li>
</ol>
<h3 id="secure-container-networking">Secure container networking</h3>
<p>Implement networkPolicies to restrict pod to pod communication</p>
<p>Use service meshes</p>
<ul>
<li>Istio, Linkerd to enforce mutual TLS, to ensure that all communication between services is encrypted and authenticated, which significantly reduces the risk of man-in-the-middle attacks</li>
</ul>
<p>Encrypting Network Traffic</p>
<ul>
<li>Use a CNI plugin like Calico to enable IPsec encryption for network traffic, which ensures that all data transferred between nodes is encrypted</li>
</ul>
<p>Isolating sensitive workloads</p>
<ul>
<li>Using namespaces or network policies to help contain potentical security breaches</li>
</ul>
<h4 id="summary-1">Summary</h4>
<ol>
<li>Implement network policies to control pod traffic flow</li>
<li>Use service meshes for encrypted, secure service communication</li>
<li>Encrypt network traffic between containers using IPsec or WireGuard</li>
<li>Isolate sensitive workloads with namespaces and network policies</li>
</ol>
<h3 id="client-security---kubectl-proxy-port-forward">Client Security - kubectl proxy port forward</h3>
<p>user details and credentials stored in kubeconfig file (<code>~/.kube/config</code>)</p>
<p>Through port 6443 using curl using certificate files</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl http://&lt;kube-api-server-ip&gt;:6443 -k
</span></span><span class="line"><span class="cl">  --key admin.key
</span></span><span class="line"><span class="cl">  --cert admin.crt
</span></span><span class="line"><span class="cl">  --cacert ca.crt
</span></span></code></pre></td></tr></table>
</div>
</div><p>Alternative option: start kubectl proxy client</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl proxy
</span></span><span class="line"><span class="cl">Starting to servce on 127.0.0.1:9001
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">curl http://localhost:8001 -k
</span></span></code></pre></td></tr></table>
</div>
</div><p>The kube proxy client launch a proxy service locally on port 8001 by default, and used the credentials and certificates from your cube-config file to access the cluster. Remember that the proxy only runs on your laptop and is only accessible within your laptop.</p>
<h4 id="kubectl-port-forward">Kubectl port forward</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl port-forward service/nginx 28080:80
</span></span><span class="line"><span class="cl">kubectl port-forward --help
</span></span></code></pre></td></tr></table>
</div>
</div><p>Summary</p>
<ol>
<li>Encrypt data at rest and in transit for protection</li>
<li>Implement RBAC to control access to storage resources</li>
<li>Use Storage Classes to enforce security and performance policies</li>
<li>Regularly back up data and have a disaster recovery plan</li>
<li>Monitor and audit storage access for compliance and security</li>
</ol>
<h3 id="pod-security-standards-and-pod-security-admissions">Pod Security Standards and Pod Security Admissions</h3>
<p>KEP 2579 PSP replacement</p>
<p>PodSecurityAdmissionController</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -n kube-system kube-apiserver-controlplane -it -- kube-apiserver -h <span class="p">|</span> grep enable-admission-plugins
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="configure-psa">Configure PSA</h4>
<p>PSA is namespace scoped. This means you can label a namespace with PSA mode and security standard using below command syntax.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl label ns payroll pod-security.kubernetes.io/&lt;mode&gt;<span class="o">=</span>&lt;security standard&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># examples of label key and value</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>Key<span class="o">]</span>
</span></span><span class="line"><span class="cl">pod-security.kubernetes.io/enforce
</span></span><span class="line"><span class="cl">pod-security.kubernetes.io/audit
</span></span><span class="line"><span class="cl">pod-security.kubernetes.io/warn
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>Value<span class="o">]</span>
</span></span><span class="line"><span class="cl">privileged
</span></span><span class="line"><span class="cl">baseline
</span></span><span class="line"><span class="cl">restricted
</span></span></code></pre></td></tr></table>
</div>
</div><p>One of PSA goals is to simplify the whole implementation. Instead of requiring users to write their own profiles, a few built-in profiles are defined: privileged, baseline, restricted.</p>
<h4 id="three-security-policies-defined-by-pod-security-standards">Three security policies defined by Pod Security Standards</h4>
<table>
<thead>
<tr>
<th>Profile</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Privileged</td>
<td>Unrestricted policy. <!-- raw HTML omitted -->It allows the widest possible level of permissions, almost like there are no restrictions. Useful for system-wide programs like logging agents, CNIs, storage drivers</td>
</tr>
<tr>
<td>Baseline</td>
<td>Minimally restrictive policy.</td>
</tr>
<tr>
<td>Restricted</td>
<td>Heavily restricted policy. <!-- raw HTML omitted -->It follows the pod hardening best practices.</td>
</tr>
</tbody>
</table>
<p>A mode defines what action the control plane takes if the policy is violated. If it&rsquo;s set to enforce, then the pod creation request is rejected. If it&rsquo;s set to audit, then the pod creation is allowed and an entry is added to the audit logs. And warn mode triggers a user-facing warning.</p>
<h4 id="three-modes-of-pod-security-admission">Three modes of Pod Security Admission</h4>
<table>
<thead>
<tr>
<th>Mode</th>
<th>On Violation</th>
</tr>
</thead>
<tbody>
<tr>
<td>enforce</td>
<td>Reject pod</td>
</tr>
<tr>
<td>audit</td>
<td>Record in the audit logs</td>
</tr>
<tr>
<td>warn</td>
<td>Trigger user-facing warning</td>
</tr>
</tbody>
</table>
<h4 id="transitioning-from-psp-to-a-new-pod-security-solution">Transitioning from PSP to a new pod security solution</h4>
<p>PodSecurityPolicy is being deprecated in Kubernetes 1.21 and removed from Kubernetes 1.25. With alternative security measures, there are two options available:</p>
<ol>
<li>Policy as Code (PAC)
<ul>
<li>notable examples: Kyverno, OPA/Gatekeeper, Open Policy Agent, jsPolicy</li>
</ul>
</li>
<li>Pod Security Standards with Pod Security Admission (PSS+PSA)</li>
</ol>
<p><a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/" target="_blank" rel="noopener noreffer ">Pod Security Standards</a></p>
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/enforce-standards-admission-controller/#configure-the-admission-controller" target="_blank" rel="noopener noreffer ">Configure the built-in admission controller</a></p>
<p>Three types of exemptions: Usernames, RuntimeClassNNames, Namespaces</p>
<h5 id="privileged">Privileged</h5>
<p>Example case is a container that needs to manage the host&rsquo;s network stack.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="baseline">Baseline</h5>
<p>Example case is an API server that requires limited security permissions without escalation privileges.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="restricted">Restricted</h5>
<p>Example case is a payment processing app that handles sensitive data, which is  under restricted level to minimize the attack surface.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="example-of-admission-configuration-file">Example of admission configuration file</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">admissionregistration.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">AdmissionConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">plugins</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">PodSecurity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">configuration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">pod-security.admission.config.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PodSecurityConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">defaults</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">enforce</span><span class="p">:</span><span class="w"> </span><span class="l">baseline</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">enforce-version</span><span class="p">:</span><span class="w"> </span><span class="l">latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">audit</span><span class="p">:</span><span class="w"> </span><span class="l">restricted</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">audit-version</span><span class="p">:</span><span class="w"> </span><span class="l">latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">warn</span><span class="p">:</span><span class="w"> </span><span class="l">restricted</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">warn-version</span><span class="p">:</span><span class="w"> </span><span class="l">latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">exemptions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">usernames</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">runtimeClassNames</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">my-namespace]  </span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="isolation-and-segmentation---resourcequota--limits">Isolation and Segmentation - ResourceQuota &amp; Limits</h3>
<p>By default, Kubernetes does not have a CPU or memory request or limit set. This means that any pod can consume as many resources as required on any node and suffocate other pods or processes that are running on the node of resources.</p>
<h4 id="limitrange">LimitRange</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">LimitRange</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cpu-resource-constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">500m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">defaultRequest</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">500m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">max</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">min</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Container</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>We can ensure that every pod created has some defaults set by LimitRanges. This can help you define default values to be set for containers in pods that are created without a request or limit specified in the pod definition file.</p>
<h4 id="resourcequota">ResourceQuota</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ResourceQuota</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-resource-quota</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="nt">requests.cpu</span><span class="p">:</span><span class="w"> </span><span class="m">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="nt">requests.memory</span><span class="p">:</span><span class="w"> </span><span class="l">4Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="nt">limits.cpu</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="nt">limits.memory</span><span class="p">:</span><span class="w"> </span><span class="l">10Gi</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>To restrict the total amount of  resources that can be consume by applications deployed in a Kubernetes cluster, we could create quotas at a namespace level. ResourceQuota is a namespace level object that can be created to set hard limit for requests and limits.</p>
<h3 id="audit-logs">Audit logs</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl logs -f falco-6t3dd
</span></span></code></pre></td></tr></table>
</div>
</div><p>All requests made to the Kubernetes cluster have to go through the <strong>API server</strong>. When we send a request to the Kubernetes cluster, such as for creating a new Nginx pod, it&rsquo;s the API server that receives this request. As soon as a request is made to the API server, it goes through what is known as the <strong>request received stage</strong>.</p>
<p>In the request received stage, events are generated, irrespective of whether the request is valid or not. Once the request is authenticated, validated and authorized, another event called <strong>response started</strong> is generated.</p>
<p>The response started event is applicable for requests that can take some time to complete, such as when making use of the <code>--watch</code> flag with the kubectl get command. To continuously observe the states of objects, once a request has been completed, a response body is sent back. This stage is known as the <strong>response complete stage</strong>.</p>
<p>Finally in case of an invalid request or an error, the request goes through a <strong>panic stage</strong>. Each of the stages that we have seen here, request received, response started, response complete, and panic generated events that can be recorded by the API server.</p>
<p>[RequestReceived] &ndash;&gt; [ResponseStarted] &ndash;&gt; [ResponseComplete] &ndash;&gt; [Panic]</p>
<h4 id="1-create-a-policy-object">1. Create a Policy Object</h4>
<p>Only record when pods were deleted.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVerion</span><span class="p">:</span><span class="w"> </span><span class="l">audit.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Policy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">omitStages</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;RequestReceived&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;prod-namespaces&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verb</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;delete&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;pods&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resourceNames</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;webapp-pod&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l">RequestResponse </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l">Metadata</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	</span>- <span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34; &#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  	  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;secrets&#34;</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="level---4-value">Level - 4 value:</h5>
<ul>
<li><code>None</code>: no events will be logs if the pod called webapp is deleted in the prod namespace</li>
<li><code>Metadata</code>: only the metadata (timestamp, username, resources, verbs) will be logged, the least verbose level</li>
<li><code>Request</code></li>
<li><code>RequestResponse</code></li>
</ul>
<h4 id="2-enable-auditing-in-kube-apiserver">2. Enable auditing in kube apiserver</h4>
<p>In version 1.20, two types of backends are supported: A log audit backend that stores audit events to a file on the master node, or a webhook backend that writes to a remote web hook such as a Falco service.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># At /etc/kubernetes/manifests/kube-apiserver.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">command</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">kube-apiserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">audit-log-path=/var/log/k8-audit.log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">audit-policy-file=/etc/kubernetes/audit-policy.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">audit-log-maxage=10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">audit-log-maxbackup=5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">audit-log-maxsize=100</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="kubernetes-threat-model">Kubernetes Threat Model</h2>
<h3 id="kubernetes-trust-boundaries-and-data-flow">Kubernetes Trust Boundaries and Data Flow</h3>
<p>Threat modeling is a process that helps you find potential threats, understand their impact and put measures in place.</p>
<h4 id="trust-boundaries">Trust Boundaries</h4>
<p>Isolating parts of the system and enforce specific measures help us manage and reduce security risks by ensuring that a breach in one part of the system doesn&rsquo;t compromise the entire application. These isolated areas are called trust boundaries.</p>
<p>Cluster boundaries ➡️ Node boundary ➡️ Namespace boundary ➡️ Pod boundary ➡️ Container Boundary</p>
<h4 id="exploring-data-flow-in-a-multi-tier-application">Exploring Data Flow in a Multi-Tier Application</h4>
<ol>
<li>From user to frontend-pod/nginx: Secure with measures like HTTPs and authentication to protect user data righ from the start</li>
<li>From nginx to authentication service: Secure communication channels and proper API authentication</li>
<li>From backend-svc to db-pod: Interation with database must be tightly controlled and encrypted to prevent unauthorized access and protect sensitive information</li>
<li>Backend communication: use networkPolicies to prevent unauthorized inter-pod communication</li>
</ol>
<h4 id="threat-actors">Threat actors</h4>
<p>Entities that post threats to our system, such as external attackers, compromised containers and malicious users.</p>
<h3 id="persistence">Persistence</h3>
<p>Persistence: The ability of an attacker to maintain access to a compromised system even after reboots, updates or other interruptions</p>
<h4 id="mitigating-persistence-risks">Mitigating Persistence Risks</h4>
<ol>
<li>Implementing role based access controls</li>
<li>Restrict access to Secrets</li>
<li>Hardening pod security
<ul>
<li>including preventing the use of privileged containers and enforcing read-only root filesystems</li>
</ul>
</li>
<li>Regular updates and patching
<ul>
<li>up-to-date security patches prevent exploitation</li>
</ul>
</li>
<li>Monitoring and auditing
<ul>
<li>monitor for suspicious activities</li>
<li>regular audit of Kubernetes events</li>
</ul>
</li>
</ol>
<h3 id="denial-of-service">Denial of Service</h3>
<p>Summary</p>
<ol>
<li>DoS attacks overwhelm system resources, causing unresponsiveness</li>
<li>Set resource quotas to prevent excessive resource usage</li>
<li>Restrict service account permissions to limit potential attacks</li>
<li>Use Network Policies and firewalls to control access</li>
<li>Monitor and alert on unusual activity for quick response</li>
</ol>
<h3 id="melicious-code-execution">Melicious Code Execution</h3>
<p>Summary</p>
<ol>
<li>Attackers exploit vulnerabilities in containers to execute malicious code</li>
<li>Restrict API server access to authorized users and services only</li>
<li>Secure image repositories and use signed images for verification</li>
<li>Monitor and log activities to detect and respond to threats</li>
<li>Regularly update and patch applications to prevent security exploits</li>
</ol>
<h3 id="compromised-applications-in-containers">Compromised Applications in Containers</h3>
<p>Please refer to compromised container attackTree, credit from Marco Lancini&rsquo;s blog.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://blog.marcolancini.it/images/posts/blog_kubernetes_threatmodel_scenario-compromisedcontainer.png"
        data-srcset="https://blog.marcolancini.it/images/posts/blog_kubernetes_threatmodel_scenario-compromisedcontainer.png, https://blog.marcolancini.it/images/posts/blog_kubernetes_threatmodel_scenario-compromisedcontainer.png 1.5x, https://blog.marcolancini.it/images/posts/blog_kubernetes_threatmodel_scenario-compromisedcontainer.png 2x"
        data-sizes="auto"
        alt="https://blog.marcolancini.it/images/posts/blog_kubernetes_threatmodel_scenario-compromisedcontainer.png"
        title="compromised container attackTree" /></p>
<h3 id="attacker-on-the-network">Attacker on the Network</h3>
<p>The attacker could cause a loss of etcd quorum by overloading its ports 2380 and 2379, or by blocking it from syncing up with other components.</p>
<p>By taking down the scheduler itself and the controller manager, the attacker can halt new or restarted workloads from being scheduled in the cluster. Attacking the scheduler ports (10251 and 10259), prevents Kubernetes from assigning ports to nodes, stopping new tasks from starting.</p>
<p>Going after the controller manager (port 10252 and 10257) will disrupt critical control loops, which impacts scaling updates and replications, meaning Kubernetes won&rsquo;t be able to manage the cluster&rsquo;s state effectively.</p>
<p>Kube-proxy is the service that manages network rules on each node. If the attacker takes down the kube-proxy or overloads its ports 10256 and 10249, it stops the flow of traffic between services and pods and essentially freezing communications.</p>
<p>Targeting Kubernetes DNS ports 53 would break name resolution, meaning services can&rsquo;t find each other by name, causing connectivity issues all over.</p>
<p>Attackers could also degrade the CNI (container network interface) by flooding it, which slows down or cuts off port-to-port communication, causing distributed services to fail.</p>
<p>By targeting network boot services like PXE server, the attackers could prevent new nodes from joining the cluster. This would keep the cluster from scaling up or replacing failed nodes, locking it into a degraded state.</p>
<h4 id="to-mitigate-network-based-attacks">To mitigate network based attacks</h4>
<ul>
<li>Configuring firewalls</li>
<li>Securing nodes
<ul>
<li>apply latest security patches</li>
<li>monitor vulnerabilities</li>
</ul>
</li>
<li>Implementing network policies</li>
<li>Strong authentication and authorization
<ul>
<li>strong password</li>
<li>multi-factor authentication</li>
<li>rule-based access control</li>
</ul>
</li>
<li>Monitoring and logging</li>
</ul>
<h4 id="summary-2">Summary</h4>
<ol>
<li>Attackers can target K8s control plane and nodes for breaches</li>
<li>Configure firewalls to limit network access to trusted IP addresses</li>
<li>Keep node operating systems and components updated and patched</li>
<li>Implement network policies to control traffic and prevent lateral movement</li>
<li>Use strong authentication, multi-factor, and RBAC for secure access</li>
<li>Monitor and log activities to detect and respond to threats</li>
</ol>
<h3 id="access-to-sensitive-data">Access to Sensitive Data</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">vi /etc/ssh/sshd_config
</span></span><span class="line"><span class="cl">sudo apt install nginx
</span></span><span class="line"><span class="cl"><span class="c1"># the default configuration for sudo</span>
</span></span><span class="line"><span class="cl">cat /etc/sudoers
</span></span><span class="line"><span class="cl">visudo
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="platform-security">Platform Security</h2>
<h3 id="supply-chain-security---minimize-base-image-footprint">Supply Chain Security - Minimize base image footprint</h3>
<p>When the imsage is built from scratch (<code>FROM scratch</code>), it is called as the base image. Parent image and base image can be referred to as the same thing.</p>
<h4 id="modular">Modular</h4>
<p>Do not build images that combine multiple applications, such as a web server, database and other service, all into one image. Instead, build images that aer modular. These different images, when deployed as containers, can together form a single large application that has different services. And each component can scale up or down as required without having to scale the other components.</p>
<h4 id="persist-state">Persist State</h4>
<p>Another best practice to be followed is not storing data or states inside a container. Because containers are ephmeral in nature, we should be able to bring them back online and not lose data along with the container. Always store data in either an external volume or caching service like Redis.</p>
<h4 id="choose-a-base-image">Choose a base image</h4>
<p><code>FROM ??????</code></p>
<p>First you look for iamges that suit your technical needs, such as httpd base image for your application, or nginx base image for nginx based server. Secondly, you must look for images with authenticity (<code>OFFICIAL IMAGE</code> or <code>verified publisher</code> tag). Thirdly, images must also be up to date, which are less likely to have vulnerabilities in them.</p>
<h4 id="slimminimal-images">Slim/Minimal images</h4>
<ol>
<li>Create slim/minimal images</li>
<li>Find an official minimal image that exists</li>
<li>Only install necessary packages
<ul>
<li>remove shells/packages managers/tools</li>
</ul>
</li>
<li>Maintain different images for different environment
<ul>
<li>development - debug tools</li>
<li>Production - lean</li>
</ul>
</li>
<li>Use multi-stage builds to create lean production ready images</li>
</ol>
<h4 id="distress-docker-images">Distress Docker Images</h4>
<h5 id="contains">Contains:</h5>
<ul>
<li>Application</li>
<li>Runtime dependencies</li>
</ul>
<h5 id="does-not-contain">Does not contain:</h5>
<ul>
<li>package managers</li>
<li>shells</li>
<li>network tools</li>
<li>text editors</li>
<li>other unwanted programs</li>
</ul>
<p>Please refer to <code>gcr.io/distroless/xxxxxx</code> images.</p>
<h4 id="vulnerability-scanning">Vulnerability scanning</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">trivy image httpd
</span></span><span class="line"><span class="cl"><span class="c1"># found 124 </span>
</span></span><span class="line"><span class="cl">trivy image httpd:alpine
</span></span><span class="line"><span class="cl"><span class="c1"># found zero!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="supply-chain-security---scan-images-for-known-vulnerabilities">Supply Chain Security - Scan images for known vulnerabilities</h3>
<p>CVE zero to ten points (low - high level vulnerabilities)</p>
<h4 id="cve-scanner">CVE Scanner</h4>
<p>A solution is to reduce the attack surface by removing unnecessary packages.</p>
<ol>
<li>
<p>Trivy by aqua security</p>
<ul>
<li></li>
</ul>
</li>
</ol>
<ul>
<li>
<p>easy to install, easy to run scan</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># add repo to /etc/apt/sources.list.d</span>
</span></span><span class="line"><span class="cl">sudo apt-get install wget apt-transport-https gnupg lsb-release
</span></span><span class="line"><span class="cl">wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key <span class="p">|</span> sudo apt-key add -
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> deb https://aquasecurity.github.io/trivy-repo/deb <span class="k">$(</span>lsb_release -sc<span class="k">)</span> main <span class="p">|</span> sudo tee -a /etc/apt/sources.list.d/trivy.list
</span></span><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install trivy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run image scan</span>
</span></span><span class="line"><span class="cl">trivy image ngnx:1.18.0
</span></span><span class="line"><span class="cl"><span class="c1"># only list vulnerabilities of critical severity level</span>
</span></span><span class="line"><span class="cl">trivy image --severity CRITICAL nginx:1.18.0
</span></span><span class="line"><span class="cl">trivy image --ignore-unfixed nginx:1.18.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker save nginx:1.18.0 &gt; nginx.tar
</span></span><span class="line"><span class="cl">trivy image --input archive.tar
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="best-practices">Best practices</h4>
<ul>
<li>Continuously rescan images</li>
<li>K8s admission controllers to scan images</li>
<li>Have your own repository with pre-scanned images ready to go</li>
<li>Integrate scanning tool with CI/CD pipelines</li>
</ul>
<h3 id="image-repository-security">Image Repository Security</h3>
<p><code>image: docker.io/library/nginx</code></p>
<ul>
<li>registry: <code>docker.io</code>, <code>gcr.io</code></li>
<li>user/account</li>
<li>image/repository</li>
</ul>
<h4 id="private-repository">Private Repository</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker login private-registry.io
</span></span><span class="line"><span class="cl">docker run private-registry.io/apps/internal-app
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># create credentials</span>
</span></span><span class="line"><span class="cl">kubectl create secret docker-registry regcred <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --docker-server<span class="o">=</span>private-registry.io <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --docker-username<span class="o">=</span>registry-user <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --docker-password<span class="o">=</span>registry-password <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --docker-email<span class="o">=</span>registry-user@org.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># pass the image pull secret for private registry</span>
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  imagePullSecrets:
</span></span><span class="line"><span class="cl">  - name: regcred
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="observability---overview">Observability - Overview</h3>
<p>[Securing Cluster] [Minimizing Microservices Vulnerability] [Sandboxing Techniques] [MTLS encryption] [Restricting Network Access]</p>
<p>Even with above techniques are all used to secure our infrastructure, there&rsquo;s absolutely no guarantee that an attack will never happen in the future.</p>
<p>How to identify breaches that have already occurred in our K8s cluster? We can make use of tools such as Falco from Sysdig.</p>
<table>
<thead>
<tr>
<th>SYSCALL name</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>close</code></td>
</tr>
<tr>
<td><code>nanosleep</code></td>
</tr>
<tr>
<td><code>fcntl</code></td>
</tr>
<tr>
<td><code>fstatfs</code></td>
</tr>
<tr>
<td><code>getdents64</code></td>
</tr>
<tr>
<td><code>exit_group</code></td>
</tr>
<tr>
<td><code>poll_ctl</code></td>
</tr>
<tr>
<td><code>openat</code></td>
</tr>
</tbody>
</table>
<p>We need analyze syscalls and filter out those that are suspicious. Attackers often want to erase tracks that they have ever been in the system, so they often try to delete some parts of logs that tracked how they got into the system in the first place. Normally, an administrator rarely has reasons to delete recent logs, so this activity can be considered anomalous and can be used as an early sign of intrusion. Falco can monitor this event and then send alerts using various notification channels.</p>
<h3 id="observability---falco-overview-and-installation">Observability - Falco Overview and Installation</h3>
<ol>
<li>Falco Kernel Module - intrusive, some managed k8s service providers do not allow this</li>
<li>Extended Berkely Packet Filter (eBPF) - safer and less intrusive</li>
</ol>
<h4 id="install-falco-as-a-package">Install Falco as a Package</h4>
<p>With this method, Falco is isolated from Kubernetes, and it can still continue to detect and alert suspicious behavior.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl -s https://falco.org/repo/falcosecurity-3672BA8F.asc <span class="p">|</span> apt-key add -
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;deb https://download.falco.org/packages/deb stable main&#34;</span> <span class="p">|</span> tee -a /etc/apt/sources.list.d/falcosecurity.list
</span></span><span class="line"><span class="cl">apt update -y
</span></span><span class="line"><span class="cl">apt get install -y linux-headers-<span class="k">$(</span>uname -r<span class="k">)</span>
</span></span><span class="line"><span class="cl">apt install -y falco
</span></span><span class="line"><span class="cl"><span class="c1"># start the falco server</span>
</span></span><span class="line"><span class="cl">systemctl start falco
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="install-as-a-daemonset">Install as a DaemonSet</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">helm repo add falcosecurity https://falcosecurity.github.io/charts
</span></span><span class="line"><span class="cl">helm repo update
</span></span><span class="line"><span class="cl">helm install falco falcosecurity/falco
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="observability---using-falco-to-detect-threats">Observability - Using Falco to Detect Threats</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># assume falco is running as package</span>
</span></span><span class="line"><span class="cl">systemctl status falco
</span></span><span class="line"><span class="cl"><span class="c1"># run nginx pod and check which node it&#39;s on, ssh into that node</span>
</span></span><span class="line"><span class="cl">journalctl -fu falco
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="service-mesh---monolithics-vs-microservices">Service Mesh - Monolithics vs Microservices</h3>
<h3 id="service-mesh">Service Mesh</h3>
<h3 id="service-mesh---istio">Service Mesh - Istio</h3>
<h3 id="service-mesh---security-in-istio">Service Mesh - Security in Istio</h3>
<h3 id="service-mesh---istio-security-architecture">Service Mesh - Istio Security Architecture</h3>
<h4 id="lab">Lab</h4>
<h3 id="k8s-pki---certificate-creation">K8s PKI - certificate creation</h3>
<h3 id="k8s-pki---view-certificate-details">K8s PKI - view certificate details</h3>
<h4 id="lab-1">Lab</h4>
<h3 id="connectivity---tls-intro">Connectivity - TLS intro</h3>
<h3 id="connectivity---tls-basics">Connectivity - TLS basics</h3>
<h3 id="connectivity---tls-in-kubernetes">Connectivity - TLS in Kubernetes</h3>
<h3 id="connectivity---mutual-tls">Connectivity - Mutual TLS</h3>
<h3 id="admission-controllers">Admission Controllers</h3>
<p>[<strong>kubectl</strong>] ➡️ [<strong>Authentication</strong>] ➡️ [<strong>Authorization</strong>] ➡️ [<strong>Admission Controllers</strong>] ➡️ [<strong>Create Pod</strong>]</p>
<p>Authorization is achieved through role-based access control using Role and RoleBinding objects.</p>
<p>Admission Controller helps us achieve better security measures to enforce how a cluster is used. Examples are like:</p>
<ul>
<li>Only permit images from certain registry</li>
<li>Do not permit <code>runAs</code> root user</li>
<li>Only permit certain capabilities</li>
<li>Pod always has labels</li>
</ul>
<h4 id="examples-of-admission-controllers">Examples of Admission Controllers:</h4>
<ul>
<li>
<p>AlwaysPullImages</p>
</li>
<li>
<p>DefaultStorageClass</p>
</li>
<li>
<p>EventRateLimit</p>
</li>
<li>
<p>NamespaceExists</p>
<blockquote>
<p>Rejected a kubectl run command if the specified ns does not exist.</p>
</blockquote>
</li>
<li>
<p>NamespaceAutoProvision</p>
</li>
<li>
<p>many more examples &hellip;</p>
</li>
</ul>
<h4 id="view-enabled-admission-controllers">View Enabled Admission Controllers</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kube-apiserver -h <span class="p">|</span> grep enable-admission-plugins
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="enable-admission-controllers">Enable Admission Controllers</h4>
<p>Update the enable admission plugins flag to the kube-apiserver yaml file to add the new admission controllers.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kube-apiserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">kube-apiserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">authorization-mode=Node,RBAC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">advertise-address=172.17.0.107</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">allow-privileged=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">enable-bootstrap-token-auth=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">enable-admission-plugins=NodeRestriction,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- --<span class="l">disable-admission-plugins=DefaultStorageClass</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="lab--admission-controllers">Lab -admission controllers</h4>
<h2 id="compliance-and-security-framework">Compliance and security framework</h2>
<h3 id="compliance-frameworks">Compliance Frameworks</h3>
<blockquote>
<p>Defines what needs to be done to meet legal, regulatory, or industry standards</p>
</blockquote>
<p>Security compliance frameworks provide the guidelines and standards that help us protect sensitive data, such as personal info, health records, payment details, to ensure system integrity and meet legal obligations.</p>
<p>To avoid data breach leading to significant fines and loss of trust, organizations need to follow structured guidelines known as compliance frameworks. Compliance frameworks are guidelines and best practices that are designed to help organizations meet regulatory requirements and ensure data security and privacy.</p>
<blockquote>
<p>frameworks such as GDPR, HIPAA, PCI DSS, NIST, CIS Benchmarks</p>
</blockquote>
<h4 id="general-data-protection-regulation-gdpr">General Data Protection Regulation (GDPR)</h4>
<p>GDPR is a comprehensive data protection law enacted by the European Union to safegard individual&rsquo;s personal data and uphold their privacy rights. GDPR is highly relevant for the EU, and it&rsquo;s got to do with personal data.</p>
<h4 id="health-insurance-portability-and-accountability-act-hipaa">Health Insurance Portability and Accountability Act (HIPAA)</h4>
<p>HIPAA is a US regulation that protects sensitive patient health information. If our web application handles patient data, we must ensure taht all data transfers between front-end, back-end and database are encrypted using TLS. Also we need to implement access controls to restrict unauthorized access to health data and that our Kubernetes secrets are securely configured for application use.  HIPAA is used to protect health data, health info (PH, protected health information).</p>
<h4 id="payment-card-industry-data-security-standard-psi-dss">Payment Card Industry Data Security Standard (PSI DSS)</h4>
<p>We must make sure the cardhold data both in transit and at rest are encrypted. Strong access controls must be in place, and we should regularly monitor and audit access to payment data to comply with PCI DSS.</p>
<h4 id="national-institute-of-standards-and-technology-nist">National Institute of Standards and Technology (NIST)</h4>
<p>NIST provides a framework for improving the security and resilience of information systems. Conducting regular risk assessments to identify potential vulnerabilities, implementing security controls like firewalls, intrusion detection systems and regular security audits to help ensure mitigation of this risk. Key component: protection against security standards like cybersecurity.</p>
<h4 id="center-for-internet-security-cis">Center for Internet Security (CIS)</h4>
<p>CIS benchmarks offer best practices for securing IT systems and data.</p>
<ul>
<li>securing a configuration of the API server at etcd, kubelet, controller, manager, scheduler, authentication and authorization</li>
<li>enforcing RBAC and other access control mechanisms, logging and monitoring, network policies, pod securiity</li>
</ul>
<p>Tools like Kubebench by Aqua Security can help check whether K8s is deployed securely by running the checks documented in the CIS K8s benchmark. Key component: CIS provides benchmarks for different systems, including K8s.</p>
<h4 id="recommended-tools">Recommended Tools</h4>
<ul>
<li>OneTrust, TrustArc - <strong>GDPR</strong></li>
<li>Compliancy Group, POBOX - <strong>HIPAA</strong></li>
<li>Prisma Cloud - <strong>PCI</strong></li>
<li>NIST SRE Toolkit - <strong>NIST</strong></li>
<li>Kube-bench - <strong>CIS</strong></li>
</ul>
<h3 id="threat-modelling-frameworks">Threat Modelling Frameworks</h3>
<blockquote>
<p>Specifies how to achieve it by identifying specific threats and suggesting mitigations to secure the system</p>
</blockquote>
<ol>
<li>STRIDE</li>
<li>MITRE ATT &amp; CK</li>
</ol>
<h4 id="stride">STRIDE</h4>
<p>STRIDE is developed by Microsoft. STRIDE identifies six categories of threats.</p>
<ul>
<li>S - spoofing
<ul>
<li>an attacker try to impersonate a legitmate user to access our server</li>
<li>mitigated by implementing strong authentication mechanisms 驗證機制</li>
</ul>
</li>
<li>T - tempering
<ul>
<li>an attacker attempt to alter data being process by the backend server, including data in transit, data at rest</li>
<li>mitigated by ensuring data integrity with encryption and digital signatures 數據加密 電子簽章</li>
</ul>
</li>
<li>R - repudiation
<ul>
<li>users claim that they didn&rsquo;t do something or were not responsible for doing something</li>
<li>addressed by keeping comprehensive logs that record user actions and using non-repudiation techniques like digital signatures 審計日誌 電子簽章</li>
</ul>
</li>
<li>I - information disclosure
<ul>
<li>someone obtaining info that they are not authorized to access</li>
<li>prevented by encrypting data in transit and at rest 加密保護</li>
</ul>
</li>
<li>D - denial of service
<ul>
<li>attacker might try to overload our system, causing it to crash</li>
<li>mitigated by setting up rate limiting and resource quotas in our K8s environment 服務限流</li>
</ul>
</li>
<li>E - elevation of privilege
<ul>
<li>attacker might gain unauthorized access to higher privilege levels</li>
<li>prevented by implementing strict RBAC policies</li>
</ul>
</li>
</ul>
<h4 id="mitre-attck">MITRE ATT&amp;CK</h4>
<p>MITRE ATT&amp;CK is a global knowledge based of real-world tactics and techniques that are used to build threat models. This framework focuses on what attackers aim to do (tactics) and how they do it (techniques).</p>
<ul>
<li><strong>Initial Access</strong>: How attackers enter the cluster, such as exploiting weak authentication</li>
<li><strong>Execution</strong>: Running unauthorized commands or code, like deploying malicious containers</li>
<li><strong>Persistence</strong>: maintaining access, for example, by creating new users or modifying roles</li>
<li><strong>Privilege Escalation</strong>: gaining higher access, such as exploiting misconfigured RBAC</li>
<li><strong>Defence Evasion</strong>: hiding activities, like disabling logs or concealing workloads</li>
</ul>
<h4 id="summary-3">Summary</h4>
<ol>
<li>Threat modeling identifies, assesses and mitigates specific security threats</li>
<li>STRIDE stands for spoofing, tampering, repudiation, information disclosure, DoS, Elevation</li>
<li>STRIDE helps uncover vulnerabilities with tailered defenses for our environment</li>
<li>Use attack trees to visualize and analyze different attack scenarios</li>
<li>Implement security controls to mitigate prioritized threats identified by STRIDE</li>
<li>Integrate threat modeling into development to address issues early</li>
<li>Leverage the MITRE ATT&amp;CK framework to understand adversary tactics and techniques and strengthen defenses against specific threats</li>
</ol>
<h3 id="supply-chain-compliance">Supply Chain Compliance</h3>
<h4 id="key-components-of-supply-chain-security">Key components of Supply Chain Security</h4>
<ol>
<li>
<p>Artifact: verify what you deploy</p>
<ul>
<li>
<p>In K8s, artifacts are signed during the release process using keyless signing tools like <code>Cosign</code>. This ensures the artifacts haven&rsquo;t been tampered with.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">cosign sign <span class="nv">$IMAGE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># generates ephmeral keys, retrieves signed certs and ask you to confirm</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>You can also use co-sign utilty to verify the image</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">cosign verify-blob <span class="s2">&#34;</span><span class="nv">$BINARY</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --signature <span class="s2">&#34;</span><span class="nv">$BINARY</span><span class="s2">&#34;</span>.sig <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --certificate <span class="s2">&#34;</span><span class="nv">$BINARY</span><span class="s2">&#34;</span>.cert <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --certificate-identity krel-staging@k8s-releng-prod.iam.gserviceaccount.com <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --certificate-oidc-issuer https://accounts.google.com
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>Metadata: understanding what&rsquo;s inside</p>
<ul>
<li>Metadata describes what&rsquo;s in your artifacts and where they come from</li>
<li>A critical type of metadata is the SBOM (software bill of materials)</li>
<li>A SBOM is in what is known as an SPDX format</li>
<li>An SBOM details all the components, libraries and dependencies along with their versions and sources</li>
<li>We use <code>SIFT</code> (a CLI tool and go library) to generate a SBOM</li>
</ul>
</li>
<li>
<p>Attestations: building trust</p>
<ul>
<li>
<p>Attestations are signed statements that verify metadata like SBOM&rsquo;s provenance data or vulnerability reports from an authentic, trustworthy source</p>
</li>
<li>
<p>Kubernetes release team generates the SBOM and signs it using a private key, creating an attestation</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">cosign sign --key &lt;PRIVATE_KEY&gt; sbom.k8s.io/v1.27.4/release.spdx &gt; sbom.attestation
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>You verify the attestation using their public certificates with the cosign command</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">cosign verify-attestation <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --key &lt;PUBLIC_KEY&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --certificate-identity krel-staging@k8s-releng-prod.iam.gserviceaccount.com <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --certificate-oidc-issuer https://accounts.google.com <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  sbom.k8s.io/v1.27.4/release.spdx
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Think of the SHA checksum as a checking that a sealed package hasn&rsquo;t been damaged during the shipping process</p>
</li>
<li>
<p>The attestation is like verifying the package&rsquo;s seal and sender signature to confirm it&rsquo;s from a trusted vender and contains what they claim it has</p>
</li>
<li>
<p>Attestation is rather a framework for defining and verifying the entire supply chain process</p>
</li>
</ul>
</li>
<li>
<p>Policies: automating compliance</p>
<ul>
<li>To automate the deployment and verification of these components on K8s, and make sure we are only deploying verified, trustworthy artifacts</li>
<li>Policy - the rules that ensure compliance and security standards are enforced automatically</li>
<li>Policy helps to prevent insecure or non-compliant components form being deployed</li>
<li><code>SIGstore's policy-controller</code> integrated with admission controllers</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>component</th>
<th>steps</th>
</tr>
</thead>
<tbody>
<tr>
<td>Artifact</td>
<td>The binaries and container images are signed using Cosign</td>
</tr>
<tr>
<td>Metadata</td>
<td>The SBOM details all the components and their origins, helping you identify risks</td>
</tr>
<tr>
<td>Attestations</td>
<td>The SBOM and other metadata are signed to ensure trustworthiness</td>
</tr>
<tr>
<td>Policies</td>
<td>Finally Admission controllers verify these signatures and enforce compliance before deployment</td>
</tr>
</tbody>
</table>
<h3 id="automation-and-tooling">Automation and Tooling</h3>
<p>The Cloud Native Security Map builds on top of the Cloud Native Security Whitepaper by SIG-Security.</p>
<h4 id="lifecycle---4-phases">Lifecycle - 4 phases</h4>
<ol>
<li>
<p>Develop</p>
<ul>
<li>
<p><strong>code</strong> (code, dockerfile, k8s manifest, Iac) &ndash;&gt; <strong>commit</strong></p>
<ul>
<li>
<p><code>oss-fuzz</code> by Google 模糊測試</p>
</li>
<li>
<p><code>snyk Code</code> at VScode plugin</p>
</li>
<li>
<p><code>fabric8</code></p>
</li>
<li>
<p><code>KubeLinter</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kube-linter lint pod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Distribute</p>
<ul>
<li><strong>Build pipelines</strong> &ndash;&gt; <strong>container registry</strong></li>
</ul>
</li>
<li>
<p>Deploy</p>
</li>
<li>
<p>Runtime</p>
</li>
</ol>
<iframe class="LikeCoin" height="235" src="https://button.like.co/in/embed/wysiwyz/button?referrer=http%3a%2f%2fwysiwyz.github.io%2fposts%2fcncf-kubestronaut-01kcna%2f" width="100%" frameborder=0></iframe><div class="disqus markdown">
                
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'blog-wysiwyz';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
        </div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-11-29</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://wysiwyz.github.io/posts/cncf-kubestronaut-01kcna/" data-hashtag="Cloud Native"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://wysiwyz.github.io/posts/cncf-kubestronaut-01kcna/" data-title="01 Kubestronaut KCNA &amp; KCSA"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/cloud-native/">Cloud Native</a>,&nbsp;<a href="/tags/kubernetes/">Kubernetes</a>,&nbsp;<a href="/tags/kcsa/">KCSA</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/kong-hq-academy/" class="prev" rel="prev" title="Kong Academy 網關學習筆記"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Kong Academy 網關學習筆記</a>
            <a href="/posts/kk_learn_by_doing_apache_kafka/" class="next" rel="next" title="Apache Kafka 做中學">Apache Kafka 做中學<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">strict with yourself; lenient with others.</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><script type="text/javascript" src="https://.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"valine":{"appId":"","appKey":"","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"en","pageSize":10,"placeholder":"Your comment ...","recordIP":true,"visitor":true}},"twemoji":true};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-CCS3QPVY5N', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-CCS3QPVY5N" async></script></body>
</html>
