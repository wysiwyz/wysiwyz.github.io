<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>1Z0-819 曾師筆記 (2/duology) - Ich bin yiwen.</title><meta name="Description" content="An ordinary space for storing and groups pieces of articles."><meta property="og:title" content="1Z0-819 曾師筆記 (2/duology)" />
<meta property="og:description" content="# 01 泛型和集合物件 泛型 Java 5 之後加入泛型，使型別使用多了另一種彈性。
集合物件（用來裝填物件）＋泛型，可以限制裝填物件的型別。
使用泛型的效益 提供更彈性的「型別安全 type safety」檢查機制，原本在執行時才能發現的型別錯誤，現在在編譯時期就可以預發現 在集合物件 Collections 裡大量使用，限制內涵物件之型別 減少轉型 casting 需要，使程式碼更簡潔 使用泛型設計類別 可以將程式碼裡的符號 T換成 String( 即 UseString())，或換成 Shirt (即 UseShirt()) 常見的符號及表示方式如下： T -「型別（type）」 E -「成員（element）」 K -「鍵 - 值對裡的鍵（key）」 V -「鍵 - 值對裡的值（value）」 class UseAny&lt;T&gt; { private T t; public void add(T t) { this.t = t; } public T get() { return this.t; } } class UseString { private String message; public void add(String message) { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://wysiwyz.github.io/posts/ocpjp_11_2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-18T17:50:34+08:00" />
<meta property="article:modified_time" content="2022-12-18T17:50:34+08:00" /><meta property="og:site_name" content="Ich bin yiwen." />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="1Z0-819 曾師筆記 (2/duology)"/>
<meta name="twitter:description" content="# 01 泛型和集合物件 泛型 Java 5 之後加入泛型，使型別使用多了另一種彈性。
集合物件（用來裝填物件）＋泛型，可以限制裝填物件的型別。
使用泛型的效益 提供更彈性的「型別安全 type safety」檢查機制，原本在執行時才能發現的型別錯誤，現在在編譯時期就可以預發現 在集合物件 Collections 裡大量使用，限制內涵物件之型別 減少轉型 casting 需要，使程式碼更簡潔 使用泛型設計類別 可以將程式碼裡的符號 T換成 String( 即 UseString())，或換成 Shirt (即 UseShirt()) 常見的符號及表示方式如下： T -「型別（type）」 E -「成員（element）」 K -「鍵 - 值對裡的鍵（key）」 V -「鍵 - 值對裡的值（value）」 class UseAny&lt;T&gt; { private T t; public void add(T t) { this.t = t; } public T get() { return this.t; } } class UseString { private String message; public void add(String message) { this."/>
<meta name="application-name" content="Ich bin yiwen.">
<meta name="apple-mobile-web-app-title" content="Ich bin yiwen."><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/moon_icon.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://wysiwyz.github.io/posts/ocpjp_11_2/" /><link rel="prev" href="http://wysiwyz.github.io/posts/ocpjp_11/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "1Z0-819 曾師筆記 (2/duology)",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/wysiwyz.github.io\/posts\/ocpjp_11_2\/"
        },"genre": "posts","keywords": "Java, 1Z0-819","wordcount":  3966 ,
        "url": "http:\/\/wysiwyz.github.io\/posts\/ocpjp_11_2\/","datePublished": "2022-12-18T17:50:34+08:00","dateModified": "2022-12-18T17:50:34+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "celine"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Ich bin yiwen.">Ich bin yiwen.</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Ich bin yiwen.">Ich bin yiwen.</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">1Z0-819 曾師筆記 (2/duology)</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>celine</a></span>&nbsp;<span class="post-category">included in <a href="/categories/studynote/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>StudyNote</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-12-18">2022-12-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;3966 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;19 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#泛型">泛型</a>
      <ul>
        <li><a href="#使用泛型的效益">使用泛型的效益</a></li>
        <li><a href="#使用泛型設計類別">使用泛型設計類別</a></li>
      </ul>
    </li>
    <li><a href="#集合物件">集合物件</a>
      <ul>
        <li><a href="#collection-定義與種類">Collection 定義與種類</a></li>
        <li><a href="#list">List</a></li>
        <li><a href="#arraylist--list-最常使用的一種實作類別"><code>ArrayList</code> : List 最常使用的一種實作類別</a></li>
        <li><a href="#自動裝箱-boxing和開箱-unboxing">自動裝箱 <code>Boxing</code>和開箱 <code>Unboxing</code></a></li>
        <li><a href="#set">Set</a></li>
        <li><a href="#deque-queue">Deque (Queue)</a></li>
      </ul>
    </li>
    <li><a href="#map">Map</a></li>
    <li><a href="#集合物件成員的排序">集合物件成員的排序</a>
      <ul>
        <li><a href="#排序作法">排序作法</a></li>
        <li><a href="#使用-comparable-介面排序">使用 <code>Comparable</code> 介面排序</a></li>
        <li><a href="#使用-comparator-介面排序">使用 <code>Comparator</code> 介面排序</a></li>
      </ul>
    </li>
    <li><a href="#使用-of-與-copyof-方法建立-listset-與-map-物件">使用 <code>of()</code> 與 <code>copyOf()</code> 方法建立 <code>List</code>、<code>Set</code> 與 <code>Map</code> 物件</a>
      <ul>
        <li><a href="#使用of方法建立-list-set-map-物件">使用<code>of()</code>方法建立 List, Set, Map 物件</a></li>
        <li><a href="#使用copyof方法建立-list-set-map-物件">使用<code>copyOf()</code>方法建立 List, Set, Map 物件</a></li>
        <li><a href="#使用-arraysaslist建立-list-物件">使用 <code>Arrays.asList()</code>建立 List 物件</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#例外">例外</a>
      <ul>
        <li><a href="#使用try-catch程式碼區塊">使用<code>try-catch</code>程式碼區塊</a></li>
        <li><a href="#使用-try-with-resources-程式碼區塊和-autocloseable-介面">使用 <code>try-with-resources</code> 程式碼區塊和 <code>AutoCloseable</code> 介面</a></li>
        <li><a href="#suppressed-exceptions">Suppressed Exceptions</a></li>
        <li><a href="#使用-multi-catch-敘述">使用 <code>multi-catch</code> 敘述</a></li>
        <li><a href="#使用-throws-宣告">使用 <code>throws</code> 宣告</a></li>
        <li><a href="#建立客製的-exception">建立客製的 <code>Exception</code></a></li>
      </ul>
    </li>
    <li><a href="#斷言">斷言</a>
      <ul>
        <li><a href="#assertions-的簡介和語法">Assertions 的簡介和語法</a></li>
        <li><a href="#assertions-的使用">Assertions 的使用</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#io-基礎">I/O 基礎</a>
      <ul>
        <li><a href="#何謂-io">何謂 I/O</a></li>
        <li><a href="#處理串流的類別">處理串流的類別</a></li>
        <li><a href="#串流類別的串接">串流類別的串接</a></li>
        <li><a href="#使用-javaiofile-類別">使用 <code>java.io.File</code> 類別</a></li>
      </ul>
    </li>
    <li><a href="#由主控台讀寫資料">由主控台讀寫資料</a>
      <ul>
        <li><a href="#主控台的-io">主控台的 I/O</a></li>
        <li><a href="#使用標準輸出方法">使用標準輸出方法</a></li>
        <li><a href="#javaioconsole-類別介紹"><code>java.io.Console</code> 類別介紹</a></li>
      </ul>
    </li>
    <li><a href="#channel-io">Channel I/O</a></li>
    <li><a href="#使用序列化技術讀寫物件">使用序列化技術讀寫物件</a>
      <ul>
        <li><a href="#java-裡的資料保存-persistence">Java 裡的資料保存 <em>Persistence</em></a></li>
        <li><a href="#序列化和物件圖譜">序列化和物件圖譜</a></li>
        <li><a href="#不需要參加序列化的欄位">不需要參加序列化的欄位</a></li>
        <li><a href="#定義物件保存的版本號碼">定義物件保存的版本號碼</a></li>
        <li><a href="#序列化和反序列化範例">序列化和反序列化範例</a></li>
        <li><a href="#3-serialization-and-de-serialization">3. Serialization and De-serialization</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#nio2-基礎">NIO.2 基礎</a>
      <ul>
        <li><a href="#javajofile限制"><code>java.jo.File</code>限制</a></li>
        <li><a href="#java-io-套件發展歷史">Java I/O 套件發展歷史</a></li>
        <li><a href="#檔案系統路徑和檔案">檔案系統、路徑和檔案</a></li>
        <li><a href="#symbolic-link-檔案">Symbolic Link 檔案</a></li>
        <li><a href="#nio2-的基本架構">NIO.2 的基本架構</a></li>
      </ul>
    </li>
    <li><a href="#使用-path-介面操作檔案目錄">使用 Path 介面操作檔案/目錄</a>
      <ul>
        <li><a href="#path-介面">Path 介面</a></li>
        <li><a href="#path-介面主要功能">Path 介面主要功能</a></li>
        <li><a href="#移除路徑裡的多餘組成">移除路徑裡的多餘組成</a></li>
        <li><a href="#建立子路徑">建立子路徑</a></li>
        <li><a href="#結合-2-個路徑">結合 2 個路徑</a></li>
        <li><a href="#建立連接-2-個路徑的路徑">建立連接 2 個路徑的路徑</a></li>
        <li><a href="#hard-link">Hard Link</a></li>
        <li><a href="#處理-symbolic-link">處理 Symbolic Link</a></li>
      </ul>
    </li>
    <li><a href="#使用-files-類別對檔案目錄進行檢查刪除複製移動">使用 Files 類別對檔案/目錄進行檢查刪除複製移動</a>
      <ul>
        <li><a href="#處理檔案">處理檔案</a></li>
        <li><a href="#檢查檔案--目錄是否存在">檢查檔案 / 目錄是否存在</a></li>
        <li><a href="#檢查檔案--目錄屬性">檢查檔案 / 目錄屬性</a></li>
        <li><a href="#建立檔案--目錄">建立檔案 / 目錄</a></li>
        <li><a href="#刪除檔案--目錄">刪除檔案 / 目錄</a></li>
        <li><a href="#複製和移動檔案--目錄">複製和移動檔案 / 目錄</a></li>
        <li><a href="#stream-和-path-互相複製">Stream 和 Path 互相複製</a></li>
        <li><a href="#列出目錄內容">列出目錄內容</a></li>
        <li><a href="#讀取和寫入檔案">讀取和寫入檔案</a></li>
      </ul>
    </li>
    <li><a href="#使用-files-類別操作-channel-io-和-stream-io-讀寫檔案">使用 Files 類別操作 Channel I/O 和 Stream I/O 讀寫檔案</a>
      <ul>
        <li><a href="#介面-channel-和類別-bytebuffer">介面 Channel 和類別 ByteBuffer</a></li>
        <li><a href="#隨機存取檔案">隨機存取檔案</a></li>
        <li><a href="#對文字檔提供-buffered-io-方法">對文字檔提供 Buffered I/O 方法</a></li>
        <li><a href="#取得位元串流物件的方法">取得位元串流物件的方法</a></li>
      </ul>
    </li>
    <li><a href="#讀寫檔案目錄的屬性">讀寫檔案/目錄的屬性</a>
      <ul>
        <li><a href="#使用-files-管理檔案的屬性資料">使用 Files 管理檔案的屬性資料</a></li>
        <li><a href="#讀取檔案屬性">讀取檔案屬性</a></li>
        <li><a href="#修改檔案屬性">修改檔案屬性</a></li>
        <li><a href="#dos-之外的-file-attribute-views">DOS 之外的 File Attribute Views</a></li>
        <li><a href="#posix-檔案系統的權限"><code>POSIX</code> 檔案系統的權限</a></li>
      </ul>
    </li>
    <li><a href="#遞迴存取目錄結構">遞迴存取目錄結構</a>
      <ul>
        <li><a href="#對檔案目錄進行遞迴操作">對檔案目錄進行遞迴操作</a></li>
      </ul>
    </li>
    <li><a href="#使用-pathmatcher-類別找尋符合的檔案">使用 <code>PathMatcher</code> 類別找尋符合的檔案</a>
      <ul>
        <li><a href="#搜尋檔案">搜尋檔案</a></li>
        <li><a href="#glob-樣式語法介紹"><code>glob</code> 樣式語法介紹</a></li>
      </ul>
    </li>
    <li><a href="#其它">其它</a>
      <ul>
        <li><a href="#filestore-類別"><code>FileStore</code> 類別</a></li>
        <li><a href="#使用-watchservice">使用 <code>WatchService</code></a></li>
        <li><a href="#由基礎-io-轉換至-nio2">由基礎 I/O 轉換至 NIO.2</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#介紹">介紹</a>
      <ul>
        <li><a href="#名詞說明">名詞說明</a></li>
        <li><a href="#多執行緒的重要性">多執行緒的重要性</a></li>
        <li><a href="#執行緒類別">執行緒類別</a></li>
      </ul>
    </li>
    <li><a href="#執行緒常見問題">執行緒常見問題</a>
      <ul>
        <li><a href="#使用-shared-data-可能造成的問題">使用 <code>Shared Data</code> 可能造成的問題</a></li>
        <li><a href="#使用-non-atomic-functions-可能造成的問題">使用 <code>Non-Atomic Functions</code> 可能造成的問題</a></li>
        <li><a href="#使用-catched-data-可能造成的問題">使用 <code>Catched Data</code> 可能造成的問題</a></li>
      </ul>
    </li>
    <li><a href="#執行緒的-synchronized-與等待">執行緒的 synchronized 與等待</a>
      <ul>
        <li><a href="#使用-synchronized-關鍵字">使用 <code>synchronized</code> 關鍵字</a></li>
        <li><a href="#使用-synchronized-的時機">使用 <code>synchronized</code> 的時機</a></li>
        <li><a href="#縮小-synchronized-的程式區塊">縮小 synchronized 的程式區塊</a></li>
        <li><a href="#其它執行等待的情況">其它執行等待的情況</a></li>
      </ul>
    </li>
    <li><a href="#其它執行緒方法介紹">其它執行緒方法介紹</a>
      <ul>
        <li><a href="#使用-interrup-方法">使用 <code>interrup()</code> 方法</a></li>
        <li><a href="#使用-sleep-方法">使用 <code>sleep()</code> 方法</a></li>
        <li><a href="#使用其它方法">使用其它方法</a></li>
        <li><a href="#不建議使用的方法">不建議使用的方法</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#使用並行-api">使用並行 API</a></li>
    <li><a href="#使用-executorservice-介面同時執行多樣工作">使用 ExecutorService 介面同時執行多樣工作</a></li>
    <li><a href="#使用-fork-join-框架同時執行多樣工作">使用 Fork-Join 框架同時執行多樣工作</a></li>
  </ul>

  <ul>
    <li><a href="#了解-databasedbms-和-sql">了解 Database、DBMS 和 SQL</a></li>
    <li><a href="#eclipse-連線並存取資料庫">Eclipse 連線並存取資料庫</a></li>
    <li><a href="#使用-jdbc">使用 JDBC</a></li>
    <li><a href="#jdbc-進行交易">JDBC 進行交易</a></li>
    <li><a href="#使用-jdbc-41-的-rowsetprovider-和-rowsetfactory">使用 JDBC 4.1 的 RowSetProvider 和 RowSetFactory</a></li>
  </ul>

  <ul>
    <li><a href="#了解-java-的軟體區域化作法">了解 Java 的軟體區域化作法</a></li>
    <li><a href="#使用-dateformat-類別提供日期的區域化顯示">使用 DateFormat 類別提供日期的區域化顯示</a></li>
    <li><a href="#使用-numberformat-類別提供幣別區域化顯示">使用 NumberFormat 類別提供幣別區域化顯示</a></li>
  </ul>

  <ul>
    <li><a href="#使用-lambda-表示式">使用 Lambda 表示式</a></li>
    <li><a href="#使用內建的功能性介面">使用內建的功能性介面</a></li>
    <li><a href="#在泛型內使用萬用字元">在泛型內使用萬用字元</a></li>
    <li><a href="#使用其它內建的功能性介面">使用其它內建的功能性介面</a></li>
    <li><a href="#使用方法參照">使用方法參照</a></li>
  </ul>

  <ul>
    <li><a href="#建構者設計模式和方法鏈結">建構者設計模式和方法鏈結</a></li>
    <li><a href="#使用-optional-類別">使用 Optional 類別</a></li>
    <li><a href="#stream-api-介紹">Stream API 介紹</a></li>
    <li><a href="#stream-api-操作">Stream API 操作</a></li>
    <li><a href="#stream-api-和-nio2">Stream API 和 NIO.2</a></li>
    <li><a href="#stream-api-操作平行化">Stream API 操作平行化</a></li>
  </ul>

  <ul>
    <li><a href="#date--time-相關類別的演進">Date &amp; Time 相關類別的演進</a></li>
    <li><a href="#當地日期與時間">當地日期與時間</a></li>
    <li><a href="#時區和日光節約時間">時區和日光節約時間</a></li>
    <li><a href="#描述日期與時間的數量">描述日期與時間的數量</a></li>
  </ul>

  <ul>
    <li><a href="#認識標註型別">認識標註型別</a></li>
    <li><a href="#建立自定義標註型別">建立自定義標註型別</a></li>
    <li><a href="#標註型別的應用">標註型別的應用</a></li>
    <li><a href="#自定義標註型別時使用的內建標註型別">自定義標註型別時使用的內建標註型別</a></li>
    <li><a href="#開發一般程式碼經常使用的內建標註型別">開發一般程式碼經常使用的內建標註型別</a></li>
  </ul>

  <ul>
    <li><a href="#認識-java-模組化">認識 Java 模組化</a></li>
    <li><a href="#建立和執行模組化程式">建立和執行模組化程式</a></li>
    <li><a href="#建立相依模組程式">建立相依模組程式</a></li>
    <li><a href="#認識-module-infojava-的宣告關鍵字">認識 <code>module-info.java</code> 的宣告關鍵字</a></li>
    <li><a href="#在命令列-command-line-使用模組指令選項">在命令列 <code>command line</code> 使用模組指令選項</a></li>
  </ul>

  <ul>
    <li><a href="#回顧模組指令">回顧模組指令</a></li>
    <li><a href="#比較模組類型">比較模組類型</a></li>
    <li><a href="#分析-jdk-依賴關係">分析 JDK 依賴關係</a></li>
    <li><a href="#模組化既有應用程式">模組化既有應用程式</a></li>
    <li><a href="#模組化-java-服務結構">模組化 Java 服務結構</a></li>
  </ul>

  <ul>
    <li><a href="#設計安全物件">設計安全物件</a></li>
    <li><a href="#注入-injection-攻擊與輸入-input-驗證">注入 <em>injection</em> 攻擊與輸入 <em>input</em> 驗證</a></li>
    <li><a href="#處理機敏資訊">處理機敏資訊</a></li>
    <li><a href="#序列化與反序列化物件">序列化與反序列化物件</a></li>
    <li><a href="#建立保護機敏資料的安全物件">建立保護機敏資料的安全物件</a></li>
    <li><a href="#避免服務阻斷-denial-of-service-攻擊">避免服務阻斷 <em>denial of service</em> 攻擊</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><pre><code># 01 泛型和集合物件
</code></pre>
<h2 id="泛型">泛型</h2>
<p>Java 5 之後加入泛型，使型別使用多了另一種彈性。</p>
<p>集合物件（用來裝填物件）＋泛型，可以限制裝填物件的型別。</p>
<h3 id="使用泛型的效益">使用泛型的效益</h3>
<ol>
<li>提供更彈性的「型別安全 type safety」檢查機制，原本在執行時才能發現的型別錯誤，現在在編譯時期就可以預發現</li>
<li>在集合物件 Collections 裡大量使用，限制內涵物件之型別</li>
<li>減少轉型 casting 需要，使程式碼更簡潔</li>
</ol>
<h3 id="使用泛型設計類別">使用泛型設計類別</h3>
<ul>
<li>可以將程式碼裡的符號 <code>T</code>換成 <code>String</code>( 即 UseString())，或換成 <code>Shirt</code> (即 UseShirt())</li>
<li>常見的符號及表示方式如下：
<ol>
<li><strong>T</strong> -「型別（type）」</li>
<li><strong>E</strong> -「成員（element）」</li>
<li><strong>K</strong> -「鍵 - 值對裡的鍵（key）」</li>
<li><strong>V</strong> -「鍵 - 值對裡的值（value）」</li>
</ol>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UseAny</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> T t<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>T t<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">t</span> <span style="color:#f92672">=</span> t<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> T <span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">t</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UseString</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String message<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>String message<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> message<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">message</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UseShirt</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Shirt shirt<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>Shirt shirt<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">shirt</span> <span style="color:#f92672">=</span> shirt<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Shirt <span style="color:#a6e22e">get</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">shirt</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li>
<p>Java 7 開始，取消「參考型別」和「建構子」都必須在&lt;&gt;符號內加上置換型別的規定，因為等號右側可以由前者推斷（inference）而知其型別</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>UseAny<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> shirt2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UseAny<span style="color:#f92672">&lt;</span>Shirt<span style="color:#f92672">&gt;();</span>
</span></span><span style="display:flex;"><span>UseAny<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> msg2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UseAny<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// see below for simplified code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>UseAny<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> shirt2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UseAny<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>UseAny<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> msg2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UseAny<span style="color:#f92672">&lt;&gt;();</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="集合物件">集合物件</h2>
<h3 id="collection-定義與種類">Collection 定義與種類</h3>
<p>集合物件 <em>Collection</em> 相較陣列具備更多管理功能：</p>
<ol>
<li>以 interface Collection 為代表</li>
<li>集合內物件 <code>elements</code>，簡寫為 <code>E</code></li>
<li>集合內物件必須為參考型別或基本型別的包裹類別 <em>wrapper class</em></li>
<li>有多種常見資料結構，例如 <code>stack</code>、<code>queue</code>、<code>dynamic array</code> 等</li>
<li>大量使用泛型 <code>generic</code></li>
<li>都屬於 <code>java.util.*</code> package</li>
<li>interface Collection 繼承了 interface Iterable，因此所有集合物件都具備使用 Iterator (疊代器) 的能力</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.imgur.com/Dm02pU2.png"
        data-srcset="https://i.imgur.com/Dm02pU2.png, https://i.imgur.com/Dm02pU2.png 1.5x, https://i.imgur.com/Dm02pU2.png 2x"
        data-sizes="auto"
        alt="https://i.imgur.com/Dm02pU2.png"
        title="image-20221214143907275" /></p>
<h3 id="list">List</h3>
<p>集合物件底下最常使用的介面，具備 index 能依照放入先後區分順序 <em>order</em></p>
<ol>
<li>新增 element，使用 index 指定插入位置</li>
<li>新增 element，直接加到尾端</li>
<li>取得 element index</li>
<li>使用 index 移除或覆寫成員</li>
<li>取得 List 長度</li>
</ol>
<h3 id="arraylist--list-最常使用的一種實作類別"><code>ArrayList</code> : List 最常使用的一種實作類別</h3>
<ul>
<li>特色：
<ol>
<li>行為和陣列 <em>array</em> 相近，但長度可以自動成長，又稱為「動態陣列」(dynamic array)</li>
<li>使用 index 新增 / 存取 / 修改 element</li>
<li>可以用 index 區分，所以允許重複成員</li>
</ol>
</li>
<li>未搭配泛型設計的 List
<ol>
<li>使用 Iterator 取出的物件必須轉型</li>
<li>錯放成員時，在執行時期才能知道 (e.g. add Integer, add Integer, and then add String)</li>
</ol>
</li>
</ul>
<h3 id="自動裝箱-boxing和開箱-unboxing">自動裝箱 <code>Boxing</code>和開箱 <code>Unboxing</code></h3>
<ol>
<li>
<p>Primitive → Wrapper Class : 把基本型別裝箱 <em>Boxing</em></p>
</li>
<li>
<p>Wrapper Class → Primitive : 將基本型別由包裹類別的箱子裡取出，開箱 <em>Unboxing</em></p>
</li>
<li>
<p>在迴圈內使用 boxing / unboxing 會讓效能耗損增幅</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Integer partNumObj <span style="color:#f92672">=</span> elements<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> partNum <span style="color:#f92672">=</span> partNumObj<span style="color:#f92672">.</span><span style="color:#a6e22e">intValue</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// see below for concised code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> partNum <span style="color:#f92672">=</span> elements<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">();</span>
</span></span></code></pre></div></li>
</ol>
<h3 id="set">Set</h3>
<ol>
<li>
<p>其成員 element 必須為獨一無二（unique），不能重複</p>
</li>
<li>
<p>沒有 index</p>
</li>
<li>
<p>若放入重複 element，不會出錯，但無效</p>
</li>
<li>
<p>常使用 <code>HashSet</code> 實作類別。<code>TreeSet</code> 類別會依物件特性自動排序</p>
</li>
<li>
<p>element 是否唯一，或是排序先後，取決於方法 <code>equals()</code> 和 <code>hashCode()</code> 的覆寫結果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestSet</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testHashSet</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> set <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        set<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;uno&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        set<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;deux&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        set<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;trois&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        set<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;trois&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String s <span style="color:#f92672">:</span> set<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;item: &#34;</span> <span style="color:#f92672">+</span> s<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// only prints &#34;trois&#34; once
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">testTreeSet</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> set <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TreeSet<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        set<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;uno&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        set<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;deux&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        set<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;trois&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        set<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;trois&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        set<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;turban&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String s <span style="color:#f92672">:</span> set<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;item: &#34;</span> <span style="color:#f92672">+</span> s<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// only prints &#34;trois&#34; once
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">// print by String alphabetical order: d, tr-, tu-, u
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ol>
<h3 id="deque-queue">Deque (Queue)</h3>
<p>Interface Deque 繼承了介面 Queue，特色如下：</p>
<ol>
<li>
<p><strong>Double-Ended Queue</strong> : 具備兩端點的 Queue</p>
</li>
<li>
<p>可同時使用於 Stack 和 Queue 兩種資料結構，只要呼叫不同方法</p>
<ul>
<li>使用<code>add()</code>、<code>remove()</code>時：Deque 物件表現出 Queue 資料結構的行為 (FIFO)</li>
<li>使用<code>push()</code>、<code>pop()</code>時：Deque 物件表現出 Stack 資料結構的行為 (FILO)<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.imgur.com/U7FO4qK.png"
        data-srcset="https://i.imgur.com/U7FO4qK.png, https://i.imgur.com/U7FO4qK.png 1.5x, https://i.imgur.com/U7FO4qK.png 2x"
        data-sizes="auto"
        alt="https://i.imgur.com/U7FO4qK.png"
        title="image-20221214161745531" /></li>
</ul>
</li>
<li>
<p><code>Deque&lt;String&gt; deque = new ArrayDeque&lt;&gt;(); </code></p>
</li>
</ol>
<h2 id="map">Map</h2>
<ul>
<li>
<p>Map 是 key - value 成對集合，但不屬於 Collection 集合物件家族</p>
<ol>
<li><strong>key 物件</strong> : 用來尋找 value 物件，每個 key 物件須為獨特而不重複的</li>
<li><strong>value 物件</strong> : 和 key 物件有關連性（associative）</li>
</ol>
</li>
<li>
<p>在其它語言中，Map 又稱「關聯性陣列 associative arrays」，key 可構成一陣列，value 可構成另一個陣列，兩陣列有著關聯性</p>
</li>
<li>
<p>Map 泛型 &lt;<code>K</code>, <code>V</code>&gt;</p>
</li>
<li>
<p>Map 基本用法</p>
<ul>
<li><code>map.values()</code> 取得 <code>Collection&lt;T of V&gt;</code></li>
<li><code>map.keySet()</code> 取得 <code>Set&lt;T of K&gt;</code> (因為 keys 不能重複，回傳 Set 而非 Collection)</li>
</ul>
</li>
<li>
<p>Map 並未繼承於 Collection interface，Map family 如下：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.imgur.com/talB7Y5.png"
        data-srcset="https://i.imgur.com/talB7Y5.png, https://i.imgur.com/talB7Y5.png 1.5x, https://i.imgur.com/talB7Y5.png 2x"
        data-sizes="auto"
        alt="https://i.imgur.com/talB7Y5.png"
        title="image-20221214165500408" /></p>
</li>
<li>
<p>Map family 常用類別：</p>
<ol>
<li>
<p><strong>TreeMap</strong> : keys 自動依順序排序</p>
</li>
<li>
<p><strong>HashTable</strong> : <em>執行緒安全</em>，且 <em>keys 和 values 不允許為 null</em></p>
</li>
<li>
<p><strong>HashMap</strong> : <em><strong>非</strong>執行緒安全</em>，且 <em>keys 和 values <strong>可</strong>為 null</em></p>
<blockquote>
<p>執行緒安全 :</p>
<p>一個物件被一個執行緒使用和同時被多個執行緒使用時，行為或結果都一致，不會產生非預期結果</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<blockquote>
<p>🍪☕ <strong>LittleTips</strong> : <code>Set</code> 和 <code>Map</code> 兩者都有可以支援排序的分支</p>
<ol>
<li>支援排序的分支起源皆以 <code>Sorted</code> 作為前綴。例：<strong>Sorted</strong>Map 、 <strong>Sorted</strong>Set (interface)</li>
<li>實作類別都是以 <code>Tree</code> 為開頭。例：<strong>Tree</strong>Map 、 <strong>Tree</strong>Set</li>
</ol>
</blockquote>
<h2 id="集合物件成員的排序">集合物件成員的排序</h2>
<h3 id="排序作法">排序作法</h3>
<p>如何排序物件類別，如何定義順序，一個類別可以定義多個排序標準嗎？有以下兩個介面可選擇</p>
<ol>
<li>Comparable 介面 - 實作 <code>compareTo()</code> 方法</li>
<li>Comparator 介面 - 實作 <code>compare()</code> 方法</li>
</ol>
<p>兩種方法都回傳一個整數，表示比較結果：</p>
<ol>
<li>回傳整數 <code>= 0</code>：兩者相等</li>
<li>回傳整數 <code>&lt; 0</code>：表示「自己（this）」**小於（數值上）**或 <strong>先於（順序上）</strong>「方法參數物件」</li>
<li>回傳整數 <code>&gt; 0</code>：表示「自己（this）」**大於（數值上）**或 <strong>後於（順序上）</strong>「方法參數物件」</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Calendar today <span style="color:#f92672">=</span> Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>Calendar tomorrow <span style="color:#f92672">=</span> Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>tomorrow<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">DATE</span><span style="color:#f92672">,</span> 1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>out<span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>today<span style="color:#f92672">.</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span>tomorrow<span style="color:#f92672">));</span>   <span style="color:#75715e">// 字串 today 先於 tomorrow，所以回傳-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>out<span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;A&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;B&#34;</span><span style="color:#f92672">));</span>          <span style="color:#75715e">// 字串&#34;A&#34;早於字串&#34;B&#34;，所以回傳-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>out<span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span>5<span style="color:#f92672">).</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span>Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span>6<span style="color:#f92672">)));</span>
</span></span></code></pre></div><h3 id="使用-comparable-介面排序">使用 <code>Comparable</code> 介面排序</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Comparable</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span>T o<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>特色：</p>
<ol>
<li>
<p>支援泛型設計</p>
</li>
<li>
<p>必須實作 <code>compareTo()</code> 方法，比較自己（this）和方法參數物件</p>
</li>
<li>
<p>一個 class 只能實作一次 Comparable 介面，所以只能提供單一方式排序，可用於 <code>TreeSet</code> 和 <code>TreeMap</code> 等實作類別，或需要物件之間比較的地方</p>
</li>
<li>
<p>決定該物件類別要以哪一個條件決定 Student 物件的排序先後，再讓該類別實作 Comparable 介面</p>
<ol>
<li>必須提供 <code>compareTo()</code> 方法的內容</li>
<li>只能提供一種排序選擇</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Student</span> <span style="color:#66d9ef">implements</span> Comparable<span style="color:#f92672">&lt;</span>Student<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span>Student s<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// use method delegation 方法委派 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> sortById <span style="color:#f92672">=</span> Long<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">).</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> sortByName <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span><span style="color:#f92672">.</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> sortByScome <span style="color:#f92672">=</span> Double<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">score</span><span style="color:#f92672">).</span><span style="color:#a6e22e">compareTO</span><span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">score</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> sortById<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ol>
<h3 id="使用-comparator-介面排序">使用 <code>Comparator</code> 介面排序</h3>
<ul>
<li>
<p>實作 <code>Comparable</code> interface 的類別只有提供一次 <code>compareTo()</code> 方法內容的機會，故只有一種排序能力</p>
</li>
<li>
<p>使用 <code>Comparator</code> interface 則可以提供多種選擇</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JAVA" data-lang="JAVA"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Comparator</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">compare</span><span style="color:#f92672">(</span>T o1<span style="color:#f92672">,</span> T o2<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>特色：</p>
<ol>
<li>
<p>支援泛型設計</p>
</li>
<li>
<p>需實作 <code>compare()</code>，用以比較「第一個參數物件」和「第二個參數物件」</p>
</li>
<li>
<p>可藉由提供多種 Comparator 類別，達成多種排序方式。</p>
<ul>
<li>
<p>常用於搭配以下方法，以幫助 List 成員排序</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sort</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">,</span> Comparator<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">super</span> T<span style="color:#f92672">&gt;</span> c<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    list<span style="color:#f92672">.</span><span style="color:#a6e22e">sort</span><span style="color:#f92672">(</span>c<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NameSorter</span> <span style="color:#66d9ef">implements</span> Comparator<span style="color:#f92672">&lt;</span>Student<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">compare</span><span style="color:#f92672">(</span>Student s1<span style="color:#f92672">,</span> Student s2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> s1<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">().</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span>s2<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ScoreSorter</span> <span style="color:#66d9ef">implements</span> Comparator<span style="color:#f92672">&lt;</span>Student<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">compare</span><span style="color:#f92672">(</span>Student s1<span style="color:#f92672">,</span> Student s2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Double<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span>s1<span style="color:#f92672">.</span><span style="color:#a6e22e">getScore</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span>s2<span style="color:#f92672">.</span><span style="color:#a6e22e">getScore</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestComparator</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">showList</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>Student<span style="color:#f92672">&gt;</span> studentList<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> studentList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">();</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;index#&#34;</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> studentList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>i<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>Student<span style="color:#f92672">&gt;</span> studentList <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span>3<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        studentList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Student<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thomas&#34;</span><span style="color:#f92672">,</span> 1<span style="color:#f92672">,</span> 3<span style="color:#f92672">.</span><span style="color:#a6e22e">8</span><span style="color:#f92672">));</span> 
</span></span><span style="display:flex;"><span>        studentList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Student<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;John&#34;</span><span style="color:#f92672">,</span> 2<span style="color:#f92672">,</span> 3<span style="color:#f92672">.</span><span style="color:#a6e22e">9</span><span style="color:#f92672">));</span> 
</span></span><span style="display:flex;"><span>        studentList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Student<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;George&#34;</span><span style="color:#f92672">,</span> 3<span style="color:#f92672">,</span> 3<span style="color:#f92672">.</span><span style="color:#a6e22e">4</span><span style="color:#f92672">));</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;\n------ Original ------&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        showList<span style="color:#f92672">(</span>studentList<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;\n----- Sort by name -----&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        Comparator<span style="color:#f92672">&lt;</span>Student<span style="color:#f92672">&gt;</span> sortName <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> NameSorter<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">sort</span><span style="color:#f92672">(</span>studentList<span style="color:#f92672">,</span> sortName<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        showList<span style="color:#f92672">(</span>studentList<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;\n----- Sort by score -----&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        Comparator<span style="color:#f92672">&lt;</span>Student<span style="color:#f92672">&gt;</span> sortScore <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ScoreSorter<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">sort</span><span style="color:#f92672">(</span>studentList<span style="color:#f92672">,</span> sortScore<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        showList<span style="color:#f92672">(</span>studentList<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="使用-of-與-copyof-方法建立-listset-與-map-物件">使用 <code>of()</code> 與 <code>copyOf()</code> 方法建立 <code>List</code>、<code>Set</code> 與 <code>Map</code> 物件</h2>
<h3 id="使用of方法建立-list-set-map-物件">使用<code>of()</code>方法建立 List, Set, Map 物件</h3>
<ul>
<li>
<p>自 Java 9 開始，除了傳統使用 new 呼叫子類別建構子以建立 List, Set, Map 物件外</p>
<ul>
<li>
<p>導入靜態工廠方法 <code>of()</code> 來建立不可改變（immutable）的物件</p>
<ul>
<li>
<p><code>List.of()</code> | <code>Set.of()</code> | <code>Map.of()</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> list <span style="color:#f92672">=</span> List<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span> t2<span style="color:#f92672">,</span> <span style="color:#f92672">...);</span>
</span></span><span style="display:flex;"><span>Set<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> set <span style="color:#f92672">=</span> Set<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span> t2<span style="color:#f92672">,</span> <span style="color:#f92672">...);</span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span> V<span style="color:#f92672">&gt;</span> map <span style="color:#f92672">=</span> Map<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>key1<span style="color:#f92672">,</span> value1<span style="color:#f92672">,</span> key2<span style="color:#f92672">,</span> value2<span style="color:#f92672">,</span> <span style="color:#f92672">...);</span>
</span></span></code></pre></div></li>
<li>
<p>line 5, 15, 26 : 以 <code>of()</code> 建立物件後，若再嘗試新增成員（<code>list.add(...)</code>、<code>set.add(...)</code>、<code>map.put(...)</code>），都會拋出 <em><strong>java.lang.UnsupportOperationException</strong></em></p>
</li>
<li>
<p>line 9, 19, 30 : 如果要將不可更改的物件轉換為可更改物件，可將其作為 <code>ArrayList</code>、<code>HashSet</code>、<code>HashMap</code> 等建構子的參數，重新建立可更改物件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createImmutablesByOf</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// List.of()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> list1 <span style="color:#f92672">=</span> List<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i1&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;i2&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;i3&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        list1<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i4&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">// line 5 : UnsupportedException
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> list2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span>list1<span style="color:#f92672">);</span>  <span style="color:#75715e">// line 9 : mutable w/ ArrayList
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    list2<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i4&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>list2<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Set.of()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> set1 <span style="color:#f92672">=</span> Set<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i1&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;i2&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;i3&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        set1<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i4&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">// line 15 : UnsupportedException
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> set2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;&gt;(</span>set1<span style="color:#f92672">);</span>  <span style="color:#75715e">// line 19 : mutable w/ HashSet
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    set2<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i4&#34;</span><span style="color:#f92672">);</span>  
</span></span><span style="display:flex;"><span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>set2<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Map.of()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Employee<span style="color:#f92672">&gt;</span> map1 <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>            Map<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jim&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> Employee<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jim&#34;</span><span style="color:#f92672">),</span> <span style="color:#e6db74">&#34;duke&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> Employee<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;duke&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        map1<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bill&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> Employee<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bill&#34;</span><span style="color:#f92672">));</span> <span style="color:#75715e">// line 26 : UnsupportedException
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Employee<span style="color:#f92672">&gt;</span> map2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;(</span>map1<span style="color:#f92672">);</span>  <span style="color:#75715e">// line 30 : mutable w/ HashMap
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    map2<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bill&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> Employee<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bill&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>map2<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="使用copyof方法建立-list-set-map-物件">使用<code>copyOf()</code>方法建立 List, Set, Map 物件</h3>
<ul>
<li>
<p>從 Java 10 開始，又導入另一個靜態工廠方法 <code>copyOf()</code>，可以建立「<strong>不可改變</strong>」的「<strong>副本物件</strong>」</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createImmutablesByCopyOf</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// List.copyOf()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> list1 <span style="color:#f92672">=</span> List<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i1&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;i2&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;i3&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> list2 <span style="color:#f92672">=</span> List<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>list1<span style="color:#f92672">);</span>     <span style="color:#75715e">// immutable copy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        list2<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i4&#34;</span><span style="color:#f92672">);</span>     <span style="color:#75715e">// UnsupportedOperationException 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Set.copyOf()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> set1 <span style="color:#f92672">=</span> Set<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i1&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;i2&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;i3&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> set2 <span style="color:#f92672">=</span> Set<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>set1<span style="color:#f92672">);</span>     <span style="color:#75715e">// immutable copy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        set2<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i4&#34;</span><span style="color:#f92672">);</span>     <span style="color:#75715e">// UnsupportedOperationException
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Map.copyOf()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Employee<span style="color:#f92672">&gt;</span> map1 <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>            Map<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jim&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> Employee<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jim&#34;</span><span style="color:#f92672">),</span> <span style="color:#e6db74">&#34;duke&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> Employee<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;duke&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Employee<span style="color:#f92672">&gt;</span> map2 <span style="color:#f92672">=</span> Map<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>map1<span style="color:#f92672">);</span>     <span style="color:#75715e">// immutable copy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        map2<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bill&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> Employee<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bill&#34;</span><span style="color:#f92672">));</span>     <span style="color:#75715e">// UnsupportedOperationException
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
<h3 id="使用-arraysaslist建立-list-物件">使用 <code>Arrays.asList()</code>建立 List 物件</h3>
<p>List 另一種以「單個元素成員」作為參數建立 List 物件的方式</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> list <span style="color:#f92672">=</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span> t2<span style="color:#f92672">,</span> <span style="color:#f92672">...);</span>
</span></span></code></pre></div><p>使用 <code>Arrays.asList()</code> 建立的 List 物件和陣列（Array）相似，特性：</p>
<ol>
<li>
<p>長度固定，不可以新增/刪除成員（參考 line 6）</p>
</li>
<li>
<p>可以修改成員（參考 line 4）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createList</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> list1 <span style="color:#f92672">=</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i1&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;i2&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;i3&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        list1<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;iil&#34;</span><span style="color:#f92672">);</span>    <span style="color:#75715e">// line 4 : element updatable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>list1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        list1<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>        <span style="color:#75715e">// line 6 : removing or adding not permitted
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> list2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span>list1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    list2<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>list2<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ol>
<hr>
<h1 id="02-例外與斷言">02 例外與斷言</h1>
<h2 id="例外">例外</h2>
<p>值得信賴的程式會優雅的處理例外狀況：</p>
<ol>
<li>處理目標是「exception（例外）」，非預期狀況</li>
<li>例外必須處理以建立可信賴的程式</li>
<li>發生原因可能是程式 bugs</li>
<li>發生原因可能是程式無法處理的狀況
<ul>
<li>資料庫無法連線</li>
<li>硬碟毀損</li>
</ul>
</li>
</ol>
<p>C語言發生錯誤的話，通常以<strong>回傳負值</strong>表示，例如 <code>int x = printf(&quot;hi&quot;)</code></p>
<p>Java 則在出現錯誤時，由 JVM 拋出例外物件，不同種類的例外，有不同處理方式</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.imgur.com/BHInvNP.png"
        data-srcset="https://i.imgur.com/BHInvNP.png, https://i.imgur.com/BHInvNP.png 1.5x, https://i.imgur.com/BHInvNP.png 2x"
        data-sizes="auto"
        alt="https://i.imgur.com/BHInvNP.png"
        title="image-20221215142633549" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.imgur.com/xYQBNxF.png"
        data-srcset="https://i.imgur.com/xYQBNxF.png, https://i.imgur.com/xYQBNxF.png 1.5x, https://i.imgur.com/xYQBNxF.png 2x"
        data-sizes="auto"
        alt="https://i.imgur.com/xYQBNxF.png"
        title="image-20221215160311402" /></p>
<ul>
<li>當類別方法呼叫其他類別方法時，如果被呼叫的方法已宣告有拋出 <strong>checked exception</strong> 的風險，編譯器會要求呼叫者方法必須處理（handle）或是也宣告（declare）可能發生的問題：
<ol>
<li><strong>Handling Exception</strong>：表示必須有程式碼區塊來處理異常狀況，此時使用「try-catch」敘述</li>
<li><strong>Declaring Exception</strong>：在方法上註記執行可能出現的錯誤，提醒使用的方法必須處理，此時使用「throws」宣告</li>
</ol>
</li>
</ul>
<h3 id="使用try-catch程式碼區塊">使用<code>try-catch</code>程式碼區塊</h3>
<h4 id="一般例外狀況">一般例外狀況</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tryCatchTest</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Opening a file...&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        InputStream in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileInputStream<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;lostFile.txt&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;File is opened&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li>
<p><code>catch</code>程式碼區塊必須傳入 <code>java.lang.Exception</code> 或 <code>java.lang.Throwable</code> 的子類別參考</p>
</li>
<li>
<p>其中<code>java.lang.Throwable</code> 是例外始祖，如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>把 catch 當成一種方法，則後面的 () 代表要傳入的參數</p>
</li>
<li>
<p>傳入大分類的型別（父類別或介面）為多型的應用，但不適用於此，例外處理應該對症下藥</p>
</li>
<li>
<p>catch 方法只讓 Java 在程式遇到錯誤時呼叫 / 傳入例外物件</p>
</li>
<li>
<p>捕捉例外後：</p>
<ol>
<li>紀錄錯誤訊息</li>
<li>重試一次</li>
<li>嘗試其它替代方案</li>
<li>離開（return）或結束程式（exit）</li>
</ol>
</li>
</ul>
<h4 id="複雜例外狀況">複雜例外狀況</h4>
<ul>
<li>
<p>一個程式碼區塊 / 方法，必須同時處理多種可能的例外狀況：</p>
<ol>
<li>
<p>單一「try」搭配多個「catch」：例外子類別排序應該在父類別上面，避免所有例外一開始就被例外父類別（Exception, Throwable）攔截</p>
</li>
<li>
<p>捕捉（catch）物件 Exception 時，盡可能捕捉最特定（specific type）的例外子類別</p>
</li>
<li>
<p>Java Persistence API（JPA）例外大部分繼承 RuntimeException，屬 unchecked exception</p>
<ul>
<li>
<p>慣例上為不用處理的意外，但正式環境裡還是應該處理</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tryCatch</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Opening a file...&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        InputStream in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileInputStream<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;lostFile.txt&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;File is opened&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> data <span style="color:#f92672">=</span> in<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        in<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>FileNotFoundException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ol>
</li>
</ul>
<h4 id="紀錄logging錯誤內容">紀錄（Logging）錯誤內容</h4>
<ul>
<li>正式環境中，應移除 <code>printStackTrace()</code> 或 <code>System.out.println(e.getMessage())</code>此類程式碼</li>
<li>執行錯誤時，應該寫入紀錄 / 日誌檔（log file），相關函式庫
<ol>
<li>Simple logging facade for Java SLF4J</li>
<li>Apache&rsquo;s Log4j</li>
<li>Built-in java.util logging framework</li>
</ol>
</li>
</ul>
<h4 id="使用finally敘述">使用<code>finally</code>敘述</h4>
<ul>
<li>
<p>使用外部資源，例如開啟檔案或連線資料庫，應該在不使用時關閉資源</p>
</li>
<li>
<p>如果在 try 區塊中關閉資源，可能因為執行錯誤而導致資源開了來不及關，此時可用 finally 敘述</p>
<ol>
<li>
<p>不管是 try 或者 catch 執行結束，都一定會進入 finally 程式碼區塊</p>
</li>
<li>
<p>有時在 finally 區的程式碼也可能出錯，因此需要巢狀 try-catch 區塊來處理</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tryCatchFinally</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    InputStream in <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Opening a file...&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileInputStream<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;lostFile.txt&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;File is opened&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> data <span style="color:#f92672">=</span> in<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        in<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>FileNotFoundException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>in <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                in<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>   <span style="color:#75715e">// try to close file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Failed to close file&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ol>
</li>
</ul>
<h3 id="使用-try-with-resources-程式碼區塊和-autocloseable-介面">使用 <code>try-with-resources</code> 程式碼區塊和 <code>AutoCloseable</code> 介面</h3>
<h4 id="使用-try-with-resources-敘述">使用 <code>try-with-resources</code> 敘述</h4>
<ul>
<li>
<p>Java 7 提供新的 <code>try-with-resources</code> 敘述，可自動關閉被開啟的「資源（resources）」</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span> 宣告並開啟資源 <span style="color:#f92672">[;</span> 宣告並開啟其它資源 <span style="color:#f92672">...]</span> <span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 在 try 程式碼區塊之後，資源將自動關閉
</span></span></span></code></pre></div><ol>
<li>
<p>這裡定義的資源，必須為實作 <code>java.lang.AutoCloseable</code> 介面的類別</p>
</li>
<li>
<p>如果要開多個資源，可以使用「<strong>;</strong>」做區隔</p>
</li>
<li>
<p>自動關閉的順序將和使用資源的開啟順序相反</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tryWithResource</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Opening a file...&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span>InputStream in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileInputStream<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;lostFile.txt&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span> <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;File is opened&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> data <span style="color:#f92672">=</span> in<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        in<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>FileNotFoundException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ol>
</li>
</ul>
<p>比較 <code>tryCatchFinally</code> 與 <code>tryWithResource</code>，可以發現：</p>
<ol>
<li>移除 <code>finally</code> 程式碼區塊，如前範例行 16 - 23</li>
<li>使用 <code>try-with-resource</code> 宣告要開啟的資源</li>
</ol>
<h4 id="認識-autocloseable介面">認識 <code>AutoCloseable</code>介面</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InputStream</span> <span style="color:#66d9ef">implements</span> Closeable <span style="color:#f92672">{</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Closeable</span> <span style="color:#66d9ef">extends</span> AutoCloseable <span style="color:#f92672">{</span>
</span></span></code></pre></div><ul>
<li>
<p>資源（resource）要藉由 `try-with-resources‵ 敘述開啟和自動關閉，必須實作以下兩者任一</p>
<ol>
<li>
<p>介面 <em>java.lang.AutoCloseable</em></p>
<ul>
<li>
<p>Java 7 新增</p>
</li>
<li>
<p>唯一的抽象方法 <code>close()</code> 會拋出 Exception 物件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">AutoCloseable</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>介面 <em>java.io.Closeable</em></p>
<ul>
<li>
<p>早期的 Java 版本就存在，在 Java 7 中修改使其繼承介面 <code>AutoCloseable</code></p>
</li>
<li>
<p>唯一的抽象方法 <code>close()</code> 會拋出 <code>IOException</code> 物件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Closeable</span> <span style="color:#66d9ef">extends</span> AutoCloseable <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ol>
</li>
</ul>
<p><strong>Idempotent method</strong> - 即使重複執行多次，也不會有副作用（side effects）產生</p>
<ul>
<li>
<p><code>java.io.Closeable</code> 的 close() 方法必須滿足 idempotent 要求</p>
</li>
<li>
<p><code>java.lang.AutoCloseable</code> 並未一致要求實作之 close() 必須比照辦理</p>
<ul>
<li>
<p>即便如此仍應該要做到反覆執行多次都沒有副作用產生</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// 若資源為關閉（以resource == null 判定）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>If <span style="color:#f92672">(</span>resource <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 關閉資源，並使 resource = null
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
<h3 id="suppressed-exceptions">Suppressed Exceptions</h3>
<p>使用 try-with-resource 也衍伸出新的例外 exception 處理問題必須注意：</p>
<ol>
<li>Java 開啟資源時拋出例外，未成功開啟資源
<ul>
<li>程式碼直接跳到 catch 區，只拋出一個例外</li>
</ul>
</li>
<li>Java 成功開啟資源，但在 try 區拋出例外，在背景關閉資源時又拋出例外
<ul>
<li>共產生 2 個例外</li>
<li>catch 區必須同時接收 2 個例外物件 <strong>衍伸問題</strong></li>
</ul>
</li>
<li>Java 成功開啟資源，try 區塊內任務成功執行，但在關閉資源時出錯
<ul>
<li>和一般情況一樣，只拋出 1 個例外</li>
</ul>
</li>
</ol>
<ul>
<li>
<p>當有兩個例外類別被先後拋出，Java會將 <strong>後發生，同時和關閉資源有關</strong> 的例外物件，隱匿/擠壓（suppressed）到「先發生、也是在 try 區塊造成」的例外物件裡，使其可被保留</p>
</li>
<li>
<p>Java 會將資源相關的例外隱匿 / 擠壓進程式碼的例外裡，只要知道如何將 suppressed 例外物件取出（參以下 line 3 ~ line 5）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Throwable t <span style="color:#f92672">:</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getSuppressed</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>  <span style="color:#75715e">// line 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>t<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>                                        <span style="color:#75715e">// line 5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>對例外物件呼叫 <code>e.getSuppressed()</code> 方法時，可回傳一個 Throwable 陣列</p>
<ul>
<li>在背景被擠壓 / 隱匿的例外，即使再多都能被保存並取出</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TryException</span> <span style="color:#66d9ef">extends</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FinallyException</span> <span style="color:#66d9ef">extends</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SuppressedExceptions</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        before7<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        after7<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">before7</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> TryException<span style="color:#f92672">();</span>   <span style="color:#75715e">// This is lost.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> FinallyException<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;before 7: &#34;</span> <span style="color:#f92672">+</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">after7</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Throwable t <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span> <span style="color:#75715e">// 保留第一個拋出的例外物件 TryException (1/2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> TryException<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                t <span style="color:#f92672">=</span> e<span style="color:#f92672">;</span>  <span style="color:#75715e">// 保留第一個拋出的例外物件 TryException (2/2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                FinallyException fe <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FinallyException<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>t <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    t<span style="color:#f92672">.</span><span style="color:#a6e22e">addSuppressed</span><span style="color:#f92672">(</span>fe<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// 將 finallyException 隱匿至 t, 再拋出 tryException
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">throw</span> t<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">throw</span> fe<span style="color:#f92672">;</span> <span style="color:#75715e">// 若無 tryException, 單獨拋出 finallyException
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Throwable e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;after7: &#34;</span> <span style="color:#f92672">+</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Throwable t <span style="color:#f92672">:</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getSuppressed</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;after7: &#34;</span> <span style="color:#f92672">+</span> t<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="使用-multi-catch-敘述">使用 <code>multi-catch</code> 敘述</h3>
<p>不建議直接捕捉例外的父類別，如 Exception 或 Throwable，因為：</p>
<ol>
<li>每種意外的處理方式應該不同</li>
<li>要清楚知道究竟有多少個例外可能產生</li>
</ol>
<p>如果每種例外處理方式皆相同，則可以使用 Java 7 <code>multi-catch</code> 敘述，優點：</p>
<ol>
<li>可清楚知道究竟有多少例外可能拋出</li>
<li>多種例外，同一種方式處理，簡潔化程式碼</li>
<li><strong>不同例外以「|」區隔時，前後例外必須「沒有繼承關係」</strong>
<ul>
<li>例如 Exception class 不能和以 multi-catch 敘述聚集的例外類別放一起</li>
</ul>
</li>
</ol>
<h3 id="使用-throws-宣告">使用 <code>throws</code> 宣告</h3>
<ul>
<li>
<p>在類別方法上宣告 <code>throws ExceptionTypes</code>，讓呼叫該方法的 caller 處理</p>
</li>
<li>
<p>覆寫子類別方法時，若父類別方法宣告拋出例外</p>
<ol>
<li>
<p><strong>checked exception</strong>，子類別覆寫方法拋出的例外必須：</p>
<ul>
<li>例外型別必須相同，或者為其子類別（覆寫後有精進）</li>
<li>數量相同或更少（表示問題已被處理 improved）</li>
</ul>
</li>
<li>
<p><strong>unchecked exception</strong>：子類別覆寫方法時可不予理會，例如 <code>RuntimeException</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Father</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fatherMethod1</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fatherMethod2</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> RuntimeException<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fatherMethod3</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> SQLException<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Child</span> <span style="color:#66d9ef">extends</span> Father <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fatherMethod1</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> FileNotFoundException <span style="color:#f92672">{</span>		
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>  <span style="color:#75715e">// FileNotFoundException 為 IOException 子類別，未超出 IOException 範圍
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fatherMethod2</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span> <span style="color:#75715e">// 父類別 RuntimeException-UncheckException，子類別可以不處理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fatherMethod3</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>		
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span> <span style="color:#75715e">// SQLException 在方法內使用 try-catch 敘述，妥善處理不再拋出例外
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ol>
</li>
</ul>
<h3 id="建立客製的-exception">建立客製的 <code>Exception</code></h3>
<h4 id="客製化的例外類別">客製化的例外類別</h4>
<p>建立客製化的例外子類別 DAOException，繼承 class Exception</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DAOException</span> <span style="color:#66d9ef">extends</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">DAOException</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">DAOException</span><span style="color:#f92672">(</span>String message<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>message<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li>
<p>標準 Java 不會主動拋出客製化例外子類別，必須先捕捉標準的例外類別，再拋出客製化例外子類別</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// some codes that might cause error
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> DAOException<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
<h4 id="客製化包裹例外類別wrapper-exception">客製化包裹例外類別（Wrapper Exception）</h4>
<ul>
<li>
<p>如果希望再拋出的客製化例外子類別也能保留最初被捕捉的例外類別訊息，可使用 wrapper 例外類別，將最初的例外類別包裹在客製例外類別中</p>
<ul>
<li>
<p>設計客製例外類別</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DAOException</span> <span style="color:#66d9ef">extends</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">DAOException</span><span style="color:#f92672">(</span>Throwable cause<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>cause<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">DAOException</span><span style="color:#f92672">(</span>String msg<span style="color:#f92672">,</span> Throwable cause<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">,</span> cause<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>將捕捉真實例外類別作為客製例外類別的建構子參數</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// some codes might error
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> DAOException<span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>使用 <code>getCause()</code> 方法取出被包裹的原始例外物件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// some codes might cause error
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>DAOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Throwable t <span style="color:#f92672">=</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getCause</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>使用包裹例外型別提供解決範例</p>
<ol>
<li>
<p>先設計介面的抽象方法並宣告拋出 <code>DAOException</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JAVA" data-lang="JAVA"><span style="display:flex;"><span>Employee <span style="color:#a6e22e">findById</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> id<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> DAOException<span style="color:#f92672">;</span>
</span></span></code></pre></div></li>
<li>
<p>File-based 的方法實作方式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> Employee <span style="color:#a6e22e">findById</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> id<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> DAOException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> DAOException<span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>JDBC-based 的方法實作方式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> Employee <span style="color:#a6e22e">findById</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> id<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> DAOException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> getEmployeeFromDatabase<span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> id<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>SQLException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> DAOException<span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="斷言">斷言</h2>
<h3 id="assertions-的簡介和語法">Assertions 的簡介和語法</h3>
<ul>
<li>斷言若失敗被認為是嚴重的問題，表示程式執行結果和預期有出入</li>
<li>程式會拋出 AssertionError 並中斷程式執行，AssertionError 為 unchecked exception。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Syntax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">assert</span> <span style="color:#f92672">&lt;</span>boolean_expression<span style="color:#f92672">&gt;;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> <span style="color:#f92672">&lt;</span>boolean_expression<span style="color:#f92672">&gt;</span> <span style="color:#f92672">:</span> <span style="color:#f92672">&lt;</span>detail_expression<span style="color:#f92672">&gt;;</span>
</span></span></code></pre></div><ol>
<li>&lt;boolean_expression&gt; 若為 false，將拋出 <code>AssertionError</code></li>
<li>&lt;detail_expression&gt; 為捕捉 <code>AssertionError</code> 後呼叫 <code>getMessage()</code> 方法回傳的子串</li>
</ol>
<h4 id="assertions-使用情境">Assertions 使用情境</h4>
<ul>
<li>使用 Assertions 來驗證假設和方法的不變量（不會改變的數值或結果，invariant），通常情況：
<ol>
<li>內部的不變量（internal invariants）</li>
<li>流程控管的不變量（control flow invariants）</li>
<li>事後的狀態和類別不變量（post-conditions &amp; class invariants）</li>
</ol>
</li>
</ul>
<h4 id="assertions-的使用注意事項">Assertions 的使用注意事項</h4>
<ul>
<li>
<p>Assertions 的檢查預設關閉（disabled），使用前必須開啟</p>
</li>
<li>
<p>要避免不當的使用方式：</p>
<ol>
<li>
<p>不可用於類別方法的參數輸入檢查</p>
</li>
<li>
<p>不可影響程式正常流程</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// 將物件的生成放在 assertion 的判斷敘述中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>SomeType s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> <span style="color:#f92672">(</span>s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SomeType<span style="color:#f92672">())</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span></code></pre></div></li>
</ol>
</li>
</ul>
<h3 id="assertions-的使用">Assertions 的使用</h3>
<h4 id="內部的不變量-internal-invariants">內部的不變量 <em>internal invariants</em></h4>
<ul>
<li>
<p>在 else block 加上 <code>assert == 0</code>，使 x 無負值的可能</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>x <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do if x &gt; 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> <span style="color:#f92672">(</span>x <span style="color:#f92672">==</span> 0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
<h4 id="流程控管的不變量-control-flow-invariants">流程控管的不變量 <em>control flow invariants</em></h4>
<ul>
<li>
<p>為始 switch case 不可能進入 default block，直接在 default block 裡使用 assert false</p>
<ul>
<li>
<p>表示程式進到此不用再以 boolean 表達式判斷，而是馬上拋出 <code>AssertError</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">controlFlowInvariants</span><span style="color:#f92672">(</span>Gender g<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> <span style="color:#f92672">(</span>g<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> MALE<span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// do something
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> FEMALE<span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// do something
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">assert</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Unknown gender!!&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
<h4 id="事後的狀態和類別不變量-post-conditions--class-invariants">事後的狀態和類別不變量 <em>post-conditions &amp; class invariants</em></h4>
<ul>
<li>
<p>無論類別欄位經過任何改變，都應該能通過方法 rule() 的檢驗</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyTime</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> hours<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> minutes<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> seconds<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">rule</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span><span style="color:#f92672">(</span>0 <span style="color:#f92672">&lt;=</span> hours <span style="color:#f92672">&amp;&amp;</span> hours <span style="color:#f92672">&lt;</span> 24<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> <span style="color:#f92672">(</span>0 <span style="color:#f92672">&lt;=</span> minutes <span style="color:#f92672">&amp;&amp;</span> minutes <span style="color:#f92672">&lt;</span> 60<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> <span style="color:#f92672">(</span>0 <span style="color:#f92672">&lt;=</span> seconds <span style="color:#f92672">&amp;&amp;</span> seconds <span style="color:#f92672">&lt;</span> 60<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
<h4 id="assertions-的開啟與關閉">Assertions 的開啟與關閉</h4>
<ul>
<li>
<p>Assertions 預設是關閉，關閉後<strong>完全不會執行</strong>，和註解（comment）類似，不影響效能</p>
<pre tabindex="0"><code class="language-terminal" data-lang="terminal">java -enableassertions HelloWord
java -ea HelloWorld
</code></pre></li>
<li>
<p><code>-ea</code>即是 <code>-enableassertions</code>之縮寫</p>
</li>
<li>
<p>若在 <code>-ea</code> 後加上其它選項，可控制 <strong>Assertions 的啟用只在某個 package 或 class</strong></p>
<p><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/language/assert.html#enable-disable" target="_blank" rel="noopener noreffer ">Enable and Disable Assertions</a></p>
</li>
</ul>
<hr>
<h1 id="03-輸入與輸出">03 輸入與輸出</h1>
<h2 id="io-基礎">I/O 基礎</h2>
<ul>
<li>當輸入/輸出行為發生時，好比串流（stream）的流動，流入或流出某個地方</li>
<li>串流需要有來源及目的，ex. 主控台視窗（console）、檔案、資料庫、網路、其它程式</li>
</ul>
<h3 id="何謂-io">何謂 I/O</h3>
<p>基本認知：</p>
<ol>
<li>資料的進出像是水流 / 串流
<ul>
<li>來源流向目的，具有方向性，Java 中稱之為 <code>stream (串流)</code></li>
<li>流動內容主要分為「位元（byte）」和「字元（character）」</li>
</ul>
</li>
<li>水流的流動，若提供管道，稱為 <code>channel</code>，若使用 <code>channel</code> 支援 I/O 會更有效率</li>
</ol>
<h4 id="以-java-程式為區分基準">以 Java 程式為區分基準</h4>
<ol>
<li>
<p>輸入串流 | 來源串流（input stream, source stream）</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.imgur.com/hz0S8PM.png"
        data-srcset="https://i.imgur.com/hz0S8PM.png, https://i.imgur.com/hz0S8PM.png 1.5x, https://i.imgur.com/hz0S8PM.png 2x"
        data-sizes="auto"
        alt="https://i.imgur.com/hz0S8PM.png"
        title="image-20221218122158764" /></p>
</li>
<li>
<p>輸出串流 | 目的串流（output stream, sink stream）</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.imgur.com/2OgU1l1.png"
        data-srcset="https://i.imgur.com/2OgU1l1.png, https://i.imgur.com/2OgU1l1.png 1.5x, https://i.imgur.com/2OgU1l1.png 2x"
        data-sizes="auto"
        alt="https://i.imgur.com/2OgU1l1.png"
        title="image-20221218122209539" /></p>
</li>
</ol>
<h4 id="以程式開發最常用三種端點區分">以程式開發最常用三種端點區分</h4>
<ol>
<li>檔案（files）和目錄（directories）</li>
<li>主控台（console）：標準輸入（standard-in）和標準輸出（standard-out）</li>
<li>Socket 程式（連線遠端系統，需指定 port 通訊）</li>
</ol>
<h3 id="處理串流的類別">處理串流的類別</h3>
<p>依串流內的資料分類、流動方向、處理類別分為四個抽象類別：</p>
<table>
<thead>
<tr>
<th>方向\串流內容</th>
<th>位元（byte）</th>
<th>字元（character）</th>
</tr>
</thead>
<tbody>
<tr>
<td>輸入 Java</td>
<td><code>InputStream</code></td>
<td><code>Reader</code></td>
</tr>
<tr>
<td>輸出 Java</td>
<td><code>OutputStream</code></td>
<td><code>Writer</code></td>
</tr>
</tbody>
</table>
<hr>
<h4 id="class-inputstream">Class <code>InputStream</code></h4>
<table>
<thead>
<tr>
<th>method</th>
<th>name</th>
<th>feature</th>
</tr>
</thead>
<tbody>
<tr>
<td>基本方法</td>
<td><code>int read()</code></td>
<td>每次讀取 1 個 byte</td>
</tr>
<tr>
<td>-</td>
<td><code>int read(byte[] buffer)</code></td>
<td>每次讀取一個 byte[]</td>
</tr>
<tr>
<td>-</td>
<td><code>int read(byte[] buffer, int offset, int length)</code></td>
<td>每次讀取一個 byte[]，可以指定偏移量（offset）和讀取長度（length）</td>
</tr>
<tr>
<td>其它方法</td>
<td><code>void close()</code></td>
<td>關閉 stream</td>
</tr>
<tr>
<td>-</td>
<td><code>int available()</code></td>
<td>有多少的 bytes 可供讀取</td>
</tr>
<tr>
<td>-</td>
<td><code>long skip(long n)</code></td>
<td>讀取時略過 n 個 <strong>bytes</strong></td>
</tr>
<tr>
<td>-</td>
<td><code>boolean markSupported()</code><!-- raw HTML omitted --><code>void mark(int readlimit)</code><!-- raw HTML omitted --><code>void reset()</code></td>
<td>合併用於改變檔案中的讀取位置，特別是回到過去某個指定的讀取位置<!-- raw HTML omitted -->又稱 push-back 操作</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="class-outputstream">Class <code>OutputStream</code></h4>
<table>
<thead>
<tr>
<th>method</th>
<th>name</th>
<th>feature</th>
</tr>
</thead>
<tbody>
<tr>
<td>基本方法</td>
<td><code>void write(int c)</code></td>
<td>將 int 寫入 <code>OutputStream</code></td>
</tr>
<tr>
<td>-</td>
<td><code>void write(byte[] buffer)</code></td>
<td>將 byte[] 寫入 <code>OutputStream</code></td>
</tr>
<tr>
<td>-</td>
<td><code>void write(byte[] buffer, int offset, int length)</code></td>
<td>寫入 byte[] 到 <code>OutputStream</code>，指定長度（length）和偏移量（offset）</td>
</tr>
<tr>
<td>其它方法</td>
<td><code>void close()</code></td>
<td>關閉 stream</td>
</tr>
<tr>
<td>-</td>
<td><code>void flush()</code></td>
<td>強制將 <code>OutputStream</code> 中的資料寫入目的地</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="class-reader">Class <code>Reader</code></h4>
<table>
<thead>
<tr>
<th>method</th>
<th>name</th>
<th>feature</th>
</tr>
</thead>
<tbody>
<tr>
<td>基本方法</td>
<td><code>int read()</code></td>
<td>每次讀取 1 個 <strong>char</strong></td>
</tr>
<tr>
<td>-</td>
<td><code>int read(byte[] buffer)</code></td>
<td>每次讀取一個 char[]</td>
</tr>
<tr>
<td>-</td>
<td><code>int read(byte[] buffer, int offset, int length)</code></td>
<td>每次讀取一個 char[]，可以指定偏移量（offset）和讀取長度（length）</td>
</tr>
<tr>
<td>其它方法</td>
<td><code>void close()</code></td>
<td>關閉 stream</td>
</tr>
<tr>
<td>-</td>
<td><code>boolean ready()</code></td>
<td>確認 stream 是否已經準備好進行資料讀取</td>
</tr>
<tr>
<td>-</td>
<td><code>long skip(long n)</code></td>
<td>讀取時略過 n 個 <strong>chars</strong></td>
</tr>
<tr>
<td>-</td>
<td><code>boolean markSupported()</code><!-- raw HTML omitted --><code>void mark(int readAheadLimit)</code><!-- raw HTML omitted --><code>void reset()</code></td>
<td>合併用於改變檔案中的讀取位置，特別是回到過去某個指定的讀取位置<!-- raw HTML omitted -->又稱 push-back 操作</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="class-writer">Class Writer</h4>
<table>
<thead>
<tr>
<th>method</th>
<th>name</th>
<th>feature</th>
</tr>
</thead>
<tbody>
<tr>
<td>基本方法</td>
<td><code>void write(int c)</code></td>
<td>將 int 寫入 <strong>Writer</strong></td>
</tr>
<tr>
<td>-</td>
<td><code>void write(char[] buffer)</code></td>
<td>將整個 char[] 寫入 Writer</td>
</tr>
<tr>
<td>-</td>
<td><code>void write(char[] buffer, int offset, int length)</code></td>
<td>寫入 char[] 到 Writer，且指定長度（length）和偏移量（offset）</td>
</tr>
<tr>
<td>其它方法</td>
<td><code>void close()</code></td>
<td>關閉 stream</td>
</tr>
<tr>
<td>-</td>
<td><code>void flush()</code></td>
<td>強制將 Writer 中的資料寫入目的地</td>
</tr>
</tbody>
</table>
<h3 id="串流類別的串接">串流類別的串接</h3>
<table>
<thead>
<tr>
<th>功能\串流內容</th>
<th>字元串流　<em>Character Streams</em></th>
<th>位元串流 <em>Byte Streams</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>Buffering（緩衝）</td>
<td><code>BufferReader</code><!-- raw HTML omitted --><code>BufferedWriter</code></td>
<td><code>BufferedInputStream</code><!-- raw HTML omitted --><code>BufferedOutputStream</code></td>
</tr>
<tr>
<td>Filtering（過濾）</td>
<td><code>FilterReader</code><!-- raw HTML omitted --><code>FilterWriter</code></td>
<td><code>FilterInputStream</code><!-- raw HTML omitted --><code>FilterOutputStream</code></td>
</tr>
<tr>
<td>Conversion（位元轉換為字元）</td>
<td><code>InputStreamReader</code><!-- raw HTML omitted --><code>OutputStreamWriter</code></td>
<td></td>
</tr>
<tr>
<td>Object serialization（物件序列化）</td>
<td></td>
<td><code>ObjectInputStream</code><!-- raw HTML omitted --><code>ObjectOutputStream</code></td>
</tr>
<tr>
<td>Data conversion（資料型態轉換）</td>
<td></td>
<td><code>DataInputStream</code><!-- raw HTML omitted --><code>DataOutputStream</code></td>
</tr>
<tr>
<td>Counting（計算行數）</td>
<td><code>LineNumberReader</code></td>
<td><code>LineNumberInputStream</code></td>
</tr>
<tr>
<td>Printing（列印）</td>
<td><code>PrintWriter</code></td>
<td><code>PrintStream</code></td>
</tr>
</tbody>
</table>
<h3 id="使用-javaiofile-類別">使用 <code>java.io.File</code> 類別</h3>
<p><code>java.io.File</code> 常用方法：</p>
<table>
<thead>
<tr>
<th>method</th>
<th>return type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getName()</code></td>
<td>String</td>
<td>取得檔案或目錄的名稱</td>
</tr>
<tr>
<td><code>getParent()</code></td>
<td>String</td>
<td>取得父目錄的名稱</td>
</tr>
<tr>
<td><code>getParentFile()</code></td>
<td>File</td>
<td>取得代表父目錄的 File 物件</td>
</tr>
<tr>
<td><code>getPath()</code></td>
<td>String</td>
<td>取得檔案或目錄的路徑</td>
</tr>
<tr>
<td><code>isAbsolute()</code></td>
<td>boolean</td>
<td>是否為絕對路徑</td>
</tr>
<tr>
<td><code>getAbsolutePath()</code></td>
<td>String</td>
<td>取得絕對路徑</td>
</tr>
<tr>
<td><code>canRead()</code></td>
<td>boolean</td>
<td>是否可讀取</td>
</tr>
<tr>
<td><code>canWrite()</code></td>
<td>boolean</td>
<td>是否可修改</td>
</tr>
<tr>
<td><code>exists()</code></td>
<td>boolean</td>
<td>是否存在</td>
</tr>
<tr>
<td><code>isDirectory()</code></td>
<td>boolean</td>
<td>是否為目錄</td>
</tr>
<tr>
<td><code>isFile()</code></td>
<td>boolean</td>
<td>是否為檔案</td>
</tr>
<tr>
<td><code>lastModified()</code></td>
<td>long</td>
<td>取得最後一次修改時間</td>
</tr>
<tr>
<td><code>length()</code></td>
<td>long</td>
<td>取得檔案大小</td>
</tr>
<tr>
<td><code>delete()</code></td>
<td>boolean</td>
<td>刪除檔案或目錄並回傳成功與否</td>
</tr>
<tr>
<td><code>list()</code></td>
<td>String[]</td>
<td>列舉目錄下的檔案與子目錄</td>
</tr>
<tr>
<td><code>listFiles()</code></td>
<td>File[]</td>
<td>列舉目錄下的檔案與子目錄的 File 物件</td>
</tr>
<tr>
<td><code>mkdir()</code></td>
<td>boolean</td>
<td>建立目錄</td>
</tr>
<tr>
<td><code>mkdirs()</code></td>
<td>boolean</td>
<td>建立目錄 + 不存在但是需要一併建立的父目錄</td>
</tr>
<tr>
<td><code>renameTo(File)</code></td>
<td>boolean</td>
<td>重新命名</td>
</tr>
<tr>
<td><code>createTempFIle()</code></td>
<td>File</td>
<td>建立暫存檔案，有多載版本</td>
</tr>
<tr>
<td><code>setLastModified(long)</code></td>
<td>boolean</td>
<td>設定最後一次修改時間</td>
</tr>
<tr>
<td><code>setReadOnly()</code></td>
<td>boolean</td>
<td>設定成唯讀</td>
</tr>
</tbody>
</table>
<h2 id="由主控台讀寫資料">由主控台讀寫資料</h2>
<h3 id="主控台的-io">主控台的 I/O</h3>
<p><code>java.lang.System</code> 類別裡的三個 static 欄位</p>
<table>
<thead>
<tr>
<th>「欄位</th>
<th>欄位型別</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>System.out</code></td>
<td><code>PrintStream</code></td>
<td>將訊息輸出至 console，又稱 <strong>標準輸出</strong>（standard output）<!-- raw HTML omitted -->可接受由主控台再經<code>&gt;</code> 或 <code>&gt;&gt;</code> 的「重新導向指令」，將輸出內容導向至另外一個檔案</td>
</tr>
<tr>
<td><code>System.in</code></td>
<td><code>InputStream</code></td>
<td>由 console 接收來自鍵盤或其他來源的訊息輸入<!-- raw HTML omitted -->又稱 <strong>標準輸入</strong>（standard input）</td>
</tr>
<tr>
<td><code>System.err</code></td>
<td><code>PrintStream</code></td>
<td>和 <code>System.out</code> 一樣都是輸出訊息至 console<!-- raw HTML omitted -->但主要用於輸出錯誤訊息，較為急迫必須立即顯示，因此「重新導向指令」無效，依然顯示在 console <!-- raw HTML omitted -->使用 Eclipse IDE 的話，輸出顏色為紅色（警示用）</td>
</tr>
</tbody>
</table>
<h3 id="使用標準輸出方法">使用標準輸出方法</h3>
<ul>
<li><code>println()</code> 輸出換行符、<code>print()</code>不輸出換行符號</li>
<li>以上兩方法對大部分基本型別以及參考型別都有多載方法支援
<ul>
<li>boolean, char, int, long, float, double、char[], <code>Object</code>, <code>String</code></li>
<li>其它參考型別則呼叫該物件的 <code>toString()</code> 方法</li>
</ul>
</li>
</ul>
<h3 id="javaioconsole-類別介紹"><code>java.io.Console</code> 類別介紹</h3>
<ul>
<li>
<p>除了使用前述 <code>System.in</code> 取得主控台標準輸入外，也可以用 <code>java.io.Console</code> 物件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JAVA" data-lang="JAVA"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConsoleInput</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Console cons <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">console</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 使用 System.console() 方法取得 Console 物件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">boolean</span> userValid <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cons <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            String account<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            String passwd<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">do</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                account <span style="color:#f92672">=</span> cons<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%s&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Account: &#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// readline() 可取得指令列輸入的資料
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                passwd <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span>cons<span style="color:#f92672">.</span><span style="color:#a6e22e">readPassword</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%s&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Password: &#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// readPassword() 除了可以取得指令列輸入的資料，
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#75715e">// 還能隱藏使用者輸入內容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>account<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;joanna&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> passwd<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Correct! System quits!&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                    userValid <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Wrong! Try again!&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">while</span> <span style="color:#f92672">(!</span>userValid<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 後測式迴圈：先輸入再驗證，失敗繼續，成功終止
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.imgur.com/Q8HsrVi.png"
        data-srcset="https://i.imgur.com/Q8HsrVi.png, https://i.imgur.com/Q8HsrVi.png 1.5x, https://i.imgur.com/Q8HsrVi.png 2x"
        data-sizes="auto"
        alt="https://i.imgur.com/Q8HsrVi.png"
        title="image-20221218141013717" /></p>
</li>
</ul>
<h2 id="channel-io">Channel I/O</h2>
<ul>
<li>Channel : 可以指兩個設備之間傳送資訊經過的通路或連接
<ul>
<li>導入於 JDK 1.4，屬於 <code>java.nio</code> package</li>
<li>可以一次大量讀入位元和字元，不需要以迴圈每次讀取少量內容</li>
<li>程式更簡潔，程式效能更好</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.nio.ByteBuffer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.nio.channels.FileChannel<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CopyByteChannel</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		String source <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span> target <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span>FileChannel in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileInputStream<span style="color:#f92672">(</span>source<span style="color:#f92672">).</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>				FileChannel out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileOutputStream<span style="color:#f92672">(</span>target<span style="color:#f92672">).</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			ByteBuffer buff <span style="color:#f92672">=</span> ByteBuffer<span style="color:#f92672">.</span><span style="color:#a6e22e">allocate</span><span style="color:#f92672">((</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> in<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>             <span style="color:#75715e">// 建立和 source 檔案 size 大小相同的 ByteBuffer 物件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			in<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>buff<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>             <span style="color:#75715e">// 將實體檔案一次全數讀入到 ByteBuffer 物件中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			buff<span style="color:#f92672">.</span><span style="color:#a6e22e">position</span><span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>             <span style="color:#75715e">// 將 ByteBuffer 裡的標示位置移到最前面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			out<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>buff<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e">/* 將 ByteBuffer 裡的資料全數輸出至 FileChannel out，再由其輸出為檔案
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">          因為 FileChannel 的 read() 和 write() 方法都是透過 ByteBuffer 物件一次搞定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">          所以不用迴圈（loop）分次處理 */</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>FileNotFoundException f<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			f<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			i<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="使用序列化技術讀寫物件">使用序列化技術讀寫物件</h2>
<p>🚧🚧🚧🚧🚧</p>
<h3 id="java-裡的資料保存-persistence">Java 裡的資料保存 <em>Persistence</em></h3>
<h3 id="序列化和物件圖譜">序列化和物件圖譜</h3>
<h3 id="不需要參加序列化的欄位">不需要參加序列化的欄位</h3>
<h3 id="定義物件保存的版本號碼">定義物件保存的版本號碼</h3>
<h3 id="序列化和反序列化範例">序列化和反序列化範例</h3>
<h4 id="1-class-shirt">1. class Shirt</h4>
<h4 id="2-class-order">2. class Order</h4>
<h3 id="3-serialization-and-de-serialization">3. Serialization and De-serialization</h3>
<hr>
<h1 id="04-nio2">04 NIO.2</h1>
<h2 id="nio2-基礎">NIO.2 基礎</h2>
<h3 id="javajofile限制"><code>java.jo.File</code>限制</h3>
<h3 id="java-io-套件發展歷史">Java I/O 套件發展歷史</h3>
<h3 id="檔案系統路徑和檔案">檔案系統、路徑和檔案</h3>
<h3 id="symbolic-link-檔案">Symbolic Link 檔案</h3>
<h3 id="nio2-的基本架構">NIO.2 的基本架構</h3>
<h2 id="使用-path-介面操作檔案目錄">使用 Path 介面操作檔案/目錄</h2>
<h3 id="path-介面">Path 介面</h3>
<h3 id="path-介面主要功能">Path 介面主要功能</h3>
<h3 id="移除路徑裡的多餘組成">移除路徑裡的多餘組成</h3>
<h3 id="建立子路徑">建立子路徑</h3>
<h3 id="結合-2-個路徑">結合 2 個路徑</h3>
<h3 id="建立連接-2-個路徑的路徑">建立連接 2 個路徑的路徑</h3>
<h3 id="hard-link">Hard Link</h3>
<h3 id="處理-symbolic-link">處理 Symbolic Link</h3>
<h2 id="使用-files-類別對檔案目錄進行檢查刪除複製移動">使用 Files 類別對檔案/目錄進行檢查刪除複製移動</h2>
<h3 id="處理檔案">處理檔案</h3>
<h3 id="檢查檔案--目錄是否存在">檢查檔案 / 目錄是否存在</h3>
<h3 id="檢查檔案--目錄屬性">檢查檔案 / 目錄屬性</h3>
<h3 id="建立檔案--目錄">建立檔案 / 目錄</h3>
<h3 id="刪除檔案--目錄">刪除檔案 / 目錄</h3>
<h3 id="複製和移動檔案--目錄">複製和移動檔案 / 目錄</h3>
<h3 id="stream-和-path-互相複製">Stream 和 Path 互相複製</h3>
<h3 id="列出目錄內容">列出目錄內容</h3>
<h3 id="讀取和寫入檔案">讀取和寫入檔案</h3>
<hr>
<h2 id="使用-files-類別操作-channel-io-和-stream-io-讀寫檔案">使用 Files 類別操作 Channel I/O 和 Stream I/O 讀寫檔案</h2>
<h3 id="介面-channel-和類別-bytebuffer">介面 Channel 和類別 ByteBuffer</h3>
<h3 id="隨機存取檔案">隨機存取檔案</h3>
<h3 id="對文字檔提供-buffered-io-方法">對文字檔提供 Buffered I/O 方法</h3>
<h3 id="取得位元串流物件的方法">取得位元串流物件的方法</h3>
<hr>
<h2 id="讀寫檔案目錄的屬性">讀寫檔案/目錄的屬性</h2>
<h3 id="使用-files-管理檔案的屬性資料">使用 Files 管理檔案的屬性資料</h3>
<h3 id="讀取檔案屬性">讀取檔案屬性</h3>
<h3 id="修改檔案屬性">修改檔案屬性</h3>
<h3 id="dos-之外的-file-attribute-views">DOS 之外的 File Attribute Views</h3>
<h3 id="posix-檔案系統的權限"><code>POSIX</code> 檔案系統的權限</h3>
<hr>
<h2 id="遞迴存取目錄結構">遞迴存取目錄結構</h2>
<h3 id="對檔案目錄進行遞迴操作">對檔案目錄進行遞迴操作</h3>
<hr>
<h2 id="使用-pathmatcher-類別找尋符合的檔案">使用 <code>PathMatcher</code> 類別找尋符合的檔案</h2>
<h3 id="搜尋檔案">搜尋檔案</h3>
<h3 id="glob-樣式語法介紹"><code>glob</code> 樣式語法介紹</h3>
<hr>
<h2 id="其它">其它</h2>
<h3 id="filestore-類別"><code>FileStore</code> 類別</h3>
<h3 id="使用-watchservice">使用 <code>WatchService</code></h3>
<h3 id="由基礎-io-轉換至-nio2">由基礎 I/O 轉換至 NIO.2</h3>
<p>🚧🚧🚧🚧🚧</p>
<hr>
<h1 id="05-執行緒">05 執行緒</h1>
<h2 id="介紹">介紹</h2>
<h3 id="名詞說明">名詞說明</h3>
<h4 id="先占式多工preemptive-multitasking">先占式多工（Preemptive Multitasking）</h4>
<ul>
<li>現代電腦要執行的程式個數經常遠多於 CPU 核數，為了讓程式都可以有機會執行，每個要執行的任務會被分配到一小段 CPU 時間（time slice），使每個任務都能分享到 CPU 資源來完成工作</li>
<li>CPU 時間通常以毫秒 <code>milliseconds</code> 來計算，一旦使用完畢，任務就暫停執行，等待下次分配</li>
</ul>
<h4 id="任務排程task-scheduling">任務排程（Task Scheduling）</h4>
<ul>
<li>大部分作業系統都支援多工（multitasking），把 CPU 時間分配給所有執行程式</li>
<li>程式兩個重要組成
<ol>
<li><strong>程序 Process</strong>
<ul>
<li>擁有記憶體來儲存資料（data）和程式碼（code）</li>
<li>使用執行緒接受分配 CPU 時間以執行程式</li>
</ul>
</li>
<li><strong>執行緒 Thread</strong>
<ul>
<li>程序可同時擁有多個執行緒各司其職</li>
<li>這些執行緒共享程序的記憶體裡的資料</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="多執行緒的重要性">多執行緒的重要性</h3>
<p>要讓程式快速執行，必須避免「效能瓶頸（<em>performance bottlenecks</em>）」，常見瓶頸：</p>
<ol>
<li><strong>資源競爭</strong>（<strong>Resource Contention</strong>）：多個任務搶奪同一獨佔資源，未搶到必須等待</li>
<li><strong>輸出/輸入操作阻礙</strong>（<strong>I/O Operations Blocking</strong>）：通常為等待硬碟或網路傳輸資料</li>
<li><strong>CPU 資源未充分使用</strong>（<strong>Underutilization of CPUs</strong>）：程式只用到單核 CPU</li>
</ol>
<h3 id="執行緒類別">執行緒類別</h3>
<p>Java 類別 Thread 的兩種建立方式：</p>
<table>
<thead>
<tr>
<th>action</th>
<th>benefits/perks</th>
</tr>
</thead>
<tbody>
<tr>
<td>直接繼承 Thread 類別</td>
<td>比較簡單</td>
</tr>
<tr>
<td>實作 Runnable 介面</td>
<td>比較有彈性，可以再繼承其它類別</td>
</tr>
</tbody>
</table>
<h4 id="建立執行緒直接繼承-thread-類別">建立執行緒：直接繼承 Thread 類別</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleThread</span> <span style="color:#66d9ef">extends</span> Thread <span style="color:#f92672">{</span>  <span style="color:#75715e">// #1 繼承 java.lang.Thread 類別
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>  <span style="color:#75715e">// #2 覆寫 run() 方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 100<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i:&#34;</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li>
<p>啟用執行緒：</p>
<ul>
<li>
<p>要呼叫 <code>start()</code> 方法，Java 會啟動獨立執行緒執行 <code>run()</code> 方法內容</p>
</li>
<li>
<p>若直接呼叫 <code>run()</code> 方法，將和一般方法無異</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JAVA" data-lang="JAVA"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ExampleThread<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    t1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
<h4 id="建立執行緒實作-runnable-介面">建立執行緒：實作 Runnable 介面</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleRunnable</span> <span style="color:#66d9ef">implements</span> Runnable <span style="color:#f92672">{</span>  <span style="color:#75715e">// #1 實作 java.lang.Runnable 介面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Override</span>   
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#75715e">// #2 覆寫 run() 方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 100<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i:&#34;</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li>
<p>若要以實作 <code>Runnable</code> 的類別啟動執行緒，可將其物件放入 Thread 類別的建構子，並用 <code>start()</code> 啟動</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Runnable r1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ExampleRunnable<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>r1<span style="color:#f92672">);</span> <span style="color:#75715e">// 將 ExampleRunnable 物件放入 Thread constructor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    t1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="執行緒常見問題">執行緒常見問題</h2>
<p>執行緒常遇到問題的三類原因：</p>
<ol>
<li>使用分享的資料 <em>shared data</em></li>
<li>使用可分段的方法 <em>non-atomic function</em></li>
<li>使用快取的資料 <em>cached data</em></li>
</ol>
<h3 id="使用-shared-data-可能造成的問題">使用 <code>Shared Data</code> 可能造成的問題</h3>
<p>執行緒會潛在 static 和 instance 欄位，可能造成問題如下：</p>
<ol>
<li>
<p>執行緒物件目的在執行其 <code>run()</code> 方法</p>
<ul>
<li>若多個執行緒都要執行 <code>run()</code>，就要注意該方法共用的部分</li>
<li>例如：物件實例欄位會被同時存取（concurrently accessed）</li>
</ul>
</li>
<li>
<p>static 欄位原本就是分享的資料，也無法避免同時被存取的情況</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleRunnable</span> <span style="color:#66d9ef">implements</span> Runnable <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> i<span style="color:#f92672">;</span>  <span style="color:#75715e">// 將被共用!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">print</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;i:&#34;</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;, &#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        ExampleRunnable r1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ExampleRunnable<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>r1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        t1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        Thread t2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>r1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        t2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.imgur.com/h3ufiAX.png"
        data-srcset="https://i.imgur.com/h3ufiAX.png, https://i.imgur.com/h3ufiAX.png 1.5x, https://i.imgur.com/h3ufiAX.png 2x"
        data-sizes="auto"
        alt="https://i.imgur.com/h3ufiAX.png"
        title="image-20221218163741687" /></p>
<ul>
<li>
<p>以上結果和預期結果有落差</p>
<p><code>i:0, i:1, i:2, i:3, i:4, i:5, i:6, i:7, i:8, i:9,</code></p>
</li>
<li>
<p>當前述類別（<strong>static</strong>）和物件實例（<strong>instance</strong>）欄位資料被多個執行緒共用，出現執行異常時，IDE 是無法警告的</p>
</li>
<li>
<p>因此 <em><strong>安全地（safely）處理被分享的資料</strong></em>，就成為程式設計師的義務</p>
</li>
<li>
<p>資料若因為多個執行緒同時存取而產生錯誤，一般不好處理</p>
<ol>
<li>Thread 的分配由作業系統決定，程式設計師無法干預</li>
<li>每一台機器的 CPU 效能、個數不盡然相同</li>
<li>其它程式也會占用 CPU 時間</li>
</ol>
</li>
<li>
<p>因此可能有在測試環境無異常，但部署到正式環境後卻經常發生奇怪狀況</p>
<ul>
<li>盡可能使用執行緒安全的設計（thread-safe），減少使用 <code>shared data</code></li>
</ul>
</li>
<li>
<p>類別內有些資料不會被多執行緒分享，永遠都 <code>thread-safe</code> 的例子</p>
<ol>
<li>區域變數 <em>local variables</em></li>
<li>方法參數 <em>method parameters</em></li>
<li>例外處理參數 <em>exception handler parameters</em></li>
</ol>
</li>
</ul>
</li>
</ol>
<h3 id="使用-non-atomic-functions-可能造成的問題">使用 <code>Non-Atomic Functions</code> 可能造成的問題</h3>
<ul>
<li><code>atomic function</code> - 用原子的概念描述一個功能
<ul>
<li>原子無法再分割，代表 <code>single function</code>，即該功能只有一個步驟</li>
</ul>
</li>
<li>Java 裡，即使程式碼只有一句敘述，也不代表它就是 <code>atomic function</code>
<ul>
<li>以整數 i 使用 遞增運算子的 <code>i++</code> 為例，Java 以 3 個步驟執行
<ol>
<li>對整數 <code>i</code> 建立暫時副本</li>
<li>暫時副本增加 1</li>
<li>將暫時副本的結果回寫 <code>i</code></li>
</ol>
</li>
<li>另外有些 64 bit 變數的存取也可以使用 2 個 32 bit 的操作完成</li>
</ul>
</li>
</ul>
<h3 id="使用-catched-data-可能造成的問題">使用 <code>Catched Data</code> 可能造成的問題</h3>
<ul>
<li>執行緒 <code>thread</code> 因為程序 <code>process</code> 需要同時執行不同工作而產生</li>
<li>為求執行效能，執行緒啟動時，會將程序中的 <code>main memory</code> 內的分享資料複製一份，放在自己的 <code>working memory</code> 作為快取複製（<code>cached copies</code>），工作結束後寫回，如此一來可以避免程式進行過程中，執行緒必須不斷向程序要求資料而造成的效率問題</li>
<li>這樣的設計，讓執行過程中的每一執行緒各自努力，無法<strong>即時</strong>和其他執行緒分享工作成果，必須等到工作結束</li>
<li>只有以下情況才能讓執行緒將各自 working memory 的異動結果寫回 main memory：
<ol>
<li>使用到 <code>volatile</code> 宣告的變數</li>
<li>使用到 <code>synchronized</code> 宣告的方法，亦即準備鎖定和解索物件 monitor</li>
<li>執行緒執行時的第一個動作或最後一個動作</li>
<li>執行緒啟動或執行緒結束時</li>
</ol>
</li>
<li>若程式設計需要多執行緒在工作過程仍然能互相溝通訊息，就必須善用上述四個條件
<ul>
<li>尤其是使用 <code>volatile</code> 關鍵字宣告，其由來和使用方式：
<ol>
<li>程式設計中，如果資料經常維持不變，可以將之固定在記憶體裡，或複製出來使用，稱之為「<strong>快取複製</strong>（cached copies）」</li>
<li>單字 <code>volatile</code> 解釋為「<strong>易變的、反覆無常的</strong>」：
<ul>
<li>加上此宣告相當於告訴 Java 該欄位經常有變化，不適合產生快取複製</li>
<li>因此所有執行緒將皆存取同一份資料，例：<code>volatile int i;</code></li>
</ul>
</li>
<li>必須了解宣告 <code>volatile</code> 只是不產生快取複製，和執行緒安全是兩回事
<ul>
<li>還是必須利用先前所提的作法來保證執行緒安全</li>
<li>volatile 宣告可以應用在「精準終止執行緒的執行」</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JAVA" data-lang="JAVA"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyRunnable</span> <span style="color:#66d9ef">implements</span> Runnable <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">volatile</span> <span style="color:#66d9ef">boolean</span> running <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>  <span style="color:#75715e">// line 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread started&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>running<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread finishing&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">StopThreadExample</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        MyRunnable r1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MyRunnable<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>r1<span style="color:#f92672">);</span>       <span style="color:#75715e">// line 16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        t1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        r1<span style="color:#f92672">.</span><span style="color:#a6e22e">running</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span> <span style="color:#75715e">// line 19 : terminate the thread immediately
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><table>
<thead>
<tr>
<th>line#</th>
<th>desc</th>
</tr>
</thead>
<tbody>
<tr>
<td>16</td>
<td>thread <code>t1</code> 在啟動前<strong>預設</strong>會自己複製一份變數 running（值=true）作為快取複製</td>
</tr>
<tr>
<td>2</td>
<td>所以如果沒有宣告變數 running 為 <code>volatile</code></td>
</tr>
<tr>
<td>19</td>
<td>即便在 main 執行緒將 running 改為 false，執行緒 t1 不一定會馬上知道，必須等到有事件觸發，讓 working memory 和 main memory 同步，執行緒 <code>t1</code> 才會收到通知而停止</td>
</tr>
</tbody>
</table>
<p>&hellip;</p>
<h2 id="執行緒的-synchronized-與等待">執行緒的 synchronized 與等待</h2>
<h3 id="使用-synchronized-關鍵字">使用 <code>synchronized</code> 關鍵字</h3>
<ul>
<li>
<p>建立執行緒安全的程式，除了盡量使用執行緒安全的變數之外，就是使用「<strong>synchronized</strong>」關鍵字宣告<em>方法</em>或是<em>更小的程式碼區塊</em>：</p>
<ol>
<li><code>synchronized</code> 和 <code>volatile</code> 宣告有類似功用：
<ul>
<li>執行緒在執行該區塊的最初和最後時，會將變數值寫回 main memory</li>
</ul>
</li>
<li>該區塊為獨占執行（<em>exclusive execution</em>）：
<ul>
<li>亦即同一時間只允許一個執行緒使用</li>
<li>可解決 <code>non-atomic</code>問題，所以區塊內為執行緒安全</li>
</ul>
</li>
</ol>
</li>
<li>
<p>執行緒取得獨占執行權的機制：</p>
<ol>
<li>
<p>每個 Java 物件都有一個「<strong>object monitor</strong>」，執行緒可以對它進行鎖定（lock）和解鎖（unlock）</p>
<ul>
<li>若鎖定成功，表示取得該物件的獨占執行權</li>
<li>此時其它執行緒無法使用該物件的 <code>synchronized</code> 程式區塊，等同單一執行緒環境</li>
</ul>
</li>
<li>
<p>要使用宣告 <code>synchronized</code> 的方法，就必須取得「<strong>this</strong>」的 object monitor</p>
</li>
<li>
<p>要使用宣告 <code>static</code> 的方法，同理也必須取得類別的「<strong>class monitor</strong>」</p>
</li>
<li>
<p>要使用宣告 <code>synchronized</code> 區塊，必須指定要使用哪一個物件的 monitor</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>使用 <code>synchronized</code> 區塊可以有巢狀結構，且可以使用不同的 object monitor</p>
</li>
</ol>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SynchronizedAll</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sleep</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>			Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>5000<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">m1</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		sleep<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-- Run m1() at: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">new</span> Date<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">m2</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		sleep<span style="color:#f92672">();</span>	
</span></span><span style="display:flex;"><span>		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-- Run m2() at: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">new</span> Date<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span> <span style="color:#75715e">/* 將兩個public方法都宣告為synchronized，如此建立出的物件，
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     m1()和m2()方法將同時只能有一個被呼叫執行 */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">M1Runner</span> <span style="color:#66d9ef">extends</span> Thread <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	SynchronizedAll o<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>	M1Runner<span style="color:#f92672">(</span>SynchronizedAll o<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">o</span> <span style="color:#f92672">=</span> o<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 建立執行緒類別M1Runner，在建構子傳入一個SynchronizedAll物件後，呼叫m1()方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		o<span style="color:#f92672">.</span><span style="color:#a6e22e">m1</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">M2Runner</span> <span style="color:#66d9ef">extends</span> Thread <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	SynchronizedAll o<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>	M2Runner<span style="color:#f92672">(</span>SynchronizedAll o<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">o</span> <span style="color:#f92672">=</span> o<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 建立執行緒類別M2Runner，在建構子傳入一個SynchronizedAll物件後，呼叫m2()方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		o<span style="color:#f92672">.</span><span style="color:#a6e22e">m2</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SynchronizedTest</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		SynchronizedAll o <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SynchronizedAll<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">// 建立一個 SynchronizedAll 物件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        
</span></span><span style="display:flex;"><span>		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Start main at: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">new</span> Date<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>		Thread m1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> M1Runner<span style="color:#f92672">(</span>o<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		m1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 建立 M1Runner 執行緒物件，並傳入之前建立的 SynchronizedAll 物件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        
</span></span><span style="display:flex;"><span>		Thread m2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> M2Runner<span style="color:#f92672">(</span>o<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>		m2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 建立 M2Runner 執行緒物件，
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 並傳入和 M1Runner 所傳入的相同的 SynchronizedAll 物件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//m1.interrupt();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;End main at: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">new</span> Date<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><blockquote>
<p>因為 <code>SynchronizedAll</code> 內 <code>m1()</code> 及 <code>m2()</code> 方法都是 <code>synchronized</code>，要執行都要取得 this 的 object monitor，因此同時間只能有一個方法被呼叫</p>
</blockquote>
<h3 id="使用-synchronized-的時機">使用 <code>synchronized</code> 的時機</h3>
<ul>
<li><code>java.util.ConcurrentModificationException</code> :
<ul>
<li>如果 Java 偵測到集合物件的內容將被同時修改（不限定是否多執行緒所為），就會拋出 <code>ConcurrentModificationException</code>
<ul>
<li>此為「<strong>fail-fast</strong>」行為模式，亦即對於錯誤或是可能造成錯誤的情況，馬上作出反應</li>
<li>為了避免發生 <strong>fail-fast</strong> 狀況，應避免在執行 getSummary() 方法時，其它 2 個方法被同時呼叫
<ul>
<li>可以將這三個方法都宣告為 <code>synchronized</code>，如此要呼叫方法前，必須取得該物件的唯一 <strong>object monitor</strong>，就不會有被同時執行的可能性</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>ConcurrentModificationException</code> 不是只有在多執行緒的情況下才會發生</li>
</ul>
<h3 id="縮小-synchronized-的程式區塊">縮小 synchronized 的程式區塊</h3>
<h3 id="其它執行等待的情況">其它執行等待的情況</h3>
<h4 id="1-starvation--因搶不到資源而排隊">1. <strong>Starvation</strong> : 因搶不到資源而排隊</h4>
<h4 id="2-live-lock--因太忙碌而排隊">2. Live Lock : 因太忙碌而排隊</h4>
<h4 id="3-dead-lock--2-個執行緒互相絆住對方導致永遠等待">3. Dead Lock : 2 個執行緒互相絆住對方，導致永遠等待</h4>
<p>&hellip;</p>
<h2 id="其它執行緒方法介紹">其它執行緒方法介紹</h2>
<h3 id="使用-interrup-方法">使用 <code>interrup()</code> 方法</h3>
<h3 id="使用-sleep-方法">使用 <code>sleep()</code> 方法</h3>
<h3 id="使用其它方法">使用其它方法</h3>
<h3 id="不建議使用的方法">不建議使用的方法</h3>
<hr>
<h1 id="06-執行緒與並行-api-concurrency-api">06 執行緒與並行 API <code>Concurrency API</code></h1>
<h2 id="使用並行-api">使用並行 API</h2>
<h2 id="使用-executorservice-介面同時執行多樣工作">使用 ExecutorService 介面同時執行多樣工作</h2>
<h2 id="使用-fork-join-框架同時執行多樣工作">使用 Fork-Join 框架同時執行多樣工作</h2>
<hr>
<h1 id="07-使用-jdbc-建立資料庫連線">07 使用 JDBC 建立資料庫連線</h1>
<h2 id="了解-databasedbms-和-sql">了解 Database、DBMS 和 SQL</h2>
<h2 id="eclipse-連線並存取資料庫">Eclipse 連線並存取資料庫</h2>
<h2 id="使用-jdbc">使用 JDBC</h2>
<h2 id="jdbc-進行交易">JDBC 進行交易</h2>
<h2 id="使用-jdbc-41-的-rowsetprovider-和-rowsetfactory">使用 JDBC 4.1 的 RowSetProvider 和 RowSetFactory</h2>
<hr>
<h1 id="08-java-的區域化-localization">08 Java 的區域化 <em>Localization</em></h1>
<h2 id="了解-java-的軟體區域化作法">了解 Java 的軟體區域化作法</h2>
<h2 id="使用-dateformat-類別提供日期的區域化顯示">使用 DateFormat 類別提供日期的區域化顯示</h2>
<h2 id="使用-numberformat-類別提供幣別區域化顯示">使用 NumberFormat 類別提供幣別區域化顯示</h2>
<hr>
<h1 id="09-lambda-表示式的應用">09 Lambda 表示式的應用</h1>
<h2 id="使用-lambda-表示式">使用 Lambda 表示式</h2>
<h2 id="使用內建的功能性介面">使用內建的功能性介面</h2>
<h2 id="在泛型內使用萬用字元">在泛型內使用萬用字元</h2>
<h2 id="使用其它內建的功能性介面">使用其它內建的功能性介面</h2>
<h2 id="使用方法參照">使用方法參照</h2>
<hr>
<h1 id="10-使用-stream-api">10 使用 <code>Stream API</code></h1>
<h2 id="建構者設計模式和方法鏈結">建構者設計模式和方法鏈結</h2>
<h2 id="使用-optional-類別">使用 Optional 類別</h2>
<h2 id="stream-api-介紹">Stream API 介紹</h2>
<h2 id="stream-api-操作">Stream API 操作</h2>
<h2 id="stream-api-和-nio2">Stream API 和 NIO.2</h2>
<h2 id="stream-api-操作平行化">Stream API 操作平行化</h2>
<hr>
<h1 id="11-datetime-api">11 Date/Time API</h1>
<h2 id="date--time-相關類別的演進">Date &amp; Time 相關類別的演進</h2>
<h2 id="當地日期與時間">當地日期與時間</h2>
<h2 id="時區和日光節約時間">時區和日光節約時間</h2>
<h2 id="描述日期與時間的數量">描述日期與時間的數量</h2>
<hr>
<h1 id="12-標註型別-annotation">12 標註型別 <em>Annotation</em></h1>
<h2 id="認識標註型別">認識標註型別</h2>
<h2 id="建立自定義標註型別">建立自定義標註型別</h2>
<h2 id="標註型別的應用">標註型別的應用</h2>
<h2 id="自定義標註型別時使用的內建標註型別">自定義標註型別時使用的內建標註型別</h2>
<h2 id="開發一般程式碼經常使用的內建標註型別">開發一般程式碼經常使用的內建標註型別</h2>
<hr>
<h1 id="13-java-平台模組系統">13 Java 平台模組系統</h1>
<h2 id="認識-java-模組化">認識 Java 模組化</h2>
<h2 id="建立和執行模組化程式">建立和執行模組化程式</h2>
<h2 id="建立相依模組程式">建立相依模組程式</h2>
<h2 id="認識-module-infojava-的宣告關鍵字">認識 <code>module-info.java</code> 的宣告關鍵字</h2>
<h2 id="在命令列-command-line-使用模組指令選項">在命令列 <code>command line</code> 使用模組指令選項</h2>
<hr>
<h1 id="14-模組化應用程式">14 模組化應用程式</h1>
<h2 id="回顧模組指令">回顧模組指令</h2>
<h2 id="比較模組類型">比較模組類型</h2>
<h2 id="分析-jdk-依賴關係">分析 JDK 依賴關係</h2>
<h2 id="模組化既有應用程式">模組化既有應用程式</h2>
<h2 id="模組化-java-服務結構">模組化 Java 服務結構</h2>
<hr>
<h1 id="15-開發安全的-java-程式">15 開發安全的 Java 程式</h1>
<h2 id="設計安全物件">設計安全物件</h2>
<h2 id="注入-injection-攻擊與輸入-input-驗證">注入 <em>injection</em> 攻擊與輸入 <em>input</em> 驗證</h2>
<h2 id="處理機敏資訊">處理機敏資訊</h2>
<h2 id="序列化與反序列化物件">序列化與反序列化物件</h2>
<h2 id="建立保護機敏資料的安全物件">建立保護機敏資料的安全物件</h2>
<h2 id="避免服務阻斷-denial-of-service-攻擊">避免服務阻斷 <em>denial of service</em> 攻擊</h2>
<hr>
<h1 id="16-mock-exam--analysis">16 Mock exam &amp; analysis</h1>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-12-18</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://wysiwyz.github.io/posts/ocpjp_11_2/" data-title="1Z0-819 曾師筆記 (2/duology)" data-via="cel_yi" data-hashtags="Java,1Z0-819"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://wysiwyz.github.io/posts/ocpjp_11_2/" data-hashtag="Java"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://wysiwyz.github.io/posts/ocpjp_11_2/" data-title="1Z0-819 曾師筆記 (2/duology)"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://wysiwyz.github.io/posts/ocpjp_11_2/" data-title="1Z0-819 曾師筆記 (2/duology)"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://wysiwyz.github.io/posts/ocpjp_11_2/" data-title="1Z0-819 曾師筆記 (2/duology)"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/java/">Java</a>,&nbsp;<a href="/tags/1z0-819/">1Z0-819</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/ocpjp_11/" class="prev" rel="prev" title="1Z0-819 曾師筆記 (1/duology)"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>1Z0-819 曾師筆記 (1/duology)</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">strict with yourself; lenient with others.</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-CCS3QPVY5N', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-CCS3QPVY5N" async></script></body>
</html>
